<!DOCTYPE html><html lang="en" class="light" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>SimPEG User Tutorials</title><link rel="stylesheet" href="/user-tutorials/build/_assets/app-LVHQOBTF.css"/><link rel="stylesheet" href="/user-tutorials/build/_assets/thebe-core-SJEQ5G4L.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><script defer="" data-domain="simpeg.xyz" src="https://plausible.io/js/plausible.js"></script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 fixed w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-wrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zM3 12a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/user-tutorials/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button class="theme rounded-full border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Change theme to dark mode." aria-label="Change theme to dark mode."><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-full w-full p-0.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"></path></svg></button><div class="block sm:hidden"><div class="relative" data-headlessui-state=""><div><button class="flex text-sm bg-transparent rounded-full focus:outline-none" id="headlessui-menu-button-:Rciop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open Menu</span><div class="flex items-center text-stone-200 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="2rem" height="2rem" class="p-1"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm0 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm0 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z" clip-rule="evenodd"></path></svg></div></button></div></div></div><div class="hidden sm:block"><a href="https://mystmd.org/guide" target="_blank" rel="noopener noreferrer" class="inline-block px-4 py-2 mx-1 mt-0 leading-none border rounded text-md border-stone-700 dark:border-white text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 hover:bg-neutral-100">Learn More</a></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><nav aria-label="Table of Contents" class="flex-grow overflow-y-auto transition-opacity mt-6 pb-3 ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="SimPEG User Tutorials" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/user-tutorials/">SimPEG User Tutorials</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Gravity" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/gravity-index">Gravity</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R2d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R2d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Magnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/magnetics-index">Magnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R3d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R3d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Direct Current Resistivity" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/dcr-index">Direct Current Resistivity</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R4d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R4d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Induced Polarization" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/ip-index">Induced Polarization</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R5d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R5d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Frequency-Domain Electromagnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/fdem-index">Frequency-Domain Electromagnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R6d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R6d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time-Domain Electromagnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/tdem-index">Time-Domain Electromagnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R7d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R7d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Uncertainty and Resolution analysis" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/uran-index">Uncertainty and Resolution analysis</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R8d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R8d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav><div class="flex-none py-4 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap" style="margin-top:60px"><main class="article-grid subgrid-gap col-screen"><div class="sticky z-10 hidden h-0 col-margin-right-inset lg:block" style="top:60px"><nav></nav></div><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="pt-5 mb-8"><div class="flex items-center h-6 mt-3 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/simpeg/user-tutorials" title="GitHub Repository: simpeg/user-tutorials" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative" id="headlessui-menu-button-:R1khtop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="ml-2 -mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">3D Forward Simulation</h1></div><div id="skip-to-article"></div><div id="vK6DOawYgA" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-amber-600"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Intermediate notebook</div></div><div class="px-4 py-1"><p>This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.</p></div></aside></div><div id="TZtm9Ka7ZH" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-amber-600"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Medium-weight notebook</div></div><div class="px-4 py-1"><p>Requires moderate computational resources. Run-times may exceed several minutes and require up to 8 GB of available RAM.</p></div></aside></div><div id="reHKztYWsZ" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Author:</strong> Devin C. Cowan</p><p><strong>Keywords:</strong> DC Resistivity, forward simulation, 3D, apparent resistivity, tree mesh.</p><p><strong>Summary:</strong> Here we use the module <a target="_blank" href="https://docs.simpeg.xyz/content/api/SimPEG.electromagnetics.static.resistivity.html#module-simpeg.electromagnetics.static.resistivity" rel="noreferrer">SimPEG<wbr/>.electromagnetics<wbr/>.static<wbr/>.resistivity</a> to simulate 3D DC resistivity data on a tree mesh. Most of the functionality required for this tutorial was presented in the <a href="/user-tutorials/fwd-dcr-2d">2.5D Forward Simulation</a> tutorial. We strongly urge the reader to work through the 2.5D tutorial prior to working through this one, as we will avoid verbose repitition of content.</p><p><strong>Learning Objectives:</strong></p><ul><li>Demonstrating 3D forward simulation of DC resistivity data with SimPEG.</li><li>Specific aspects of designing 3D DC resistivity surveys.</li><li>Generating and plotting models on 3D meshes.</li><li>How to plot 3D data in pseudosection.</li><li>Computational resource considerations for 3D DC resistivity simulations.</li></ul></div><div id="vHINY4SP65" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="import-modules" class="relative group"><span class="heading-text">Import Modules</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#import-modules" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we import all of the functionality required to run the notebook for the tutorial exercise. All of the functionality specific to DC resistivity is imported from <a target="_blank" href="https://docs.simpeg.xyz/content/api/SimPEG.electromagnetics.static.resistivity.html#module-simpeg.electromagnetics.static.resistivity" rel="noreferrer">SimPEG<wbr/>.electromagnetics<wbr/>.static<wbr/>.resistivity</a>.
We also import some useful utility functions from <a target="_blank" href="https://docs.simpeg.xyz/content/api/SimPEG.utils.html#module-simpeg.utils" rel="noreferrer">SimPEG.utils</a>. To simulate DC resistivity data, we need to define our problem geometry on a numerical grid (or mesh).
To generate the mesh, we use the <a target="_blank" href="https://discretize.simpeg.xyz/en/main" rel="noreferrer">discretize</a> package.</p></div><div id="k6r4m0JxFp" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># SimPEG functionality
from SimPEG import maps, data
from SimPEG.utils import model_builder
from SimPEG.utils.io_utils.io_utils_electromagnetics import write_dcip_xyz
from SimPEG.electromagnetics.static import resistivity as dc
from SimPEG.electromagnetics.static.utils.static_utils import (
    generate_dcip_sources_line,
    pseudo_locations,
    plot_pseudosection,
    apparent_resistivity_from_voltage,
    geometric_factor,
    convert_survey_3d_to_2d_lines,
)

try:
    import plotly
    from SimPEG.electromagnetics.static.utils.static_utils import plot_3d_pseudosection
    from IPython.core.display import display, HTML

    has_plotly = True
except ImportError:
    has_plotly = False
    pass

# discretize functionality
from discretize import TreeMesh
from discretize.utils import mkvc, active_from_xyz

# Common Python functionality
import os
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
from matplotlib.colors import LogNorm

mpl.rcParams.update({&quot;font.size&quot;: 14})

write_output = False  # Optional</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="iMStXKCxzNCgFVppuSWQt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>C:\Users\devin\AppData\Local\Temp\ipykernel_17328\1465289716.py:17: DeprecationWarning: Importing display from IPython.core.display is deprecated since IPython 7.14, please import from IPython display
  from IPython.core.display import display, HTML
</span></code></pre></div></div></div><div id="tXoWQbyqF2" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-topography" class="relative group"><span class="heading-text">Define the Topography</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-topography" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Surface topography is defined as an (N, 3) <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">numpy.ndarray</a> for 3D simulations.
Here, we create basic topography for the forward simulation.
For user-specific simulations, you may load topography from an XYZ file.</p></div><div id="VqgQaWKbya" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Generate some topography
x_topo, y_topo = np.meshgrid(
    np.linspace(-2100, 2100, 141), np.linspace(-2100, 2100, 141)
)
z_topo = 410.0 + 140.0 * (1 / np.pi) * (
    np.arctan((x_topo - 500 * np.sin(np.pi * y_topo / 2800) - 400.0) / 200.0)
    - np.arctan((x_topo - 500 * np.sin(np.pi * y_topo / 2800) + 400.0) / 200.0)
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="43DL79pe1sk66PPyyU6yv" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="SNPM8txLUN" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Turn into a (N, 3) numpy.ndarray
x_topo, y_topo, z_topo = mkvc(x_topo), mkvc(y_topo), mkvc(z_topo)
topo_xyz = np.c_[mkvc(x_topo), mkvc(y_topo), mkvc(z_topo)]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="QTVxloOiLyXoE5OyYaoiC" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UKVGq5wn6G" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Plot the topography
fig = plt.figure(figsize=(6, 6))
ax = fig.add_axes([0.1, 0.1, 0.8, 0.8], projection=&quot;3d&quot;)
ax.set_zlim([-400, 400])
ax.scatter3D(topo_xyz[:, 0], topo_xyz[:, 1], topo_xyz[:, 2], s=0.25, c=&quot;b&quot;)
ax.set_box_aspect(aspect=None, zoom=0.85)
ax.set_xlabel(&quot;X (m)&quot;, labelpad=10)
ax.set_ylabel(&quot;Y (m)&quot;, labelpad=10)
ax.set_zlabel(&quot;Z (m)&quot;, labelpad=10)
ax.set_title(&quot;Topography (Exaggerated z-axis)&quot;, fontsize=16, pad=-20)
ax.view_init(elev=45.0, azim=-125)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="U5KW6HIkxRYrGrjBj-T95" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/d81beb4de34b86bd1abed80e44f58baf.png" alt="&lt;Figure size 600x600 with 1 Axes&gt;"/></div></div><div id="OtLZdM86wM" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-survey" class="relative group"><span class="heading-text">Define the Survey</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-survey" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Descriptions of the elements required to construct DC resistivity surveys were covered in the <a href="/user-tutorials/fwd-dcr-2d">2.5D Forward Simulation</a> tutorial. The only difference is that for 3D surveys, XYZ locations are required for each electrode location. Once again, there are three approaches one might use to generate the a DC resistivity survey. The final approach will be used to simulate the data for this tutorial.</p></div><div id="xTe1UYQLAH" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Option A: Define each source and its associated receivers directly</strong></p><p>We used this approach in our <a href="/user-tutorials/fwd-dcr-2d">2.5D Forward Simulation</a> tutorial. For a 3D simulation however, current electrode locations are defined as (3,) <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" rel="noreferrer">numpy.array</a> and the associated set of potential electrode locations are defined as (N, 3) <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">numpy.ndarray</a>. This approach is somewhat cumbersome for generating synthetic 3D examples, so we will use a survey generation utility instead (Option C).</p></div><div id="Tj6MpMWmow" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Option B: Survey from ABMN electrode locations</strong></p><p>If we have (N, 3) <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">numpy.ndarray</a> containing the A, B, M and N electrode locations for each datum (loaded or created), we can use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.utils.generate_survey_from_abmn_locations.html#simpeg.electromagnetics.static.utils.generate_survey_from_abmn_locations" rel="noreferrer">generate<wbr/>_survey<wbr/>_from<wbr/>_abmn<wbr/>_locations</a> to generate the survey automatically.</p></div><div id="dwFLl1ULEQ" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Option C: Survey from a set of survey lines</strong></p><p>If the survey is comprised of a set of DC resistivity lines, we can use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.utils.generate_dcip_sources_line.html#simpeg.electromagnetics.static.utils.generate_dcip_sources_line" rel="noreferrer">generate<wbr/>_dcip<wbr/>_sources<wbr/>_line</a> utility function to define the survey. Here we define the DC resistivity survey that is used simulate the tutorial data. The survey consists of 3 DC resistivity lines that use a dipole-dipole electrode configuration; 1 line along the East-West direction and 2 lines along the North-South direction. Each line is 2000 m in length and has an electrode spacing of 100 m.</p></div><div id="U446QEEjbD" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Define the parameters for each survey line
survey_type = &quot;dipole-dipole&quot;
data_type = &quot;volt&quot;
dimension_type = &quot;3D&quot;
end_locations_list = [
    np.r_[-1000.0, 1000.0, 0.0, 0.0],
    np.r_[-600.0, -600.0, -1000.0, 1000.0],
    np.r_[-300.0, -300.0, -1000.0, 1000.0],
    np.r_[0.0, 0.0, -1000.0, 1000.0],
    np.r_[300.0, 300.0, -1000.0, 1000.0],
    np.r_[600.0, 600.0, -1000.0, 1000.0],
]  # [x0, x1, y0, y1]
station_separation = 100.0
num_rx_per_src = 8

# The source lists for each line can be appended to create the source
# list for the whole survey.
source_list = []
for ii in range(0, len(end_locations_list)):
    source_list += generate_dcip_sources_line(
        survey_type,
        data_type,
        dimension_type,
        end_locations_list[ii],
        topo_xyz,
        num_rx_per_src,
        station_separation,
    )

# Define the survey
survey = dc.survey.Survey(source_list)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3fGSlH9Aasb3j_jxop1XB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="C9xvcIdhrZ" class="relative group/block article-grid subgrid-gap col-screen"><p>Here we plot the electrode locations. We use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Survey.unique_electrode_locations.html#simpeg.electromagnetics.static.resistivity.survey.unique_electrode_locations" rel="noreferrer">unique<wbr/>_electrode<wbr/>_locations</a> method to extract the unique electrode locations from the survey and the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.utils.pseudo_locations.html#simpeg.electromagnetics.static.utils.pseudo_locations" rel="noreferrer">pseudo_locations</a> utility to extract the pseudo-location.</p></div><div id="C39NCA5tbv" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">unique_locations = survey.unique_electrode_locations
fig = plt.figure(figsize=(12, 2.75))
ax1 = fig.add_axes([0.1, 0.1, 0.2, 0.8])
ax1.scatter(unique_locations[:, 0], unique_locations[:, 1], 8, &quot;r&quot;)
ax1.set_xlabel(&quot;x (m)&quot;)
ax1.set_ylabel(&quot;y (m)&quot;)
ax1.set_title(&quot;Horizontal locations&quot;)

pseudo_locations_xyz = pseudo_locations(survey)
inds = pseudo_locations_xyz[:, 1] == 0.0
ax2 = fig.add_axes([0.4, 0.1, 0.55, 0.8])
ax2.scatter(pseudo_locations_xyz[inds, 0], pseudo_locations_xyz[inds, -1], 8, &quot;r&quot;)
ax2.set_xlabel(&quot;x (m)&quot;)
ax2.set_ylabel(&quot;z (m)&quot;)
ax2.set_title(&quot;Pseudo-locations (EW line)&quot;)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="d5peGE5toyhKkbJG_hOuO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/53f0aaa45860a660279e1124e77291fa.png" alt="&lt;Figure size 1200x275 with 2 Axes&gt;"/></div></div><div id="TeoQyHQ5h9" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="design-a-tree-mesh" class="relative group"><span class="heading-text">Design a (Tree) Mesh</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#design-a-tree-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p><strong>Standard approach for DC/IP:</strong> The standard approach presented in the <a href="/user-tutorials/fwd-dcr-2d">2.5D Forward Simulation</a> tutorial also applies to forward simulations in 3D. And the same methods are used to refine the tree mesh around electrodes, topography, etc... For 3D simulations however, we may need to consider limitations in computational resources which are not encountered in 2.5D simulations. Because 3D simulations require discretization along a third direction, the number of cells in the mesh is proportional <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>h</mi><mrow><mo>−</mo><mn>3</mn></mrow></msup></mrow><annotation encoding="application/x-tex">h^{-3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span></span>; where <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span></span> is the minimum cell edge length. Therefore the minimum cell size used for 3D simulations is generally coarser than the minimum cell size used for 2.5D simulations.</p><p><strong>Tutorial mesh:</strong> Here, a minimum cell width of 25 m (or 1/4 the minimum electrode spacing) is used within our survey region. The largest electrode spacing was 1000 m, so a the padding was extended at least 3000 m from the survey region. Using the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_surface.html#discretize.treemesh.refine_surface" rel="noreferrer">refine_surface</a> method, we refine the tree mesh where there is significant topography. And using the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_points.html#discretize.treemesh.refine_points" rel="noreferrer">refine_points</a> methods, we refine based on electrodes locations. Visit the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh" rel="noreferrer">tree mesh</a> API to see additional refinement methods.</p></div><div id="nprs9zGkKw" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Defining domain size and minimum cell size
dh = 25.0  # base cell width
dom_width_x = 8000.0  # domain width x
dom_width_y = 8000.0  # domain width y
dom_width_z = 4000.0  # domain width z

# Number of base mesh cells in each direction. Must be a power of 2
nbcx = 2 ** int(np.round(np.log(dom_width_x / dh) / np.log(2.0)))  # num. base cells x
nbcy = 2 ** int(np.round(np.log(dom_width_y / dh) / np.log(2.0)))  # num. base cells y
nbcz = 2 ** int(np.round(np.log(dom_width_z / dh) / np.log(2.0)))  # num. base cells z

# Define the base mesh
hx = [(dh, nbcx)]
hy = [(dh, nbcy)]
hz = [(dh, nbcz)]
mesh = TreeMesh([hx, hy, hz], x0=&quot;CCN&quot;)

# Shift top to maximum topography
mesh.origin = mesh.origin + np.r_[0.0, 0.0, z_topo.max()]

# Mesh refinement based on surface topography
k = np.sqrt(np.sum(topo_xyz[:, 0:2] ** 2, axis=1)) &lt; 1200
mesh.refine_surface(topo_xyz[k, :], padding_cells_by_level=[0, 4, 4], finalize=False)

# Mesh refinement near electrodes.
mesh.refine_points(unique_locations, padding_cells_by_level=[6, 6, 4], finalize=False)

# Finalize the mesh
mesh.finalize()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="qCxNX081jMnEorOya_SIq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="WuStpZQdDM" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-active-cells" class="relative group"><span class="heading-text">Define the Active Cells</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-active-cells" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Simulated geophysical data are dependent on the subsurface distribution of physical property values. As a result, the cells lying below the surface topography are commonly referred to as ‘active cells’. And air cells, whose physical property values are fixed, are commonly referred to as ‘inactive cells’. Here, the discretize <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz" rel="noreferrer">active_from_xyz</a> utility function is used to find the indices of the active cells using the mesh and surface topography. The output quantity is a <code>bool</code> array.</p></div><div id="i0fN5kOnLf" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Indices of the active mesh cells from topography (e.g. cells below surface)
active_cells = active_from_xyz(mesh, topo_xyz)

# number of active cells
n_active = np.sum(active_cells)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="2z9ATIs_HYzdCa29MV9ca" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="SGQ70mrdzO" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="models-and-mappings" class="relative group"><span class="heading-text">Models and Mappings</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#models-and-mappings" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In SimPEG, the term ‘model’ is not necessarily synonymous with the set of physical property values defined on the mesh. For example, the model may be defined as the logarithms of the physical property values, or be the parameters defining a layered Earth geometry. Models in SimPEG are 1D <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">numpy.ndarray</a> whose lengths are
equal to the number of model parameters.</p><p>Classes within the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.IdentityMap.html#simpeg.maps.identitymap" rel="noreferrer">SimPEG.maps</a> module are used to define the mapping that connects the model to the physical property values used in the DC resistivity simulation. Sophisticated mappings can be defined by combining multiple mapping objects. But in the simplest case, the mapping is an identity map and the model consists of the conductivity/resistivity values for all mesh cells (including air).</p><p>When simulating DC resistivity data, we have the choice of using resistivity or conductivity to define the Earth’s electrical properties. Here, we define the model and its associate mapping for two cases:</p><ol start="1"><li>The model consists of the conductivity values for all active cells</li><li>The model consists of the log-resistivity values for all active cells</li></ol></div><div id="Gie361oTI8" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-model" class="relative group"><span class="heading-text">Define the Model</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-model" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The units for resistivity are <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Ω</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">\Omega m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Ω</span><span class="mord mathnormal">m</span></span></span></span></span> and the units for conductivity are <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi mathvariant="normal">/</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">S/m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">/</span><span class="mord mathnormal">m</span></span></span></span></span>.</p></div><div id="qdqPtJR7fP" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Define conductivity values in S/m (take reciprocal for resistivities in Ohm m)
air_conductivity = 1e-8
background_conductivity = 1e-2
conductor_conductivity = 1e-1
resistor_conductivity = 1e-3</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="5VaRpmXEdvGSvGsOeaxwJ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="B0D99KBViU" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Define conductivity model
conductivity_model = background_conductivity * np.ones(n_active)

ind_conductor = model_builder.get_indices_sphere(
    np.r_[-300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]
)
conductivity_model[ind_conductor] = conductor_conductivity

ind_resistor = model_builder.get_indices_sphere(
    np.r_[300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]
)
conductivity_model[ind_resistor] = resistor_conductivity

# Define log-resistivity model
log_resistivity_model = np.log(1 / conductivity_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Jm5OhY-s1_hpNpsUb47WL" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="GUPFiZ014W" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="mapping-from-the-model-to-the-mesh" class="relative group"><span class="heading-text">Mapping from the Model to the Mesh</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mapping-from-the-model-to-the-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>For our first case, we use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.InjectActiveCells.html#simpeg.maps.injectactivecells" rel="noreferrer">SimPEG<wbr/>.maps<wbr/>.InjectActiveCells</a> mapping. This mapping projects quantities defined on the active cells to the entire mesh, and sets a constant value for all inactive cells. <strong>Important:</strong> we set all inactive (air) cells to 1e-8 S/m instead of 0. This is done to ensure that the linear system constructed to solve the PDE for the DC resistivity problem is well-conditioned.</p><p>For the second case, we use both the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.InjectActiveCells.html#simpeg.maps.injectactivecells" rel="noreferrer">SimPEG<wbr/>.maps<wbr/>.InjectActiveCells</a> and <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.ExpMap.html#simpeg.maps.expmap" rel="noreferrer">SimPEG.maps.ExpMap</a> mappings; the latter of which takes the natural exponential. <strong>Important:</strong> we set all inactive (air) cells to 1e8 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Ω</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">\Omega m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Ω</span><span class="mord mathnormal">m</span></span></span></span></span> instead of <!-- -->∞<!-- -->. Once again, this is done to ensure that the linear system constructed to solve the PDE for the DC resistivity problem is well-conditioned.</p></div><div id="kNRtbgZnYz" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Conductivity map. Model parameters are conductivities for all active cells.
conductivity_map = maps.InjectActiveCells(mesh, active_cells, air_conductivity)

# Resistivity map. Model parameters are log-resistivities for all active cells.
log_resistivity_map = maps.InjectActiveCells(
    mesh, active_cells, 1 / air_conductivity
) * maps.ExpMap(nP=n_active)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-n54xIJads2WWiuls5oWC" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="uRxGFNHQKo" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-the-model" class="relative group"><span class="heading-text">Plot the Model</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-the-model" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To show the geometry of the problem, we plot the conductivity model using the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.plot_slice.html#discretize.treemesh.plot_slice" rel="noreferrer">plot_slice</a> method.</p></div><div id="avbaOyDW3H" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Generate a mapping to ignore inactice cells in plot
plotting_map = maps.InjectActiveCells(mesh, active_cells, np.nan)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="NDODT5GJ6vKunnXnJHC6X" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ZTvfxTS0cV" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(10, 4.5))

norm = LogNorm(vmin=1e-3, vmax=1e-1)

ax1 = fig.add_axes([0.15, 0.15, 0.68, 0.75])
mesh.plot_slice(
    plotting_map * conductivity_model,
    ax=ax1,
    normal=&quot;Y&quot;,
    ind=int(len(mesh.h[1]) / 2),
    grid=True,
    pcolor_opts={&quot;cmap&quot;: mpl.cm.RdYlBu_r, &quot;norm&quot;: norm},
)
ax1.set_title(&quot;Conductivity Model&quot;)
ax1.set_xlabel(&quot;x (m)&quot;)
ax1.set_ylabel(&quot;z (m)&quot;)
ax1.set_xlim([-1500, 1500])
ax1.set_ylim([z_topo.max() - 1500, z_topo.max()])

ax2 = fig.add_axes([0.84, 0.15, 0.03, 0.75])
cbar = mpl.colorbar.ColorbarBase(
    ax2, cmap=mpl.cm.RdYlBu_r, norm=norm, orientation=&quot;vertical&quot;
)
cbar.set_label(&quot;$\sigma$ [S/m]&quot;, rotation=270, labelpad=15, size=16)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="st1kMeeo26QAbrw8cpBYB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/6ed2a742d0f0aea11504adb92a0dc558.png" alt="&lt;Figure size 1000x450 with 2 Axes&gt;"/></div></div><div id="uBXr7jqyHo" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="project-electrodes-to-discretized-topography" class="relative group"><span class="heading-text">Project Electrodes to Discretized Topography</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#project-electrodes-to-discretized-topography" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Surface DC resistivity data will not be modeled accurately if the electrodes are modeled as living above or below the surface. It is especially problematic when electrodes are modeled as living in the air. Prior to simulating surface DC resistivity data, we must project the electrodes from their true elevation to the surface of the <em>discretized</em> topography. This is done using the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Survey.drape_electrodes_on_topography.html#simpeg.electromagnetics.static.resistivity.survey.drape_electrodes_on_topography" rel="noreferrer">drape<wbr/>_electrodes<wbr/>_on<wbr/>_topography</a> method.</p></div><div id="bf9qF9wC4k" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">survey.drape_electrodes_on_topography(mesh, active_cells, option=&quot;top&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="tSql0oNqidNBoYDt5myKa" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="DwptEAb0RT" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-forward-simulation" class="relative group"><span class="heading-text">Define the Forward Simulation</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-forward-simulation" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In SimPEG, the physics of the forward simulation is defined by creating an instance of an appropriate simulation class. There are two simulation classes which may be used to simulate 3D DC resistivity data:</p><ul><li><a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Simulation3DNodal.html#simpeg.electromagnetics.static.resistivity.simulation3dnodal" rel="noreferrer">Simulation3DNodel</a>, which defines the discrete electric potentials on mesh nodes.</li><li><a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Simulation3DCellCentered.html#simpeg.electromagnetics.static.resistivity.simulation3dcellcentered" rel="noreferrer">Simulation3DCellCentered</a>, which defines the discrete electric potentials at cell centers.</li></ul><p>For surface DC resistivity data, the nodal formulation is more well-suited and will be used here. The cell-centered formulation works well for simulating borehole DC resistivity data. Here, we define two simulation objects, one where the model defines the subsurface conductivities, and one where the model defines subsurface log-resistivities. When our model is used to define subsurface electric conductivity, the mapping is set using the <code>sigmaMap</code> keyword argument. However when our model is used to define subsurface electric resistivity, the mapping must be set using the <code>rhoMap</code> keyword argument</p></div><div id="aXrzYUKoU5" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># DC simulation for a conductivity model
simulation_con = dc.simulation.Simulation3DNodal(
    mesh, survey=survey, sigmaMap=conductivity_map
)

# DC simulation for a log-resistivity model
simulation_res = dc.simulation.Simulation3DNodal(
    mesh, survey=survey, rhoMap=log_resistivity_map
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="nTowr7iDXuD8doz5ebR4X" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="caDEOz9cZr" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="predict-dc-resistivity-data" class="relative group"><span class="heading-text">Predict DC Resistivity Data</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#predict-dc-resistivity-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Once any simulation within SimPEG has been properly constructed, simulated data for a given model vector can be computed using the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.simulation.BaseSimulation.dpred.html#simpeg.simulation.basesimulation.dpred" rel="noreferrer">dpred</a> method. Note that despite the difference in how we defined the models representing the Earth’s electrical properties, the data predicted by both simulations is equivalent.</p></div><div id="EWcZTFZvnn" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">dpred_con = simulation_con.dpred(conductivity_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="OBRez8oLib4nkOmrVcp8D" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="cE0jQdrHVw" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">dpred_res = simulation_res.dpred(log_resistivity_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="6DRrK90bbd4AIGUXy6wkG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="dNdxgqogTt" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">print(&quot;MAX ABSOLUTE ERROR = {}&quot;.format(np.max(np.abs(dpred_con - dpred_res))))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="12Sq7HzVfu3Xbbg6nKTPz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>MAX ABSOLUTE ERROR = 5.551115123125783e-16
</span></code></pre></div></div></div><div id="l5F2XFoV9p" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="convert-normalized-voltages-to-apparent-conductivities" class="relative group"><span class="heading-text">Convert Normalized Voltages to Apparent Conductivities</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#convert-normalized-voltages-to-apparent-conductivities" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this tutorial, the receivers were defined to simulation normalized voltage data. Here, we use the <a target="_blank" href="SimPEG#SimPEG.electromagnetics.static.utils.apparent_resistivity_from_voltage" rel="noreferrer">apparent<wbr/>_resistivity<wbr/>_from<wbr/>_voltage</a> utility function to convert the data to apparent resistivities, then take the reciprocal to obtain apparent conductivities.</p></div><div id="ZZhiNiLWZT" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">apparent_conductivity = apparent_resistivity_from_voltage(survey, dpred_con) ** -1</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="uSLZqD_LI_gQ2qK84TFzm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Q4Bpkw6QCQ" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="plot-data-in-pseudosection" class="relative group"><span class="heading-text">Plot Data in Pseudosection</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-data-in-pseudosection" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="HFOVRuD1nr" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-3d-pseudosection" class="relative group"><span class="heading-text">Plot 3D Pseudosection</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-3d-pseudosection" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>For general 3D survey configurations, we can use the <a target="_blank" href="SimPEG#SimPEG.electromagnetics.static.utils.plot_3d_pseudosection" rel="noreferrer">plot<wbr/>_3d<wbr/>_pseudosection</a> utility function to plot 3D pseudosection data. For large datasets or for surveys with unconventional electrode geometry, interpretation can be challenging if we plot every datum. Here, we plot 3 out of the 6 survey lines to better image anomalous structures. To plot ALL of the data, simply remove the keyword argument <em>plane_points</em> when calling <em>plot_3d_pseudosection</em>. To use this utility, you must have Python’s <a target="_blank" href="https://plotly.com/python/" rel="noreferrer">plotly</a> package.</p></div><div id="ouw7QwQhEc" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Empty list for plane points
plane_points = []

# 3-points defining the plane for EW survey line
p1, p2, p3 = np.array([-1000, 0, 0]), np.array([1000, 0, 0]), np.array([0, 0, -1000])
plane_points.append([p1, p2, p3])

# NS at x = -300 m
p1, p2, p3 = (
    np.array([-300, -1000, 0]),
    np.array([-300, 1000, 0]),
    np.array([-300, 0, -1000]),
)
plane_points.append([p1, p2, p3])

# NS at x = 300 m
p1, p2, p3 = (
    np.array([300, -1000, 0]),
    np.array([300, 1000, 0]),
    np.array([300, 0, -1000]),
)
plane_points.append([p1, p2, p3])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="xq9gqbJAUhFyQE3ich0Yc" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="aE6csW2YNm" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">if has_plotly:
    fig = plot_3d_pseudosection(
        survey,
        apparent_conductivity,
        scale=&quot;log&quot;,
        units=&quot;S/m&quot;,
        plane_points=plane_points,
        plane_distance=15,
        marker_opts={&quot;colorscale&quot;: &quot;RdYlBu_r&quot;},
    )

    fig.update_layout(
        title_text=&quot;Apparent Conductivity&quot;,
        title_x=0.5,
        title_font_size=24,
        width=650,
        height=500,
        scene_camera=dict(center=dict(x=0.05, y=0, z=-0.4)),
    )

    #     plotly.io.show(fig)
    html_str = plotly.io.to_html(fig)
    display(HTML(html_str))

else:
    print(&quot;INSTALL &#x27;PLOTLY&#x27; TO VISUALIZE 3D PSEUDOSECTIONS&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="seR_szLdBiXBQdRbwgSlM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="yhzm4YnGMR" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-individual-lines-in-2d-pseudosection" class="relative group"><span class="heading-text">Plot Individual Lines in 2D Pseudosection</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-individual-lines-in-2d-pseudosection" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>For conventional DC resistivity surveys, the electrodes are located along a set of survey lines. If we know which the survey line associated with each datum, we can parse the 3D survey into a set of 2D survey lines. Then we can plot individual pseudosections for each survey line. Here, we have 6 survey lines, each of which has the same number of data. So assigning a line ID to each datum is easy. You may need to do something more sophisticated in other cases.</p></div><div id="GwxyUCzLWX" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># line IDs
n_lines = len(end_locations_list)
n_data_per_line = int(survey.nD / n_lines)
lineID = np.hstack([(ii + 1) * np.ones(n_data_per_line) for ii in range(n_lines)])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="idvCdJV4ZcK1xxiXCS1BX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="P8SjUUQ6ZW" class="relative group/block article-grid subgrid-gap col-screen"><p>Here, we use the <a target="_blank" href="SimPEG#SimPEG.electromagnetics.static.utils.convert_survey_3d_to_2d_lines" rel="noreferrer">convert<wbr/>_survey<wbr/>_3d<wbr/>_to<wbr/>_2d<wbr/>_lines</a> to generate the list of 2D surveys.</p></div><div id="YbkMElr6k5" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">survey_2d_list, index_list = convert_survey_3d_to_2d_lines(
    survey, lineID, data_type=&quot;volt&quot;, output_indexing=True
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="W5_-B3W2Bz83wDZPXQ4zM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="fuzQrKY5m3" class="relative group/block article-grid subgrid-gap col-screen"><p>Next, we create list of 2D apparent conductivities. Note that if you converted observed data then computed apparent conductivities, you would be doing so assuming 2D survey geometry and the values would not match those on the 3D pseudosection plot!</p></div><div id="fvUWmVjIw5" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">dobs_2d_list = []
apparent_conductivities_2d = []
for ind in index_list:
    dobs_2d_list.append(dpred_con[ind])
    apparent_conductivities_2d.append(apparent_conductivity[ind])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="g3vBmMDibHT3INLi1mTrw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="OBZpKfoj9U" class="relative group/block article-grid subgrid-gap col-screen"><p>Now we can use the <a target="_blank" href="SimPEG#SimPEG.electromagnetics.static.utils.plot_2d_pseudosection" rel="noreferrer">plot<wbr/>_2d<wbr/>_pseudosection</a> utility function to plot the pseudosection for the desired survey line.</p></div><div id="JI1l4pmJX0" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Line index
line_ind = 0

# Plot apparent conductivity pseudo-section
fig = plt.figure(figsize=(8, 2.75))
ax1 = fig.add_axes([0.1, 0.15, 0.75, 0.78])
plot_pseudosection(
    survey_2d_list[line_ind],
    dobs=apparent_conductivities_2d[line_ind],
    plot_type=&quot;contourf&quot;,
    ax=ax1,
    scale=&quot;log&quot;,
    cbar_label=&quot;S/m&quot;,
    mask_topography=True,
    contourf_opts={&quot;levels&quot;: 20, &quot;cmap&quot;: mpl.cm.RdYlBu_r},
)
ax1.set_title(&quot;Apparent Conductivity&quot;)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="zFEZH5jBTD8W-kKkEn4mD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/de226d8af961c25413870fb048140271.png" alt="&lt;Figure size 800x275 with 2 Axes&gt;"/></div></div><div id="WKvremEmK5" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Optional:</strong> Write DC resistivity data and topography.</p></div><div id="vxSrAA6gLT" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">if write_output:
    dir_path = os.path.sep.join([&quot;.&quot;, &quot;fwd_dcr_3d_outputs&quot;]) + os.path.sep
    if not os.path.exists(dir_path):
        os.mkdir(dir_path)

    # Add 10% Gaussian noise to each datum
    np.random.seed(433)
    std = 0.1 * np.abs(dpred_con)
    noise = std * np.random.normal(size=len(dpred_con))
    dobs = dpred_con + noise

    # Create dictionary that stores line IDs
    out_dict = {&quot;LINEID&quot;: lineID}

    # Create a survey with the original electrode locations
    # and not the shifted ones
    source_list = []
    for ii in range(n_lines):
        source_list += generate_dcip_sources_line(
            survey_type,
            data_type,
            dimension_type,
            end_locations_list[ii],
            topo_xyz,
            num_rx_per_src,
            station_separation,
        )
    survey_original = dc.survey.Survey(source_list)

    # Write out data at their original electrode locations (not shifted)
    data_obj = data.Data(survey_original, dobs=dobs, standard_deviation=std)

    fname = dir_path + &quot;dc_data.xyz&quot;
    write_dcip_xyz(
        fname,
        data_obj,
        data_header=&quot;V/A&quot;,
        uncertainties_header=&quot;UNCERT&quot;,
        out_dict=out_dict,
    )

    fname = dir_path + &quot;topo_xyz.txt&quot;
    np.savetxt(fname, topo_xyz, fmt=&quot;%.4e&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="mVOUYSn8ELIxGkvGEJlrM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>XYZ file saved to: .\fwd_dcr_3d_outputs\dc_data.xyz
</span></code></pre></div></div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/user-tutorials/fwd-dcr-2d"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">SimPEG User Tutorials</div>2.5D Forward Simulation</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/user-tutorials/inv-dcr-1d"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">SimPEG User Tutorials</div>1D Inversion for a Single Sounding</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((l,d)=>{if(!window.history.state||!window.history.state.key){let f=Math.random().toString(32).slice(2);window.history.replaceState({key:f},"")}try{let p=JSON.parse(sessionStorage.getItem(l)||"{}")[d||window.history.state.key];typeof p=="number"&&window.scrollTo(0,p)}catch(f){console.error(f),sessionStorage.removeItem(l)}})("positions", null)</script><link rel="modulepreload" href="/user-tutorials/build/entry.client-K6EYMIDZ.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-FBLNPC3V.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-XJN3BT5Q.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-JPGYAJQ3.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-YAIQ7LUU.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-JOLZ6LZB.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-XIW7RL3H.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-I634YBN3.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-MITWS4PZ.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-M5ZDOVXY.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-6TYLRLOL.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-UZHI4RYQ.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-RTIGS2T3.js"/><link rel="modulepreload" href="/user-tutorials/build/root-2CYAF5SQ.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-OYK7WRH2.js"/><link rel="modulepreload" href="/user-tutorials/build/routes/$-ZDWRJY4B.js"/><script>window.__remixContext = {"url":"/fwd-dcr-3d","state":{"loaderData":{"root":{"theme":"light","config":{"title":"SimPEG User Tutorials","options":{"analytics_plausible":"simpeg.xyz"},"myst":"1.1.42","nav":[],"actions":[{"title":"Learn More","url":"https://mystmd.org/guide"}],"projects":[{"title":"SimPEG User Tutorials","github":"https://github.com/simpeg/user-tutorials","keywords":[],"references":{"python":{"url":"https://docs.python.org/3/"},"numpy":{"url":"https://numpy.org/doc/stable/"},"scipy":{"url":"https://docs.scipy.org/doc/scipy/"},"matplotlib":{"url":"https://matplotlib.org/stable/"},"discretize":{"url":"https://discretize.simpeg.xyz/en/main/"},"SimPEG":{"url":"https://docs.simpeg.xyz/"},"geoana":{"url":"https://geoana.simpeg.xyz/"},"sphinx":{"url":"https://www.sphinx-doc.org/en/master/"}},"thumbnail":"/user-tutorials/build/title_image-8a71538f0bef40867b3fb0794cae7dbc.png","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"gravity-index","title":"Gravity","description":"","date":"","thumbnail":"/user-tutorials/build/ae6c6ed278992f609070dbcd57643aba.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-gravity-anomaly-3d","title":"3D Forward Simulation of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-gravity-gradiometry-3d","title":"3D Forward Simulation of Gravity Gradiometry Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-gravity-anomaly-3d","title":"3D Inversion of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"magnetics-index","title":"Magnetics","description":"","date":"","thumbnail":"/user-tutorials/build/7a8cefd4894c78a7681713eac224fec3.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-magnetics-induced-3d","title":"3D Forward Simulation of TMI Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-magnetics-mvi-3d","title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-magnetics-induced-3d","title":"3D Inversion of TMI Data to Recover a Susceptibility Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dcr-index","title":"Direct Current Resistivity","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-ba2ce1e7a00bcfd7d149b5f4511b019f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-dcr-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-2d","title":"2.5D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-3d","title":"3D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-2d","title":"2.5D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-3d","title":"3D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ip-index","title":"Induced Polarization","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-ba2ce1e7a00bcfd7d149b5f4511b019f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-ip-2d","title":"2.5D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-ip-3d","title":"3D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-2d","title":"2.5D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-3d","title":"3D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fdem-index","title":"Frequency-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/fem_physics-6287513b81425048223fc264589cdf6a.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-fdem-1d","title":"1D Forward Simulation of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-fdem-1d","title":"1D Inversion of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"tdem-index","title":"Time-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/tem_physics-81e11e7ffe320f0cb309e445a95570b3.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-tdem-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-tdem-fundamentals","title":"Fundamentals of Finite Volume for TDEM Simulations","description":"","date":"","thumbnail":"/user-tutorials/build/diffusion_distance-1231b4c642392d8e924a88a81c415e67.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-utem-3d","title":"3D Forward Simulation for On-Time Large-Loop Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-tdem-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"uran-index","title":"Uncertainty and Resolution analysis","description":"","date":"","thumbnail":"/user-tutorials/build/f0de225db6a3bcc09186ff9fea3eba43.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"dc2d-sens","title":"2D DC Resistivity Sensitivity analysis","description":"","date":"","thumbnail":"/user-tutorials/build/f037fe2572b5e1b2bf477ba85272db70.gif","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/user-tutorials"},"routes/$":{"page":{"kind":"Notebook","sha256":"2ce4934edbf6bfa27b768d572b434ebc4122d03fc86f2395e7ee78f2d7d6d6e0","slug":"fwd-dcr-3d","location":"/notebooks/05-dcr/fwd_dcr_3d.ipynb","dependencies":[],"frontmatter":{"title":"3D Forward Simulation","content_includes_title":false,"github":"https://github.com/simpeg/user-tutorials","keywords":[],"exports":[{"format":"ipynb","filename":"fwd_dcr_3d.ipynb","url":"/user-tutorials/build/fwd_dcr_3d-b1924805cae477cffb22473b477aae03.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"admonition","class":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Intermediate notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Bu5JGtCzQ5"}],"key":"dsnNgDv7ao"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g5inXqw0K4"}],"key":"hC6C8fO2Hf"}],"key":"S89tYhywKW"}],"data":{"type":"notebook-content"},"key":"vK6DOawYgA"},{"type":"block","children":[{"type":"admonition","class":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Medium-weight notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bvon5Qsc63"}],"key":"XG4R5NjhiX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Requires moderate computational resources. Run-times may exceed several minutes and require up to 8 GB of available RAM.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dXkRvTlm5X"}],"key":"WOI5s0DqXp"}],"key":"yDLr3jVpZa"}],"data":{"type":"notebook-content"},"key":"TZtm9Ka7ZH"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ePlH0BSaI6"}],"key":"tO0JaHx4Or"},{"type":"text","value":" Devin C. Cowan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bPf8s0jfDu"}],"key":"fNLjoGHpEa"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Keywords:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"cyVfuD5LXB"}],"key":"JBYVXwvbY5"},{"type":"text","value":" DC Resistivity, forward simulation, 3D, apparent resistivity, tree mesh.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Kw5bCdnRu4"}],"key":"y5f8JWnLFJ"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Summary:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"DNepfdSWsM"}],"key":"H9taSMtRB5"},{"type":"text","value":" Here we use the module ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"VuxUe7JsE4"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/SimPEG.electromagnetics.static.resistivity.html#module-simpeg.electromagnetics.static.resistivity","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"SimPEG​.electromagnetics​.static​.resistivity","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GLN4vfFH1Y"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.resistivity","internal":false,"protocol":"myst","key":"Xkc4fxWhFf"},{"type":"text","value":" to simulate 3D DC resistivity data on a tree mesh. Most of the functionality required for this tutorial was presented in the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"wdWehfGwIh"},{"type":"link","url":"/fwd-dcr-2d","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"2.5D Forward Simulation","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"RC0tE8thT6"}],"urlSource":"fwd_dcr_2d.ipynb","internal":true,"dataUrl":"/fwd-dcr-2d.json","protocol":"file","key":"frbyYDxc6O"},{"type":"text","value":" tutorial. We strongly urge the reader to work through the 2.5D tutorial prior to working through this one, as we will avoid verbose repitition of content.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"grVLPO1Bnd"}],"key":"BqyfNNrw0w"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Learning Objectives:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"AygREYYS27"}],"key":"BrQCW6b1xu"}],"key":"QJ4FI6tC0L"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Demonstrating 3D forward simulation of DC resistivity data with SimPEG.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Q5EnoEpTlt"}],"key":"IlIMvE6DY3"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Specific aspects of designing 3D DC resistivity surveys.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"U2r1btEPkD"}],"key":"t97M04e5bf"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Generating and plotting models on 3D meshes.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"SCMRq1mrlf"}],"key":"vLkTRzzpay"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"How to plot 3D data in pseudosection.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"RixTObXT3T"}],"key":"pdwatvPcuD"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Computational resource considerations for 3D DC resistivity simulations.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"PUDmXokqXj"}],"key":"m3rE0eWVba"}],"key":"Bxk3ngGufN"}],"data":{"type":"notebook-content"},"key":"reHKztYWsZ"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Modules","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GBinRKIB4i"}],"identifier":"import-modules","label":"Import Modules","html_id":"import-modules","implicit":true,"key":"BirRc0Bjg2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Here, we import all of the functionality required to run the notebook for the tutorial exercise. All of the functionality specific to DC resistivity is imported from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sWnL37dq9W"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/SimPEG.electromagnetics.static.resistivity.html#module-simpeg.electromagnetics.static.resistivity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG​.electromagnetics​.static​.resistivity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Of2oJ3eFPD"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.resistivity","internal":false,"protocol":"myst","key":"dZpP2adZhp"},{"type":"text","value":".\nWe also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AReczkxInv"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/SimPEG.utils.html#module-simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"s1mEh3GSy1"}],"urlSource":"myst:SimPEG#SimPEG.utils","internal":false,"protocol":"myst","key":"kytEqXy4mf"},{"type":"text","value":". To simulate DC resistivity data, we need to define our problem geometry on a numerical grid (or mesh).\nTo generate the mesh, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"anQ21wyOpE"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nZqhtlKkUs"}],"urlSource":"https://discretize.simpeg.xyz/en/main","key":"dlZS49Trza"},{"type":"text","value":" package.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pGIvF0cEKe"}],"key":"FXw9MSer5s"}],"data":{"type":"notebook-content"},"key":"vHINY4SP65"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# SimPEG functionality\nfrom SimPEG import maps, data\nfrom SimPEG.utils import model_builder\nfrom SimPEG.utils.io_utils.io_utils_electromagnetics import write_dcip_xyz\nfrom SimPEG.electromagnetics.static import resistivity as dc\nfrom SimPEG.electromagnetics.static.utils.static_utils import (\n    generate_dcip_sources_line,\n    pseudo_locations,\n    plot_pseudosection,\n    apparent_resistivity_from_voltage,\n    geometric_factor,\n    convert_survey_3d_to_2d_lines,\n)\n\ntry:\n    import plotly\n    from SimPEG.electromagnetics.static.utils.static_utils import plot_3d_pseudosection\n    from IPython.core.display import display, HTML\n\n    has_plotly = True\nexcept ImportError:\n    has_plotly = False\n    pass\n\n# discretize functionality\nfrom discretize import TreeMesh\nfrom discretize.utils import mkvc, active_from_xyz\n\n# Common Python functionality\nimport os\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom matplotlib.colors import LogNorm\n\nmpl.rcParams.update({\"font.size\": 14})\n\nwrite_output = False  # Optional","key":"mS1Uma8TQN"},{"type":"output","id":"iMStXKCxzNCgFVppuSWQt","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\devin\\AppData\\Local\\Temp\\ipykernel_17328\\1465289716.py:17: DeprecationWarning: Importing display from IPython.core.display is deprecated since IPython 7.14, please import from IPython display\n  from IPython.core.display import display, HTML\n"}],"key":"cGP97ER0lV"}],"data":{"type":"notebook-code"},"key":"k6r4m0JxFp"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dWfVX42Til"}],"identifier":"define-the-topography","label":"Define the Topography","html_id":"define-the-topography","implicit":true,"key":"GRo2Ac1TrD"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Surface topography is defined as an (N, 3) ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ij3lgA2v1J"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x4gKmZ5CbK"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"myst","key":"g2EcsmeT9k"},{"type":"text","value":" for 3D simulations.\nHere, we create basic topography for the forward simulation.\nFor user-specific simulations, you may load topography from an XYZ file.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"k5HjHk2ylB"}],"key":"QTpyf2zFYj"}],"data":{"type":"notebook-content"},"key":"tXoWQbyqF2"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Generate some topography\nx_topo, y_topo = np.meshgrid(\n    np.linspace(-2100, 2100, 141), np.linspace(-2100, 2100, 141)\n)\nz_topo = 410.0 + 140.0 * (1 / np.pi) * (\n    np.arctan((x_topo - 500 * np.sin(np.pi * y_topo / 2800) - 400.0) / 200.0)\n    - np.arctan((x_topo - 500 * np.sin(np.pi * y_topo / 2800) + 400.0) / 200.0)\n)","key":"Pw77QP3trg"},{"type":"output","id":"43DL79pe1sk66PPyyU6yv","data":[],"key":"svKsDYPQDY"}],"data":{"type":"notebook-code"},"key":"VqgQaWKbya"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Turn into a (N, 3) numpy.ndarray\nx_topo, y_topo, z_topo = mkvc(x_topo), mkvc(y_topo), mkvc(z_topo)\ntopo_xyz = np.c_[mkvc(x_topo), mkvc(y_topo), mkvc(z_topo)]","key":"IwV2OKJxSk"},{"type":"output","id":"QTVxloOiLyXoE5OyYaoiC","data":[],"key":"MswKlTq5Ey"}],"data":{"type":"notebook-code"},"key":"SNPM8txLUN"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the topography\nfig = plt.figure(figsize=(6, 6))\nax = fig.add_axes([0.1, 0.1, 0.8, 0.8], projection=\"3d\")\nax.set_zlim([-400, 400])\nax.scatter3D(topo_xyz[:, 0], topo_xyz[:, 1], topo_xyz[:, 2], s=0.25, c=\"b\")\nax.set_box_aspect(aspect=None, zoom=0.85)\nax.set_xlabel(\"X (m)\", labelpad=10)\nax.set_ylabel(\"Y (m)\", labelpad=10)\nax.set_zlabel(\"Z (m)\", labelpad=10)\nax.set_title(\"Topography (Exaggerated z-axis)\", fontsize=16, pad=-20)\nax.view_init(elev=45.0, azim=-125)","key":"MCDUfj3DzB"},{"type":"output","id":"U5KW6HIkxRYrGrjBj-T95","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d81beb4de34b86bd1abed80e44f58baf","path":"/user-tutorials/build/d81beb4de34b86bd1abed80e44f58baf.png"},"text/plain":{"content":"\u003cFigure size 600x600 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"AlL9FarNeL"}],"data":{"type":"notebook-code","scrolled":false},"key":"UKVGq5wn6G"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Survey","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WA5q2aHrUx"}],"identifier":"define-the-survey","label":"Define the Survey","html_id":"define-the-survey","implicit":true,"key":"szvgZOewSg"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Descriptions of the elements required to construct DC resistivity surveys were covered in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"t7VZuTnRwk"},{"type":"link","url":"/fwd-dcr-2d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"2.5D Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W6tLacJ5iI"}],"urlSource":"fwd_dcr_2d.ipynb","internal":true,"dataUrl":"/fwd-dcr-2d.json","protocol":"file","key":"xYEjEw6dfD"},{"type":"text","value":" tutorial. The only difference is that for 3D surveys, XYZ locations are required for each electrode location. Once again, there are three approaches one might use to generate the a DC resistivity survey. The final approach will be used to simulate the data for this tutorial.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JQknltaxrU"}],"key":"TRcZd37Lt6"}],"data":{"type":"notebook-content"},"key":"OtLZdM86wM"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Option A: Define each source and its associated receivers directly","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E1wCYvKFgK"}],"key":"O36YfzBQAJ"}],"key":"ZVPaOM1ezO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We used this approach in our ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lMINVTlLVx"},{"type":"link","url":"/fwd-dcr-2d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"2.5D Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iYDVjHs3n0"}],"urlSource":"fwd_dcr_2d.ipynb","internal":true,"dataUrl":"/fwd-dcr-2d.json","protocol":"file","key":"dWi6nWvWY3"},{"type":"text","value":" tutorial. For a 3D simulation however, current electrode locations are defined as (3,) ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EGprWwPrWq"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"numpy.array","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iMruxaiOAZ"}],"urlSource":"myst:numpy#numpy.array","internal":false,"protocol":"myst","key":"OaV1R6bVNY"},{"type":"text","value":" and the associated set of potential electrode locations are defined as (N, 3) ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f0jl4Ru4st"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"frXhyiVQfN"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"myst","key":"yAiOhUFDDu"},{"type":"text","value":". This approach is somewhat cumbersome for generating synthetic 3D examples, so we will use a survey generation utility instead (Option C).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VsWGhrjFNP"}],"key":"PPpmiXDMde"}],"data":{"type":"notebook-content"},"key":"xTe1UYQLAH"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Option B: Survey from ABMN electrode locations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wO7wiozukY"}],"key":"gDTKhyjkWp"}],"key":"kDEOjowgG6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If we have (N, 3) ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BhzBjSL0GN"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ggbZ22pM3Y"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"myst","key":"cIyCz0YtO9"},{"type":"text","value":" containing the A, B, M and N electrode locations for each datum (loaded or created), we can use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dwZY3TVTyj"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.utils.generate_survey_from_abmn_locations.html#simpeg.electromagnetics.static.utils.generate_survey_from_abmn_locations","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"generate​_survey​_from​_abmn​_locations","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GoSv3E6NLK"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.utils.generate_survey_from_abmn_locations","internal":false,"protocol":"myst","key":"LiuxhXgWzy"},{"type":"text","value":" to generate the survey automatically.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NTUtdvzKOz"}],"key":"BcxcaDuJBk"}],"data":{"type":"notebook-content"},"key":"Tj6MpMWmow"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Option C: Survey from a set of survey lines","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x0OrnEtoBi"}],"key":"Wlc9qdSF9M"}],"key":"PpXLnFwu8S"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If the survey is comprised of a set of DC resistivity lines, we can use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ssevBZA19d"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.utils.generate_dcip_sources_line.html#simpeg.electromagnetics.static.utils.generate_dcip_sources_line","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"generate​_dcip​_sources​_line","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EARIZaghFl"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.utils.generate_dcip_sources_line","internal":false,"protocol":"myst","key":"PoitRLjgH2"},{"type":"text","value":" utility function to define the survey. Here we define the DC resistivity survey that is used simulate the tutorial data. The survey consists of 3 DC resistivity lines that use a dipole-dipole electrode configuration; 1 line along the East-West direction and 2 lines along the North-South direction. Each line is 2000 m in length and has an electrode spacing of 100 m.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n3m6CvlOe4"}],"key":"sH87tYthbq"}],"data":{"type":"notebook-content"},"key":"dwFLl1ULEQ"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Define the parameters for each survey line\nsurvey_type = \"dipole-dipole\"\ndata_type = \"volt\"\ndimension_type = \"3D\"\nend_locations_list = [\n    np.r_[-1000.0, 1000.0, 0.0, 0.0],\n    np.r_[-600.0, -600.0, -1000.0, 1000.0],\n    np.r_[-300.0, -300.0, -1000.0, 1000.0],\n    np.r_[0.0, 0.0, -1000.0, 1000.0],\n    np.r_[300.0, 300.0, -1000.0, 1000.0],\n    np.r_[600.0, 600.0, -1000.0, 1000.0],\n]  # [x0, x1, y0, y1]\nstation_separation = 100.0\nnum_rx_per_src = 8\n\n# The source lists for each line can be appended to create the source\n# list for the whole survey.\nsource_list = []\nfor ii in range(0, len(end_locations_list)):\n    source_list += generate_dcip_sources_line(\n        survey_type,\n        data_type,\n        dimension_type,\n        end_locations_list[ii],\n        topo_xyz,\n        num_rx_per_src,\n        station_separation,\n    )\n\n# Define the survey\nsurvey = dc.survey.Survey(source_list)","key":"fz8GUs41t0"},{"type":"output","id":"3fGSlH9Aasb3j_jxop1XB","data":[],"key":"v8DcODxVgy"}],"data":{"type":"notebook-code"},"key":"U446QEEjbD"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here we plot the electrode locations. We use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C9DARiLsND"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Survey.unique_electrode_locations.html#simpeg.electromagnetics.static.resistivity.survey.unique_electrode_locations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"unique​_electrode​_locations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nmV6gp2ez9"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.resistivity.Survey.unique_electrode_locations","internal":false,"protocol":"myst","key":"EWT8cCOvT1"},{"type":"text","value":" method to extract the unique electrode locations from the survey and the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FF14tGCznr"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.utils.pseudo_locations.html#simpeg.electromagnetics.static.utils.pseudo_locations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"pseudo_locations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j3u9xv4018"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.utils.pseudo_locations","internal":false,"protocol":"myst","key":"QEUWuOG7F6"},{"type":"text","value":" utility to extract the pseudo-location.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FecLmqlC8s"}],"key":"hPsuZM4oyM"}],"data":{"type":"notebook-content"},"key":"C9xvcIdhrZ"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"unique_locations = survey.unique_electrode_locations\nfig = plt.figure(figsize=(12, 2.75))\nax1 = fig.add_axes([0.1, 0.1, 0.2, 0.8])\nax1.scatter(unique_locations[:, 0], unique_locations[:, 1], 8, \"r\")\nax1.set_xlabel(\"x (m)\")\nax1.set_ylabel(\"y (m)\")\nax1.set_title(\"Horizontal locations\")\n\npseudo_locations_xyz = pseudo_locations(survey)\ninds = pseudo_locations_xyz[:, 1] == 0.0\nax2 = fig.add_axes([0.4, 0.1, 0.55, 0.8])\nax2.scatter(pseudo_locations_xyz[inds, 0], pseudo_locations_xyz[inds, -1], 8, \"r\")\nax2.set_xlabel(\"x (m)\")\nax2.set_ylabel(\"z (m)\")\nax2.set_title(\"Pseudo-locations (EW line)\")\nplt.show()","key":"HI5R5fLoTl"},{"type":"output","id":"d5peGE5toyhKkbJG_hOuO","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"53f0aaa45860a660279e1124e77291fa","path":"/user-tutorials/build/53f0aaa45860a660279e1124e77291fa.png"},"text/plain":{"content":"\u003cFigure size 1200x275 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"lgVvCj0YEc"}],"data":{"type":"notebook-code"},"key":"C39NCA5tbv"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a (Tree) Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MLkeLtphWx"}],"identifier":"design-a-tree-mesh","label":"Design a (Tree) Mesh","html_id":"design-a-tree-mesh","implicit":true,"key":"JcVu2v1Q4o"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Standard approach for DC/IP:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"akfgzo1QqY"}],"key":"MY9dn7K0Lf"},{"type":"text","value":" The standard approach presented in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XpK3FvL6Ix"},{"type":"link","url":"/fwd-dcr-2d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"2.5D Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Rluk0r2ko8"}],"urlSource":"fwd_dcr_2d.ipynb","internal":true,"dataUrl":"/fwd-dcr-2d.json","protocol":"file","key":"wpfSp4eSso"},{"type":"text","value":" tutorial also applies to forward simulations in 3D. And the same methods are used to refine the tree mesh around electrodes, topography, etc... For 3D simulations however, we may need to consider limitations in computational resources which are not encountered in 2.5D simulations. Because 3D simulations require discretization along a third direction, the number of cells in the mesh is proportional ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EHgEdGCOdS"},{"type":"inlineMath","value":"h^{-3}","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003eh\u003c/mi\u003e\u003cmrow\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e3\u003c/mn\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eh^{-3}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eh\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e−\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e3\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"lWHWYtIwfo"},{"type":"text","value":"; where ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WNpP2kXpIK"},{"type":"inlineMath","value":"h","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eh\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eh\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eh\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"zMZQuNuuRu"},{"type":"text","value":" is the minimum cell edge length. Therefore the minimum cell size used for 3D simulations is generally coarser than the minimum cell size used for 2.5D simulations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"doDTg78puK"}],"key":"Um8r9mnPHU"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Tutorial mesh:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nwZy08CvE0"}],"key":"R9DN6WxhJ5"},{"type":"text","value":" Here, a minimum cell width of 25 m (or 1/4 the minimum electrode spacing) is used within our survey region. The largest electrode spacing was 1000 m, so a the padding was extended at least 3000 m from the survey region. Using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lQ5qOn9r4Y"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_surface.html#discretize.treemesh.refine_surface","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"refine_surface","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HpeKqti5dG"}],"urlSource":"myst:discretize#discretize.TreeMesh.refine_surface","internal":false,"protocol":"myst","key":"RG254aTuYV"},{"type":"text","value":" method, we refine the tree mesh where there is significant topography. And using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"P3bIPfc6pJ"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_points.html#discretize.treemesh.refine_points","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"refine_points","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SiJuMEHyWN"}],"urlSource":"myst:discretize#discretize.TreeMesh.refine_points","internal":false,"protocol":"myst","key":"m8CgHnTvG2"},{"type":"text","value":" methods, we refine based on electrodes locations. Visit the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qXbtPrL5Bs"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"tree mesh","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"W5aCVgsQAz"}],"urlSource":"myst:discretize#discretize.TreeMesh","internal":false,"protocol":"myst","key":"f9a20tnPXL"},{"type":"text","value":" API to see additional refinement methods.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jt3xww78jG"}],"key":"E7oEE7SO3C"}],"data":{"type":"notebook-content"},"key":"TeoQyHQ5h9"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Defining domain size and minimum cell size\ndh = 25.0  # base cell width\ndom_width_x = 8000.0  # domain width x\ndom_width_y = 8000.0  # domain width y\ndom_width_z = 4000.0  # domain width z\n\n# Number of base mesh cells in each direction. Must be a power of 2\nnbcx = 2 ** int(np.round(np.log(dom_width_x / dh) / np.log(2.0)))  # num. base cells x\nnbcy = 2 ** int(np.round(np.log(dom_width_y / dh) / np.log(2.0)))  # num. base cells y\nnbcz = 2 ** int(np.round(np.log(dom_width_z / dh) / np.log(2.0)))  # num. base cells z\n\n# Define the base mesh\nhx = [(dh, nbcx)]\nhy = [(dh, nbcy)]\nhz = [(dh, nbcz)]\nmesh = TreeMesh([hx, hy, hz], x0=\"CCN\")\n\n# Shift top to maximum topography\nmesh.origin = mesh.origin + np.r_[0.0, 0.0, z_topo.max()]\n\n# Mesh refinement based on surface topography\nk = np.sqrt(np.sum(topo_xyz[:, 0:2] ** 2, axis=1)) \u003c 1200\nmesh.refine_surface(topo_xyz[k, :], padding_cells_by_level=[0, 4, 4], finalize=False)\n\n# Mesh refinement near electrodes.\nmesh.refine_points(unique_locations, padding_cells_by_level=[6, 6, 4], finalize=False)\n\n# Finalize the mesh\nmesh.finalize()","key":"QIX434W0TY"},{"type":"output","id":"qCxNX081jMnEorOya_SIq","data":[],"key":"JsXUGSKcOX"}],"data":{"type":"notebook-code"},"key":"nprs9zGkKw"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zGoXc1xh0V"}],"identifier":"define-the-active-cells","label":"Define the Active Cells","html_id":"define-the-active-cells","implicit":true,"key":"tP6ZiNBQfB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Simulated geophysical data are dependent on the subsurface distribution of physical property values. As a result, the cells lying below the surface topography are commonly referred to as ‘active cells’. And air cells, whose physical property values are fixed, are commonly referred to as ‘inactive cells’. Here, the discretize ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eN9MDDoMAQ"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ta3O9ODivb"}],"urlSource":"myst:discretize#discretize.utils.active_from_xyz","internal":false,"protocol":"myst","key":"Rv6MEJcHkd"},{"type":"text","value":" utility function is used to find the indices of the active cells using the mesh and surface topography. The output quantity is a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m4kVShkhPr"},{"type":"inlineCode","value":"bool","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xn5KOHHyo0"},{"type":"text","value":" array.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OgyHBaUKbC"}],"key":"MTvrwKF6ds"}],"data":{"type":"notebook-content"},"key":"WuStpZQdDM"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Indices of the active mesh cells from topography (e.g. cells below surface)\nactive_cells = active_from_xyz(mesh, topo_xyz)\n\n# number of active cells\nn_active = np.sum(active_cells)","key":"BseNCuV8el"},{"type":"output","id":"2z9ATIs_HYzdCa29MV9ca","data":[],"key":"eYtuYhtT04"}],"data":{"type":"notebook-code"},"key":"i0fN5kOnLf"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Models and Mappings","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JqWM9glmTC"}],"identifier":"models-and-mappings","label":"Models and Mappings","html_id":"models-and-mappings","implicit":true,"key":"AV1jZXToeL"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"In SimPEG, the term ‘model’ is not necessarily synonymous with the set of physical property values defined on the mesh. For example, the model may be defined as the logarithms of the physical property values, or be the parameters defining a layered Earth geometry. Models in SimPEG are 1D ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZveTVaQrju"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ojdtom707k"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"myst","key":"pK6l3qJODM"},{"type":"text","value":" whose lengths are\nequal to the number of model parameters.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dqHXEVdCan"}],"key":"Ir8nH3VjIH"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Classes within the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"m2Id2oE9gR"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.IdentityMap.html#simpeg.maps.identitymap","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"SimPEG.maps","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"i75IeQJ7R0"}],"urlSource":"myst:SimPEG#SimPEG.maps.IdentityMap","internal":false,"protocol":"myst","key":"CBOc0ANMGw"},{"type":"text","value":" module are used to define the mapping that connects the model to the physical property values used in the DC resistivity simulation. Sophisticated mappings can be defined by combining multiple mapping objects. But in the simplest case, the mapping is an identity map and the model consists of the conductivity/resistivity values for all mesh cells (including air).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Crera1u5hE"}],"key":"oQQNpfz1It"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"When simulating DC resistivity data, we have the choice of using resistivity or conductivity to define the Earth’s electrical properties. Here, we define the model and its associate mapping for two cases:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"t7gOsTIwWd"}],"key":"kC9G7A2uAe"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The model consists of the conductivity values for all active cells","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"bIKZYE6ue9"}],"key":"vAzkv24Hir"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"The model consists of the log-resistivity values for all active cells","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"MGv62Wh6oC"}],"key":"NWVil2MlpV"}],"key":"Gzy714rq3o"}],"data":{"type":"notebook-content"},"key":"SGQ70mrdzO"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tYKIjhzQYk"}],"identifier":"define-the-model","label":"Define the Model","html_id":"define-the-model","implicit":true,"key":"AYBafMbDKQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The units for resistivity are ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AJ1MPheNo9"},{"type":"inlineMath","value":"\\Omega m","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003eΩ\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\Omega m\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003eΩ\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"AQ6kFzdTCw"},{"type":"text","value":" and the units for conductivity are ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jF4zIEAlJv"},{"type":"inlineMath","value":"S/m","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eS\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e/\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eS/m\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\"\u003eS\u003c/span\u003e\u003cspan class=\"mord\"\u003e/\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"SsY75B9lih"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mV1cDX5Bvk"}],"key":"HektHmknxd"}],"data":{"type":"notebook-content"},"key":"Gie361oTI8"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Define conductivity values in S/m (take reciprocal for resistivities in Ohm m)\nair_conductivity = 1e-8\nbackground_conductivity = 1e-2\nconductor_conductivity = 1e-1\nresistor_conductivity = 1e-3","key":"EEWdP1eO3j"},{"type":"output","id":"5VaRpmXEdvGSvGsOeaxwJ","data":[],"key":"g8igfSEvQJ"}],"data":{"type":"notebook-code"},"key":"qdqPtJR7fP"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Define conductivity model\nconductivity_model = background_conductivity * np.ones(n_active)\n\nind_conductor = model_builder.get_indices_sphere(\n    np.r_[-300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]\n)\nconductivity_model[ind_conductor] = conductor_conductivity\n\nind_resistor = model_builder.get_indices_sphere(\n    np.r_[300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]\n)\nconductivity_model[ind_resistor] = resistor_conductivity\n\n# Define log-resistivity model\nlog_resistivity_model = np.log(1 / conductivity_model)","key":"HJXtYj9oXW"},{"type":"output","id":"Jm5OhY-s1_hpNpsUb47WL","data":[],"key":"oBE2mqhhMb"}],"data":{"type":"notebook-code"},"key":"B0D99KBViU"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping from the Model to the Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BY2asTdrj1"}],"identifier":"mapping-from-the-model-to-the-mesh","label":"Mapping from the Model to the Mesh","html_id":"mapping-from-the-model-to-the-mesh","implicit":true,"key":"AgKQiy0Pro"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For our first case, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RVvmwWFwQM"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.InjectActiveCells.html#simpeg.maps.injectactivecells","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG​.maps​.InjectActiveCells","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tgNfSSDS66"}],"urlSource":"myst:SimPEG#SimPEG.maps.InjectActiveCells","internal":false,"protocol":"myst","key":"wjgBduehnG"},{"type":"text","value":" mapping. This mapping projects quantities defined on the active cells to the entire mesh, and sets a constant value for all inactive cells. ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OlQbn2Cfks"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Important:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mFJ9YdqUid"}],"key":"HIg1wTSYbW"},{"type":"text","value":" we set all inactive (air) cells to 1e-8 S/m instead of 0. This is done to ensure that the linear system constructed to solve the PDE for the DC resistivity problem is well-conditioned.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ciaKgBfrPz"}],"key":"hHibYUqPgG"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For the second case, we use both the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nAcFEiP0NI"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.InjectActiveCells.html#simpeg.maps.injectactivecells","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"SimPEG​.maps​.InjectActiveCells","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dsOWvkVeZs"}],"urlSource":"myst:SimPEG#SimPEG.maps.InjectActiveCells","internal":false,"protocol":"myst","key":"enA7uPS0vD"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KxzA6VsrWV"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.ExpMap.html#simpeg.maps.expmap","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"SimPEG.maps.ExpMap","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wmwvhq4MzV"}],"urlSource":"myst:SimPEG#SimPEG.maps.ExpMap","internal":false,"protocol":"myst","key":"T8wIMOwN4m"},{"type":"text","value":" mappings; the latter of which takes the natural exponential. ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"cjWbmrFm44"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Important:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"X1gXCKtKnB"}],"key":"H26za80vww"},{"type":"text","value":" we set all inactive (air) cells to 1e8 ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KXOB67TWCQ"},{"type":"inlineMath","value":"\\Omega m","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003eΩ\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\Omega m\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003eΩ\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"z5gug16zYU"},{"type":"text","value":" instead of ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gbbhUrkrDO"},{"type":"text","value":"∞","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iVMTCTITra"},{"type":"text","value":". Once again, this is done to ensure that the linear system constructed to solve the PDE for the DC resistivity problem is well-conditioned.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MPOYV6E0sY"}],"key":"E3c1wRaqH9"}],"data":{"type":"notebook-content"},"key":"GUPFiZ014W"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Conductivity map. Model parameters are conductivities for all active cells.\nconductivity_map = maps.InjectActiveCells(mesh, active_cells, air_conductivity)\n\n# Resistivity map. Model parameters are log-resistivities for all active cells.\nlog_resistivity_map = maps.InjectActiveCells(\n    mesh, active_cells, 1 / air_conductivity\n) * maps.ExpMap(nP=n_active)","key":"JwDPmSalvK"},{"type":"output","id":"-n54xIJads2WWiuls5oWC","data":[],"key":"ZVuBzSc6y8"}],"data":{"type":"notebook-code"},"key":"kNRtbgZnYz"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the Model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ss7OH2N9MX"}],"identifier":"plot-the-model","label":"Plot the Model","html_id":"plot-the-model","implicit":true,"key":"VNPV5fW8wT"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To show the geometry of the problem, we plot the conductivity model using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jqcscVky4Y"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.plot_slice.html#discretize.treemesh.plot_slice","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plot_slice","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Uh3EJVCW72"}],"urlSource":"myst:discretize#discretize.TreeMesh.plot_slice","internal":false,"protocol":"myst","key":"UjSD9nmeDx"},{"type":"text","value":" method.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SRmLyQY3aY"}],"key":"BfkWXssEgf"}],"data":{"type":"notebook-content"},"key":"uRxGFNHQKo"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Generate a mapping to ignore inactice cells in plot\nplotting_map = maps.InjectActiveCells(mesh, active_cells, np.nan)","key":"blLFgHmUrz"},{"type":"output","id":"NDODT5GJ6vKunnXnJHC6X","data":[],"key":"v325ZhmwoY"}],"data":{"type":"notebook-code"},"key":"avbaOyDW3H"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(10, 4.5))\n\nnorm = LogNorm(vmin=1e-3, vmax=1e-1)\n\nax1 = fig.add_axes([0.15, 0.15, 0.68, 0.75])\nmesh.plot_slice(\n    plotting_map * conductivity_model,\n    ax=ax1,\n    normal=\"Y\",\n    ind=int(len(mesh.h[1]) / 2),\n    grid=True,\n    pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": norm},\n)\nax1.set_title(\"Conductivity Model\")\nax1.set_xlabel(\"x (m)\")\nax1.set_ylabel(\"z (m)\")\nax1.set_xlim([-1500, 1500])\nax1.set_ylim([z_topo.max() - 1500, z_topo.max()])\n\nax2 = fig.add_axes([0.84, 0.15, 0.03, 0.75])\ncbar = mpl.colorbar.ColorbarBase(\n    ax2, cmap=mpl.cm.RdYlBu_r, norm=norm, orientation=\"vertical\"\n)\ncbar.set_label(\"$\\sigma$ [S/m]\", rotation=270, labelpad=15, size=16)","key":"g23eHpnjh0"},{"type":"output","id":"st1kMeeo26QAbrw8cpBYB","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6ed2a742d0f0aea11504adb92a0dc558","path":"/user-tutorials/build/6ed2a742d0f0aea11504adb92a0dc558.png"},"text/plain":{"content":"\u003cFigure size 1000x450 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"o8WzsiQ2Zf"}],"data":{"type":"notebook-code"},"key":"ZTvfxTS0cV"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Project Electrodes to Discretized Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n1fxErQOj3"}],"identifier":"project-electrodes-to-discretized-topography","label":"Project Electrodes to Discretized Topography","html_id":"project-electrodes-to-discretized-topography","implicit":true,"key":"NpoTz4bG5a"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Surface DC resistivity data will not be modeled accurately if the electrodes are modeled as living above or below the surface. It is especially problematic when electrodes are modeled as living in the air. Prior to simulating surface DC resistivity data, we must project the electrodes from their true elevation to the surface of the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MhYa5qOpv4"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretized","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fvlR9Lfx0G"}],"key":"DGQ34L7bvk"},{"type":"text","value":" topography. This is done using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YsyLv5i4C6"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Survey.drape_electrodes_on_topography.html#simpeg.electromagnetics.static.resistivity.survey.drape_electrodes_on_topography","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"drape​_electrodes​_on​_topography","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wd4FzzNIoS"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.resistivity.Survey.drape_electrodes_on_topography","internal":false,"protocol":"myst","key":"SJeYeMzWQW"},{"type":"text","value":" method.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lJqqmuvFEC"}],"key":"iFiSHC3g27"}],"data":{"type":"notebook-content"},"key":"uBXr7jqyHo"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"survey.drape_electrodes_on_topography(mesh, active_cells, option=\"top\")","key":"Ac2bOVTwlC"},{"type":"output","id":"tSql0oNqidNBoYDt5myKa","data":[],"key":"RBSjMUzaNE"}],"data":{"type":"notebook-code"},"key":"bf9qF9wC4k"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lZdf0ihexs"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation","implicit":true,"key":"PvpVwxK2Iw"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In SimPEG, the physics of the forward simulation is defined by creating an instance of an appropriate simulation class. There are two simulation classes which may be used to simulate 3D DC resistivity data:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rlscbm17hU"}],"key":"WccKDu9Uaq"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Simulation3DNodal.html#simpeg.electromagnetics.static.resistivity.simulation3dnodal","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Simulation3DNodel","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KsIn3ntCUO"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.resistivity.Simulation3DNodal","internal":false,"protocol":"myst","key":"tRguwv8T9A"},{"type":"text","value":", which defines the discrete electric potentials on mesh nodes.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PU0wLFQk1I"}],"key":"DBApiHPnrv"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Simulation3DCellCentered.html#simpeg.electromagnetics.static.resistivity.simulation3dcellcentered","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Simulation3DCellCentered","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Eoypr4YYJI"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.resistivity.Simulation3DCellCentered","internal":false,"protocol":"myst","key":"mepWStrSqr"},{"type":"text","value":", which defines the discrete electric potentials at cell centers.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"t7XIHxpfF7"}],"key":"vlyVRiYbUu"}],"key":"I0Ea1k2QgW"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"For surface DC resistivity data, the nodal formulation is more well-suited and will be used here. The cell-centered formulation works well for simulating borehole DC resistivity data. Here, we define two simulation objects, one where the model defines the subsurface conductivities, and one where the model defines subsurface log-resistivities. When our model is used to define subsurface electric conductivity, the mapping is set using the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"gEvU9xJPV7"},{"type":"inlineCode","value":"sigmaMap","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"itWNn6uVP2"},{"type":"text","value":" keyword argument. However when our model is used to define subsurface electric resistivity, the mapping must be set using the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Lhg4mekEzr"},{"type":"inlineCode","value":"rhoMap","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ZLSA8WWKYX"},{"type":"text","value":" keyword argument","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Yx8gbGWB7R"}],"key":"vG22mjiclF"}],"data":{"type":"notebook-content"},"key":"DwptEAb0RT"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# DC simulation for a conductivity model\nsimulation_con = dc.simulation.Simulation3DNodal(\n    mesh, survey=survey, sigmaMap=conductivity_map\n)\n\n# DC simulation for a log-resistivity model\nsimulation_res = dc.simulation.Simulation3DNodal(\n    mesh, survey=survey, rhoMap=log_resistivity_map\n)","key":"ibNYLQLY7f"},{"type":"output","id":"nTowr7iDXuD8doz5ebR4X","data":[],"key":"WODzO3gtWW"}],"data":{"type":"notebook-code"},"key":"aXrzYUKoU5"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Predict DC Resistivity Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bCnm3KXCd1"}],"identifier":"predict-dc-resistivity-data","label":"Predict DC Resistivity Data","html_id":"predict-dc-resistivity-data","implicit":true,"key":"mTA5QJErAl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Once any simulation within SimPEG has been properly constructed, simulated data for a given model vector can be computed using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GYdbxicc4V"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.simulation.BaseSimulation.dpred.html#simpeg.simulation.basesimulation.dpred","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"dpred","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RDRWdn0D7t"}],"urlSource":"myst:SimPEG#SimPEG.simulation.BaseSimulation.dpred","internal":false,"protocol":"myst","key":"A0eZT43vhN"},{"type":"text","value":" method. Note that despite the difference in how we defined the models representing the Earth’s electrical properties, the data predicted by both simulations is equivalent.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AOyGqq46xy"}],"key":"qLCEmC0snC"}],"data":{"type":"notebook-content"},"key":"caDEOz9cZr"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"dpred_con = simulation_con.dpred(conductivity_model)","key":"yfwpmP1JfZ"},{"type":"output","id":"OBRez8oLib4nkOmrVcp8D","data":[],"key":"uQumE0D1AD"}],"data":{"type":"notebook-code"},"key":"EWcZTFZvnn"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"dpred_res = simulation_res.dpred(log_resistivity_model)","key":"w1Po1Y7q90"},{"type":"output","id":"6DRrK90bbd4AIGUXy6wkG","data":[],"key":"TMMrgBf0sB"}],"data":{"type":"notebook-code"},"key":"cE0jQdrHVw"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"MAX ABSOLUTE ERROR = {}\".format(np.max(np.abs(dpred_con - dpred_res))))","key":"BftAxJukx9"},{"type":"output","id":"12Sq7HzVfu3Xbbg6nKTPz","data":[{"name":"stdout","output_type":"stream","text":"MAX ABSOLUTE ERROR = 5.551115123125783e-16\n"}],"key":"plwvUtkTKB"}],"data":{"type":"notebook-code"},"key":"dNdxgqogTt"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Convert Normalized Voltages to Apparent Conductivities","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HcCZeKcOwT"}],"identifier":"convert-normalized-voltages-to-apparent-conductivities","label":"Convert Normalized Voltages to Apparent Conductivities","html_id":"convert-normalized-voltages-to-apparent-conductivities","implicit":true,"key":"kvnV5IyP8v"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this tutorial, the receivers were defined to simulation normalized voltage data. Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dlFokucLeh"},{"type":"link","url":"SimPEG#SimPEG.electromagnetics.static.utils.apparent_resistivity_from_voltage","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"apparent​_resistivity​_from​_voltage","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"v8yaBVqTgI"}],"urlSource":"SimPEG#SimPEG.electromagnetics.static.utils.apparent_resistivity_from_voltage","key":"qglo6oQHCb"},{"type":"text","value":" utility function to convert the data to apparent resistivities, then take the reciprocal to obtain apparent conductivities.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e1eJMKNqlY"}],"key":"nxAKU647k4"}],"data":{"type":"notebook-content"},"key":"l5F2XFoV9p"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"apparent_conductivity = apparent_resistivity_from_voltage(survey, dpred_con) ** -1","key":"aiXqw7dDmA"},{"type":"output","id":"uSLZqD_LI_gQ2qK84TFzm","data":[],"key":"FmEksOfGD2"}],"data":{"type":"notebook-code"},"key":"ZZhiNiLWZT"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Data in Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bxiT3DO4zD"}],"identifier":"plot-data-in-pseudosection","label":"Plot Data in Pseudosection","html_id":"plot-data-in-pseudosection","implicit":true,"key":"P3GOHYt0nA"}],"data":{"type":"notebook-content"},"key":"Q4Bpkw6QCQ"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot 3D Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o0mQprEm4c"}],"identifier":"plot-3d-pseudosection","label":"Plot 3D Pseudosection","html_id":"plot-3d-pseudosection","implicit":true,"key":"rIyy1G1cAz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For general 3D survey configurations, we can use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XBW8c1gXiM"},{"type":"link","url":"SimPEG#SimPEG.electromagnetics.static.utils.plot_3d_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plot​_3d​_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jUWRtZRlxf"}],"urlSource":"SimPEG#SimPEG.electromagnetics.static.utils.plot_3d_pseudosection","key":"SCpHocbS6C"},{"type":"text","value":" utility function to plot 3D pseudosection data. For large datasets or for surveys with unconventional electrode geometry, interpretation can be challenging if we plot every datum. Here, we plot 3 out of the 6 survey lines to better image anomalous structures. To plot ALL of the data, simply remove the keyword argument ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"T4RwH3bCEz"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plane_points","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ggXdqjwgDz"}],"key":"V5GtERP4FI"},{"type":"text","value":" when calling ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FGlrYmfhQa"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plot_3d_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"caejVuC18W"}],"key":"VFLPzDxkp3"},{"type":"text","value":". To use this utility, you must have Python’s ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xlHEH0iEJt"},{"type":"link","url":"https://plotly.com/python/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plotly","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fIhBTrcI3w"}],"urlSource":"https://plotly.com/python/","key":"GwTOBxrkWP"},{"type":"text","value":" package.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zBv50XqaNg"}],"key":"fLjUdC9fXV"}],"data":{"type":"notebook-content"},"key":"HFOVRuD1nr"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Empty list for plane points\nplane_points = []\n\n# 3-points defining the plane for EW survey line\np1, p2, p3 = np.array([-1000, 0, 0]), np.array([1000, 0, 0]), np.array([0, 0, -1000])\nplane_points.append([p1, p2, p3])\n\n# NS at x = -300 m\np1, p2, p3 = (\n    np.array([-300, -1000, 0]),\n    np.array([-300, 1000, 0]),\n    np.array([-300, 0, -1000]),\n)\nplane_points.append([p1, p2, p3])\n\n# NS at x = 300 m\np1, p2, p3 = (\n    np.array([300, -1000, 0]),\n    np.array([300, 1000, 0]),\n    np.array([300, 0, -1000]),\n)\nplane_points.append([p1, p2, p3])","key":"fLUhyY8FAj"},{"type":"output","id":"xq9gqbJAUhFyQE3ich0Yc","data":[],"key":"s4Ar0qgy8w"}],"data":{"type":"notebook-code"},"key":"ouw7QwQhEc"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"if has_plotly:\n    fig = plot_3d_pseudosection(\n        survey,\n        apparent_conductivity,\n        scale=\"log\",\n        units=\"S/m\",\n        plane_points=plane_points,\n        plane_distance=15,\n        marker_opts={\"colorscale\": \"RdYlBu_r\"},\n    )\n\n    fig.update_layout(\n        title_text=\"Apparent Conductivity\",\n        title_x=0.5,\n        title_font_size=24,\n        width=650,\n        height=500,\n        scene_camera=dict(center=dict(x=0.05, y=0, z=-0.4)),\n    )\n\n    #     plotly.io.show(fig)\n    html_str = plotly.io.to_html(fig)\n    display(HTML(html_str))\n\nelse:\n    print(\"INSTALL 'PLOTLY' TO VISUALIZE 3D PSEUDOSECTIONS\")","key":"OejHgBLVGt"},{"type":"output","id":"seR_szLdBiXBQdRbwgSlM","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"37b4e9ea4a0815bb48b3a35d8b03e6de","path":"/user-tutorials/build/37b4e9ea4a0815bb48b3a35d8b03e6de.html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}}],"key":"gZf8rFxUoL"}],"data":{"type":"notebook-code","scrolled":false},"key":"aE6csW2YNm"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Individual Lines in 2D Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ses7m4xT6m"}],"identifier":"plot-individual-lines-in-2d-pseudosection","label":"Plot Individual Lines in 2D Pseudosection","html_id":"plot-individual-lines-in-2d-pseudosection","implicit":true,"key":"I1a6LHF0Lc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For conventional DC resistivity surveys, the electrodes are located along a set of survey lines. If we know which the survey line associated with each datum, we can parse the 3D survey into a set of 2D survey lines. Then we can plot individual pseudosections for each survey line. Here, we have 6 survey lines, each of which has the same number of data. So assigning a line ID to each datum is easy. You may need to do something more sophisticated in other cases.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"K8gZn1DNSz"}],"key":"GnyzAvkpdM"}],"data":{"type":"notebook-content"},"key":"yhzm4YnGMR"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# line IDs\nn_lines = len(end_locations_list)\nn_data_per_line = int(survey.nD / n_lines)\nlineID = np.hstack([(ii + 1) * np.ones(n_data_per_line) for ii in range(n_lines)])","key":"Fwxml6FFdR"},{"type":"output","id":"idvCdJV4ZcK1xxiXCS1BX","data":[],"key":"uTHtxIBazN"}],"data":{"type":"notebook-code"},"key":"GwxyUCzLWX"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lxthEaDkxx"},{"type":"link","url":"SimPEG#SimPEG.electromagnetics.static.utils.convert_survey_3d_to_2d_lines","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"convert​_survey​_3d​_to​_2d​_lines","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j2sT1s4dgO"}],"urlSource":"SimPEG#SimPEG.electromagnetics.static.utils.convert_survey_3d_to_2d_lines","key":"AMPGLz9knm"},{"type":"text","value":" to generate the list of 2D surveys.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PfUUTRqjkf"}],"key":"KAwIOoWXhJ"}],"data":{"type":"notebook-content"},"key":"P8SjUUQ6ZW"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"survey_2d_list, index_list = convert_survey_3d_to_2d_lines(\n    survey, lineID, data_type=\"volt\", output_indexing=True\n)","key":"k6A0LoOx3Y"},{"type":"output","id":"W5_-B3W2Bz83wDZPXQ4zM","data":[],"key":"C1YYH0fhFl"}],"data":{"type":"notebook-code"},"key":"YbkMElr6k5"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, we create list of 2D apparent conductivities. Note that if you converted observed data then computed apparent conductivities, you would be doing so assuming 2D survey geometry and the values would not match those on the 3D pseudosection plot!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uj19xsPwVp"}],"key":"UKKXuCRaMp"}],"data":{"type":"notebook-content"},"key":"fuzQrKY5m3"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"dobs_2d_list = []\napparent_conductivities_2d = []\nfor ind in index_list:\n    dobs_2d_list.append(dpred_con[ind])\n    apparent_conductivities_2d.append(apparent_conductivity[ind])","key":"ZXfI9OK1ee"},{"type":"output","id":"g3vBmMDibHT3INLi1mTrw","data":[],"key":"LXDfUusXCv"}],"data":{"type":"notebook-code"},"key":"fvUWmVjIw5"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we can use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"csrte6qlEU"},{"type":"link","url":"SimPEG#SimPEG.electromagnetics.static.utils.plot_2d_pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"plot​_2d​_pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EM2i7TQ0kb"}],"urlSource":"SimPEG#SimPEG.electromagnetics.static.utils.plot_2d_pseudosection","key":"NhiAQW9KyQ"},{"type":"text","value":" utility function to plot the pseudosection for the desired survey line.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f9mlmzKKLo"}],"key":"FNsD5b91be"}],"data":{"type":"notebook-content"},"key":"OBZpKfoj9U"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Line index\nline_ind = 0\n\n# Plot apparent conductivity pseudo-section\nfig = plt.figure(figsize=(8, 2.75))\nax1 = fig.add_axes([0.1, 0.15, 0.75, 0.78])\nplot_pseudosection(\n    survey_2d_list[line_ind],\n    dobs=apparent_conductivities_2d[line_ind],\n    plot_type=\"contourf\",\n    ax=ax1,\n    scale=\"log\",\n    cbar_label=\"S/m\",\n    mask_topography=True,\n    contourf_opts={\"levels\": 20, \"cmap\": mpl.cm.RdYlBu_r},\n)\nax1.set_title(\"Apparent Conductivity\")\nplt.show()","key":"xSyXQPP0Yx"},{"type":"output","id":"zFEZH5jBTD8W-kKkEn4mD","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"de226d8af961c25413870fb048140271","path":"/user-tutorials/build/de226d8af961c25413870fb048140271.png"},"text/plain":{"content":"\u003cFigure size 800x275 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"TcUn17LGIN"}],"data":{"type":"notebook-code"},"key":"JI1l4pmJX0"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optional:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WqqiaviTol"}],"key":"H37QD1BU5m"},{"type":"text","value":" Write DC resistivity data and topography.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ged3KZ2JkX"}],"key":"sgyraPAxVZ"}],"data":{"type":"notebook-content"},"key":"WKvremEmK5"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"if write_output:\n    dir_path = os.path.sep.join([\".\", \"fwd_dcr_3d_outputs\"]) + os.path.sep\n    if not os.path.exists(dir_path):\n        os.mkdir(dir_path)\n\n    # Add 10% Gaussian noise to each datum\n    np.random.seed(433)\n    std = 0.1 * np.abs(dpred_con)\n    noise = std * np.random.normal(size=len(dpred_con))\n    dobs = dpred_con + noise\n\n    # Create dictionary that stores line IDs\n    out_dict = {\"LINEID\": lineID}\n\n    # Create a survey with the original electrode locations\n    # and not the shifted ones\n    source_list = []\n    for ii in range(n_lines):\n        source_list += generate_dcip_sources_line(\n            survey_type,\n            data_type,\n            dimension_type,\n            end_locations_list[ii],\n            topo_xyz,\n            num_rx_per_src,\n            station_separation,\n        )\n    survey_original = dc.survey.Survey(source_list)\n\n    # Write out data at their original electrode locations (not shifted)\n    data_obj = data.Data(survey_original, dobs=dobs, standard_deviation=std)\n\n    fname = dir_path + \"dc_data.xyz\"\n    write_dcip_xyz(\n        fname,\n        data_obj,\n        data_header=\"V/A\",\n        uncertainties_header=\"UNCERT\",\n        out_dict=out_dict,\n    )\n\n    fname = dir_path + \"topo_xyz.txt\"\n    np.savetxt(fname, topo_xyz, fmt=\"%.4e\")","key":"OhNnF2Knga"},{"type":"output","id":"mVOUYSn8ELIxGkvGEJlrM","data":[{"name":"stdout","output_type":"stream","text":"XYZ file saved to: .\\fwd_dcr_3d_outputs\\dc_data.xyz\n"}],"key":"VZLjlXwO9C"}],"data":{"type":"notebook-code"},"key":"vxSrAA6gLT"}],"key":"F9UmZDqZVl"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"2.5D Forward Simulation","url":"/fwd-dcr-2d","group":"SimPEG User Tutorials"},"next":{"title":"1D Inversion for a Single Sounding","url":"/inv-dcr-1d","group":"SimPEG User Tutorials"}}},"domain":"http://localhost:3000"}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":false,"v2_headers":true,"v2_meta":false,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/user-tutorials/build/manifest-FDC5A112.js";
import * as route0 from "/user-tutorials/build/root-2CYAF5SQ.js";
import * as route1 from "/user-tutorials/build/routes/$-ZDWRJY4B.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/user-tutorials/build/entry.client-K6EYMIDZ.js");</script></body></html>