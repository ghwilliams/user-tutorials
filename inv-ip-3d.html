<!DOCTYPE html><html lang="en" class="light" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>SimPEG User Tutorials</title><link rel="stylesheet" href="/user-tutorials/build/_assets/app-LVHQOBTF.css"/><link rel="stylesheet" href="/user-tutorials/build/_assets/thebe-core-SJEQ5G4L.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><script defer="" data-domain="simpeg.xyz" src="https://plausible.io/js/plausible.js"></script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 fixed w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-wrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zM3 12a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/user-tutorials/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button class="theme rounded-full border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Change theme to dark mode." aria-label="Change theme to dark mode."><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-full w-full p-0.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"></path></svg></button><div class="block sm:hidden"><div class="relative" data-headlessui-state=""><div><button class="flex text-sm bg-transparent rounded-full focus:outline-none" id="headlessui-menu-button-:Rciop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open Menu</span><div class="flex items-center text-stone-200 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="2rem" height="2rem" class="p-1"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm0 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm0 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z" clip-rule="evenodd"></path></svg></div></button></div></div></div><div class="hidden sm:block"><a href="https://mystmd.org/guide" target="_blank" rel="noopener noreferrer" class="inline-block px-4 py-2 mx-1 mt-0 leading-none border rounded text-md border-stone-700 dark:border-white text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 hover:bg-neutral-100">Learn More</a></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><nav aria-label="Table of Contents" class="flex-grow overflow-y-auto transition-opacity mt-6 pb-3 ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="SimPEG User Tutorials" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/user-tutorials/">SimPEG User Tutorials</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Gravity" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/gravity-index">Gravity</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R2d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R2d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Magnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/magnetics-index">Magnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R3d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R3d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Direct Current Resistivity" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/dcr-index">Direct Current Resistivity</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R4d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R4d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Induced Polarization" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/ip-index">Induced Polarization</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R5d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R5d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Frequency-Domain Electromagnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/fdem-index">Frequency-Domain Electromagnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R6d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R6d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time-Domain Electromagnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/tdem-index">Time-Domain Electromagnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R7d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R7d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Uncertainty and Resolution analysis" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/uran-index">Uncertainty and Resolution analysis</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" type="button" aria-controls="radix-:R8d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R8d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav><div class="flex-none py-4 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap" style="margin-top:60px"><main class="article-grid subgrid-gap col-screen"><div class="sticky z-10 hidden h-0 col-margin-right-inset lg:block" style="top:60px"><nav></nav></div><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="pt-5 mb-8"><div class="flex items-center h-6 mt-3 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/simpeg/user-tutorials" title="GitHub Repository: simpeg/user-tutorials" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative" id="headlessui-menu-button-:R1khtop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="ml-2 -mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">3D IP Inversion</h1></div><div id="skip-to-article"></div><div id="ZrbxHOMgJg" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-amber-600"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Intermediate notebook</div></div><div class="px-4 py-1"><p>This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.</p></div></aside></div><div id="udUY1mPfq8" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-amber-600"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Medium-weight notebook</div></div><div class="px-4 py-1"><p>Requires moderate computational resources. Run-times may exceed several minutes and require up to 8 GB of available RAM.</p></div></aside></div><div id="Q2j4kRnFKV" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Author:</strong> Devin C. Cowan</p><p><strong>Keywords:</strong> induced polarization, 3D inversion, sparse norm, tree mesh.</p><p><strong>Summary:</strong> Here we invert apparent chargeability data to recover the subsurface chargeability distribution on a tree mesh. We demonstrate two inversion approaches for recovering a chargeability model:</p><ol start="1"><li>Weighted least-squares inversion</li><li>Iteratively re-weighted least-squares (IRLS) inversion</li></ol><p>Almost all of the details of defining and carrying out weighted least-squares and iteratively weighted least squares inversion were covered in the <a target="_blank" href="fwd_dcip_3d.ipynb" rel="noreferrer">3D DC Resistivity Inversion</a> tutorial. And functionality specific to defining the IP forward simulation was covered in the <a target="_blank" href="fwd_dcip_3d.ipynb" rel="noreferrer">3D IP Forward Simulation</a> tutorial. As we will focus primarily on content specific to IP inversion, we strongly urge the reader to work through the aforementioned tutorials prior to working through this one.</p><p><strong>Learning Objectives:</strong></p><ul><li>Assigning appropriate uncertainties to IP data</li><li>Designing a mesh for IP inversion</li><li>Obtaining a background conductivity/resistivity model for the IP inversion</li><li>Analyzing inversion results</li></ul></div><div id="qKbaRNYDcc" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="import-modules" class="relative group"><span class="heading-text">Import Modules</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#import-modules" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we import all of the functionality required to run the notebook for the tutorial exercise.
All of the functionality specific to IP is imported from <a target="_blank" href="https://docs.simpeg.xyz/content/api/SimPEG.electromagnetics.static.induced_polarization.html#module-simpeg.electromagnetics.static.induced_polarization" rel="noreferrer">SimPEG<wbr/>.electromagnetics<wbr/>.static<wbr/>.induced<wbr/>_polarization</a>.
We also import some useful utility functions from <a target="_blank" href="https://docs.simpeg.xyz/content/api/SimPEG.utils.html#module-simpeg.utils" rel="noreferrer">SimPEG.utils</a>. Classes required to define the data misfit, regularization, optimization, etc... are imported from elsewhere within SimPEG. We also import some useful utility functions from <a target="_blank" href="https://docs.simpeg.xyz/content/api/SimPEG.utils.html#module-simpeg.utils" rel="noreferrer">SimPEG.utils</a>. To generate the mesh used for the inversion, we use the <a target="_blank" href="https://discretize.simpeg.xyz/en/main" rel="noreferrer">discretize</a> package.</p></div><div id="RQKHb6zNgp" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># SimPEG functionality
from SimPEG.electromagnetics.static import induced_polarization as ip
from SimPEG.electromagnetics.static.utils.static_utils import (
    plot_pseudosection,
    apparent_resistivity_from_voltage,
    convert_survey_3d_to_2d_lines,
)
from SimPEG.utils.io_utils.io_utils_electromagnetics import read_dcip_xyz
from SimPEG.utils import download, model_builder
from SimPEG import (
    maps,
    data,
    data_misfit,
    regularization,
    optimization,
    inverse_problem,
    inversion,
    directives,
)

try:
    import plotly
    from SimPEG.electromagnetics.static.utils.static_utils import plot_3d_pseudosection
    from IPython.core.display import display, HTML

    has_plotly = True
except ImportError:
    has_plotly = False
    pass

# discretize functionality
from discretize import TreeMesh
from discretize.utils import mkvc, active_from_xyz

# Basic Python functionality
import os
import tarfile
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
from matplotlib.colors import LogNorm, Normalize

mpl.rcParams.update({&quot;font.size&quot;: 16})</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="BGeHBsIjsiUf1zGaaOM7p" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>C:\Users\devin\AppData\Local\Temp\ipykernel_28068\924317488.py:23: DeprecationWarning: Importing display from IPython.core.display is deprecated since IPython 7.14, please import from IPython display
  from IPython.core.display import display, HTML
</span></code></pre></div></div></div><div id="JFdXLBHdYl" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="load-and-plot-tutorial-data" class="relative group"><span class="heading-text">Load and Plot Tutorial Data</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#load-and-plot-tutorial-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>For most geophysical inversion projects, a reasonable inversion result can be obtained so long as the practitioner has observed data, the survey geometry and topography. For this tutorial, the observed data and topography files are provided. Here, we download and import the observed data and topography into the SimPEG framework.</p></div><div id="trZPnIwOuD" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># URL to download from repository assets
data_source = &quot;https://github.com/simpeg/user-tutorials/raw/main/assets/06-ip/inv_ip_3d_files.tar.gz&quot;

# download the data
downloaded_data = download(data_source, overwrite=True)

# unzip the tarfile
tar = tarfile.open(downloaded_data, &quot;r&quot;)
tar.extractall()
tar.close()

# path to the directory containing our data
dir_path = downloaded_data.split(&quot;.&quot;)[0] + os.path.sep

# files to work with
topo_filename = dir_path + &quot;topo_xyz.txt&quot;
data_filename = dir_path + &quot;ip_data.xyz&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="FCkUK3T09Z0UeBsBl1ZIO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>overwriting D:\Documents\Repositories\user-tutorials\notebooks\06-ip\inv_ip_3d_files.tar.gz
Downloading https://github.com/simpeg/user-tutorials/raw/main/assets/06-ip/inv_ip_3d_files.tar.gz
   saved to: D:\Documents\Repositories\user-tutorials\notebooks\06-ip\inv_ip_3d_files.tar.gz
Download completed!
</span></code></pre></div></div></div><div id="B3i9XacPHk" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="load-the-topography" class="relative group"><span class="heading-text">Load the Topography</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#load-the-topography" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>For most geophysical inversion projects, a reasonable inversion result can be obtained so long as the practitioner has observed data, the survey geometry and topography. For this tutorial, the observed data and topography files are provided. Here, we download and import the observed data and topography into the SimPEG framework.</p></div><div id="W5jjmwFIoH" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">topo_xyz = np.loadtxt(str(topo_filename))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="qV_Q9239VEt5FlaxRpI08" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="GyppMVfCQn" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(6, 6))
ax = fig.add_axes([0.1, 0.1, 0.8, 0.8], projection=&quot;3d&quot;)
ax.set_zlim([-400, 400])
ax.scatter3D(topo_xyz[:, 0], topo_xyz[:, 1], topo_xyz[:, 2], s=0.25, c=&quot;b&quot;)
ax.set_box_aspect(aspect=None, zoom=0.85)
ax.set_xlabel(&quot;X (m)&quot;, labelpad=10)
ax.set_ylabel(&quot;Y (m)&quot;, labelpad=10)
ax.set_zlabel(&quot;Z (m)&quot;, labelpad=10)
ax.set_title(&quot;Topography (Exaggerated z-axis)&quot;, fontsize=16, pad=-20)
ax.view_init(elev=45.0, azim=-125)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="qNKOzcB1ETIP9-TR1JrbR" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/50f453841c4178b0f4e6f13dee58b243.png" alt="&lt;Figure size 600x600 with 1 Axes&gt;"/></div></div><div id="z9ap4yX23w" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="load-ip-data" class="relative group"><span class="heading-text">Load IP Data</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#load-ip-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p><strong>Option A: DCIP3D formatted data</strong></p><p>The <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.utils.io_utils.read_dcip3d_ubc.html#simpeg.utils.io_utils.read_dcip3d_ubc" rel="noreferrer">read_dcip3d_ubc</a> utility function can be used to load DC/IP data stored in a UBC-GIF formatted file. This function outputs a SimPEG <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.data.Data.html#simpeg.data.data" rel="noreferrer">Data</a> object.</p></div><div id="eqCQHkJ3V8" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Option B: Load XYZ formatted data</strong></p><p>For this tutorial, the observed data are organized within an XYZ formatted file. We can use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.utils.io_utils.read_dcip_xyz.html#simpeg.utils.io_utils.read_dcip_xyz" rel="noreferrer">read_dcip_xyz</a> utility function to load data in this format. This function outputs a SimPEG <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.data.Data.html#simpeg.data.data" rel="noreferrer">Data</a> object. The data are apparent chargeabilities in V/V.</p><p>The <code>dict_headers</code> input argument can be used to import other data columns that are not required to define the SimPEG data object. In this case, we import a column that defines the survey line associated with each datum. We will use this to plot pseudosections for individual survey lines.</p></div><div id="kq5tUQFbTv" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">ip_data, out_dict = read_dcip_xyz(
    data_filename,
    &quot;apparent_chargeability&quot;,
    data_header=&quot;APP_CHG&quot;,
    uncertainties_header=&quot;UNCERT&quot;,
    is_surface_data=False,
    dict_headers=[&quot;LINEID&quot;],
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="OJLvjeIEbAEQB_w-xhhHc" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FPOfQGkT2o" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-observed-data-in-3d-pseudosection" class="relative group"><span class="heading-text">Plot Observed Data in 3D Pseudosection</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-observed-data-in-3d-pseudosection" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here we use the <a target="_blank" href="SimPEG#SimPEG.electromagnetics.static.utils.plot_3d_pseudosection" rel="noreferrer">plot<wbr/>_3d<wbr/>_pseudosection</a> utility function to represent the observed data in pseudosection. In this case, the apparent chargeabilities are represented in V/V.</p><p>In the case of secondary voltage data, you would need to convert the values to apparent chargeabilities. This accomplished by normalizing the secondary IP voltages by the DC voltages.</p></div><div id="GF9PkRjLyg" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">if has_plotly:
    fig = plot_3d_pseudosection(
        ip_data.survey,
        ip_data.dobs,
        scale=&quot;linear&quot;,
        units=&quot;V/V&quot;,
        vlim=[0, np.max(ip_data.dobs)],
        marker_opts={&quot;colorscale&quot;: &quot;plasma&quot;},
    )

    fig.update_layout(
        title_text=&quot;Apparent Chargeability&quot;,
        title_x=0.5,
        title_font_size=24,
        width=650,
        height=500,
        scene_camera=dict(
            center=dict(x=0, y=0, z=-0.4), eye=dict(x=1.5, y=-1.5, z=1.8)
        ),
    )

    #     plotly.io.show(fig)
    html_str = plotly.io.to_html(fig)
    display(HTML(html_str))

else:
    print(&quot;INSTALL &#x27;PLOTLY&#x27; TO VISUALIZE 3D PSEUDOSECTIONS&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="aQTbAxHsC4MSYu9jCJ7tE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="hUkFGIbp6M" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-observed-data-in-2d-pseudosection" class="relative group"><span class="heading-text">Plot Observed Data in 2D Pseudosection</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-observed-data-in-2d-pseudosection" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>As demonstrated in the <a target="_blank" href="fwd_dcr_3d.ipynb" rel="noreferrer">3D Forward Simulation</a> tutorial, we can parse the 3D survey into a set of 2D survey lines if we know which survey line is associated with each datum. Then we can plot individual pseudosections for each survey line. We use the <a target="_blank" href="SimPEG#SimPEG.electromagnetics.static.utils.convert_survey_3d_to_2d_lines" rel="noreferrer">convert<wbr/>_survey<wbr/>_3d<wbr/>_to<wbr/>_2d<wbr/>_lines</a> to generate the list of 2D surveys. And we use the <a target="_blank" href="SimPEG#SimPEG.electromagnetics.static.utils.plot_2d_pseudosection" rel="noreferrer">plot<wbr/>_2d<wbr/>_pseudosection</a> utility function to plot the pseudosection for the desired survey line.</p></div><div id="WOfajrrtrf" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Extract line IDs and make sure they are integers
lineID = np.array(out_dict[&quot;LINEID&quot;], dtype=int)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3ZMPIk090W_zyL3oN_q7Q" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kgkhxj0buq" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Create list of 2D surveys
survey_2d_list, index_list = convert_survey_3d_to_2d_lines(
    ip_data.survey, lineID, data_type=&quot;apparent_chargeability&quot;, output_indexing=True
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="_ONIHHIOKQX5BV5rCxVwb" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Y2mwogrvD2" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">dobs_2d_list = []
apparent_chargeabilities_2d = []
for ind in index_list:
    dobs_2d_list.append(ip_data.dobs[ind])
    apparent_chargeabilities_2d.append(ip_data.dobs[ind])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="A9inQjCeTUfw8GvuRTY-1" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FM9fRTV94I" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">line_index = 0

fig = plt.figure(figsize=(8, 2.75))
ax1 = fig.add_axes([0.1, 0.15, 0.75, 0.78])
plot_pseudosection(
    survey_2d_list[line_index],
    dobs=apparent_chargeabilities_2d[line_index],
    plot_type=&quot;contourf&quot;,
    ax=ax1,
    scale=&quot;linear&quot;,
    cbar_label=&quot;V/V&quot;,
    mask_topography=True,
    contourf_opts={&quot;levels&quot;: 20, &quot;cmap&quot;: mpl.cm.plasma},
)
ax1.set_title(&quot;Apparent Chargeability&quot;)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="0Tw2AIy1gpwW3l1caOo9j" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/682086cb0a8a1164be91c1f5b0b2a458.png" alt="&lt;Figure size 800x275 with 2 Axes&gt;"/></div></div><div id="c6JwRb9dh7" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="assign-uncertainties" class="relative group"><span class="heading-text">Assign Uncertainties</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#assign-uncertainties" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Inversion with SimPEG requires that we define the uncertainties on our data; that is, an estimate of the standard deviation of the noise on our data assuming it is uncorrelated Gaussian with zero mean. An online resource explaining uncertainties and their role in the inversion can be found <a target="_blank" href="https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html" rel="noreferrer">here</a>.</p><p><strong>For secondary voltage data,</strong> we generally apply a percent uncertainty and a very small floor uncertainty to all data. Differences in electrode spacing and subsurface conductivity result in secondary voltage IP data that span many orders of magnitude. A percent uncertainty ensures all data are fit equally. Depending on the quality of the data, we may choose a percent uncertainty between 2% - 10%. The floor uncertainty ensures stability when there are zero-crossings or erroneously small voltages.</p><p><strong>For apparent chargeability data,</strong> we generally apply a floor uncertainty to all data. This is because apparent chargeability data is obtained by normalizing the secondary voltage defining the IP signature by the DC voltage. This effectively removes the influence of electrode spacing on the amplitude of the datum. Here, we apply a floor uncertainty of 5e-3 V/V to all data.</p></div><div id="wxMbbgrXd8" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">ip_data.standard_deviation = 5e-3 * np.ones_like(ip_data.dobs)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="hM6Aq51KNH_OWGX_kpMhM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="t4pLSR95hO" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="design-a-tree-mesh" class="relative group"><span class="heading-text">Design a (Tree) Mesh</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#design-a-tree-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>IP inversion is carried out on the same mesh that is used for DC resistivity inversion. Here, we reproduce the survey-based meshing approach that was used in the  <a href="/user-tutorials/inv-dcr-3d">3D Inversion of DC Resistivity Data</a> tutorial. The best-practices for meshes design for DC/IP problems is provided in the <a href="/user-tutorials/fwd-dcr-2d">2.5D Forward Simulation of DC Resistivity Data</a> tutorial. The same rules for defining appropriate meshes for 2.5D simulations and inversion apply to 3D simulations and inversion.</p><p><strong>Tutorial mesh:</strong> Here, a minimum cell width of 25 m (or 1/4 the minimum electrode spacing) is used within our survey region. The largest electrode spacing was 1000 m, so a the padding was extended at least 3000 m from the survey region. Using the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_surface.html#discretize.treemesh.refine_surface" rel="noreferrer">refine_surface</a> method, we refine the tree mesh where there is significant topography. And using the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_points.html#discretize.treemesh.refine_points" rel="noreferrer">refine_points</a> methods, we refine based on electrodes locations. Visit the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh" rel="noreferrer">tree mesh</a> API to see additional refinement methods.</p></div><div id="uj1YVxMR4f" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Defining domain size and minimum cell size
dh = 25.0  # base cell width
dom_width_x = 8000.0  # domain width x
dom_width_y = 8000.0  # domain width y
dom_width_z = 4000.0  # domain width z

# Number of base mesh cells in each direction. Must be a power of 2
nbcx = 2 ** int(np.round(np.log(dom_width_x / dh) / np.log(2.0)))  # num. base cells x
nbcy = 2 ** int(np.round(np.log(dom_width_y / dh) / np.log(2.0)))  # num. base cells y
nbcz = 2 ** int(np.round(np.log(dom_width_z / dh) / np.log(2.0)))  # num. base cells z

# Define the base mesh
hx = [(dh, nbcx)]
hy = [(dh, nbcy)]
hz = [(dh, nbcz)]
mesh = TreeMesh([hx, hy, hz], x0=&quot;CCN&quot;)

# Shift top to maximum topography
mesh.origin = mesh.origin + np.r_[0.0, 0.0, topo_xyz[:, -1].max()]

# Mesh refinement based on surface topography
k = np.sqrt(np.sum(topo_xyz[:, 0:2] ** 2, axis=1)) &lt; 1200
mesh.refine_surface(topo_xyz[k, :], padding_cells_by_level=[0, 4, 4], finalize=False)

# Extract unique electrode locations.
unique_locations = ip_data.survey.unique_electrode_locations

# Mesh refinement near electrodes.
mesh.refine_points(unique_locations, padding_cells_by_level=[6, 6, 4], finalize=False)

# Finalize the mesh
mesh.finalize()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="dJx1sdc1M4DK09w4KnrOY" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="eXVBERpXDw" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-active-cells" class="relative group"><span class="heading-text">Define the Active Cells</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-active-cells" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Use the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz" rel="noreferrer">active_from_xyz</a> utility function to obtain the indices of the active mesh cells from topography (e.g. cells below surface).</p></div><div id="FRoT9IeMWp" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Indices of the active mesh cells from topography (e.g. cells below surface)
active_cells = active_from_xyz(mesh, topo_xyz)

# number of active cells
n_active = np.sum(active_cells)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="cmHDIDN0DNVUE3FeCfUJ5" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="rpJ5dU4Xn8" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="project-electrodes-to-discretized-topography" class="relative group"><span class="heading-text">Project Electrodes to Discretized Topography</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#project-electrodes-to-discretized-topography" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Surface IP data will not be modeled accurately if the electrodes are modeled as living above or below the surface. It is especially problematic when electrodes are modeled as living in the air. Prior to inverting surface IP data, we must project the electrodes from their true elevation to the surface of the <em>discretized</em> topography. This is done using the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Survey.drape_electrodes_on_topography.html#simpeg.electromagnetics.static.resistivity.survey.drape_electrodes_on_topography" rel="noreferrer">drape<wbr/>_electrodes<wbr/>_on<wbr/>_topography</a> method.</p></div><div id="BLD3MNKDzW" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">ip_data.survey.drape_electrodes_on_topography(mesh, active_cells, option=&quot;top&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="_2TdQ1s5TCTaPdGJ6J4Fp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="TYJOQcYLe2" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-background-conductivity-resistivity" class="relative group"><span class="heading-text">Define the Background Conductivity/Resistivity</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-background-conductivity-resistivity" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In order to invert IP data, we require the background conductivity/resistivity defined on the entire mesh. <strong>In practice,</strong> a conductivity/resistivity model is recovered via inverting DC resistivity data; see the <a href="/user-tutorials/inv-dcr-3d">3D Inversion of DC Resistivity Data</a> tutorial. Since the conductivity/resistivity model greatly impacts the sensitivities for the IP problem, IP inversion is most successful when the recovered conductivity/resistivity model accurately characterizes the true subsurface distribution of electrical properties. <strong>For the tutorial,</strong> the true subsurface conductivity is used as the background conductivity for the IP inversion.</p></div><div id="hXzlqnrMIN" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Define conductivity model in S/m
air_conductivity = 1e-8
background_conductivity = 1e-2
conductor_conductivity = 1e-1
resistor_conductivity = 1e-3</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="0c149vJkmwz9_eykH9XY9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="cCOm2JnU5e" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Define conductivity model
conductivity_model = background_conductivity * np.ones(n_active)

ind_conductor = model_builder.get_indices_sphere(
    np.r_[-300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]
)
conductivity_model[ind_conductor] = conductor_conductivity

ind_resistor = model_builder.get_indices_sphere(
    np.r_[300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]
)
conductivity_model[ind_resistor] = resistor_conductivity</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="l9g7mBdqCMT4lYdBtAKWO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="IpOEl7HoLa" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Define the mapping from the model to conductivity for all mesh cells.
conductivity_map = maps.InjectActiveCells(mesh, active_cells, air_conductivity)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="hJindHxJsCMLNWu1InBTG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kXXWVucsuf" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Mapping to ignore inactive cells in plot
plotting_map = maps.InjectActiveCells(mesh, active_cells, np.nan)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="11Nq7eWpGtmSdW3y3aNxN" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="bVzc8Q27AL" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(10, 4.5))

log_norm = LogNorm(vmin=1e-3, vmax=0.1)

ax1 = fig.add_axes([0.15, 0.15, 0.68, 0.75])
mesh.plot_slice(
    plotting_map * conductivity_model,
    ax=ax1,
    normal=&quot;Y&quot;,
    ind=int(len(mesh.h[1]) / 2),
    grid=True,
    pcolor_opts={&quot;cmap&quot;: mpl.cm.RdYlBu_r, &quot;norm&quot;: log_norm},
)
ax1.set_title(&quot;True Background Conductivity&quot;)
ax1.set_xlabel(&quot;x (m)&quot;)
ax1.set_ylabel(&quot;z (m)&quot;)
ax1.set_xlim([-1500, 1500])
ax1.set_ylim([topo_xyz[:, -1].max() - 1500, topo_xyz[:, -1].max()])

ax2 = fig.add_axes([0.84, 0.15, 0.03, 0.75])
cbar = mpl.colorbar.ColorbarBase(
    ax2, cmap=mpl.cm.RdYlBu_r, norm=log_norm, orientation=&quot;vertical&quot;
)
cbar.set_label(&quot;Conductivity [S/m]&quot;, rotation=270, labelpad=15, size=12)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="jiLc4XfBcIjyGfrXuwW1L" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/53017350ffeff6b11cf318aeb2fb15fa.png" alt="&lt;Figure size 1000x450 with 2 Axes&gt;"/></div></div><div id="ZiG9ecXvzE" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="mapping-from-the-model-to-the-mesh" class="relative group"><span class="heading-text">Mapping from the Model to the Mesh</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mapping-from-the-model-to-the-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In SimPEG, the term ‘model’ is not synonymous with the physical property values defined on the mesh. For whatever model we choose, we must define a mapping from the set of model parameters (a <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">1D numpy.ndarray</a>) to the physical property values of all cells in the mesh. Mappings are created using the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.IdentityMap.html#simpeg.maps.identitymap" rel="noreferrer">SimPEG.maps</a> module.</p><p>SimPEG uses a linearized formulation for simulating IP data; see <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.induced_polarization.Simulation2DCellCentered.html#simpeg.electromagnetics.static.induced_polarization.simulation2dcellcentered" rel="noreferrer">Simulation2DCellCentered</a> or <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.induced_polarization.Simulation2DNodal.html#simpeg.electromagnetics.static.induced_polarization.simulation2dnodal" rel="noreferrer">Simulation2DNodal</a>. In this formulation, any standard definition of the chargeability can be inverted. And the units of the recovered chargeability values is the same as the data units; e.g. intrinsic chargeability (V/V or mV/V) or integrated chargeability (ms). If you are inverting secondary voltages however, the chargeability model must represent intrinsic chargeabilities (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>η</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \leq \eta \leq 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">η</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>) in V/V.</p><p><strong>In this tutorial,</strong> the model parameters are the subsurface chargeabilities (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>η</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \leq \eta \leq 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">η</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>) in V/V. We use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.InjectActiveCells.html#simpeg.maps.injectactivecells" rel="noreferrer">SimPEG<wbr/>.maps<wbr/>.InjectActiveCells</a> map to project the active cell chargeabilities to the entire mesh.</p></div><div id="dogWnQpmlz" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Model parameters to all cells
chargeability_map = maps.InjectActiveCells(mesh, active_cells, 0.0)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="UhW_tnJC1-PIe0Qtr7lJz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Z0rf7csrVE" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="starting-reference-model-for-ip-inversion" class="relative group"><span class="heading-text">Starting/Reference Model for IP Inversion</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#starting-reference-model-for-ip-inversion" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we would create starting and/or reference models for the IP inversion as well as the mapping from the model space to the active cells. Starting and reference models can be a constant background value or contain a-priori structures. Here, the starting model is the 1e-6 V/V. It should be noted that the staring model <strong>cannot be vector of zeros,</strong> otherwise the inversion will be unable to compute a gradient direction at the first iteration.</p></div><div id="ZEVLXRzp3J" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Create staring model from log-conductivity
starting_chargeability_model = 1e-4 * np.ones(n_active)

# Zero reference conductivity model
reference_chargeability_model = np.zeros_like(starting_chargeability_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="yetXhdf41EiCRvimVyVtL" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="KGtxdNZt6Q" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-forward-simulation" class="relative group"><span class="heading-text">Define the Forward Simulation</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-forward-simulation" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>A simulation object defining the forward problem is required in order to predict data and calculate misfits for recovered models. A comprehensive description of the simulation object for 3D IP was discussed in the <a target="_blank" href="fwd_dcip_3d.ipynb" rel="noreferrer">3D IP Forward Simulation</a> tutorial. Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.induced_polarization.Simulation3DNodal.html#simpeg.electromagnetics.static.induced_polarization.simulation3dnodal" rel="noreferrer">Simulation3DNodel</a> simulation which solves for the electric potential on mesh nodes.</p><p>Since we are using a background <em>conductivity</em> model, we use <code>sigma</code> to define the background conductivity on the entire mesh. Because the IP problem has been linearized, we store the sensitivities for the inversion using <code>storeJ</code>.</p></div><div id="EUdEusB6O4" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">simulation_L2 = ip.Simulation3DNodal(
    mesh,
    survey=ip_data.survey,
    sigma=conductivity_map * conductivity_model,
    etaMap=chargeability_map,
    storeJ=True,
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="dS_iSlnLx-3sUkJZC06Dx" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="bZ8edygxKM" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-data-misfit" class="relative group"><span class="heading-text">Define the Data Misfit</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-data-misfit" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>To understand the role of the data misfit in the inversion, please visit <a target="_blank" href="https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html" rel="noreferrer">this online resource</a>.
Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.data_misfit.L2DataMisfit.html#simpeg.data_misfit.l2datamisfit" rel="noreferrer">L2DataMisfit</a> class to define the data misfit. In this case, the data misfit is the L2 norm of the weighted residual between the observed data and the data predicted for a given model. When instantiating the data misfit object within SimPEG, we must assign an appropriate <em>data object</em> and <em>simulation object</em> as properties.</p></div><div id="McQdBHo40u" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">dmis_L2 = data_misfit.L2DataMisfit(simulation=simulation_L2, data=ip_data)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="VHycBxvlZksfhkkuXpAKR" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hqkczq3hcH" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-regularization" class="relative group"><span class="heading-text">Define the Regularization</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-regularization" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>To understand the role of the regularization in the inversion, please visit <a target="_blank" href="https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html" rel="noreferrer">this online resource</a>. Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.regularization.WeightedLeastSquares.html#simpeg.regularization.weightedleastsquares" rel="noreferrer">WeightedLeastSquares</a> regularization class to constrain the inversion result. Length scales along x, y and z are used to balance the smallness and smoothness terms. And the reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros.</p><p>By default, the regularization acts on the model parameters; which in the case are the log-conductivities of the active cells. So we need to specify which cells are active in the regularization. And if we wanted to apply the regularization to a function of the model parameters, we would need to set an approprate mapping object using the <code>mapping</code> keyword argument.</p></div><div id="NuwEFom3Z6" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">reg_L2 = regularization.WeightedLeastSquares(
    mesh,
    active_cells=active_cells,
    length_scale_x=10.0,
    length_scale_y=10.0,
    length_scale_z=10.0,
    reference_model=reference_chargeability_model,
    reference_model_in_smooth=False,
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="yoepwgGR6QbKNq8uwDiY2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="eWQ5CPcwif" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-optimization-algorithm" class="relative group"><span class="heading-text">Define the Optimization Algorithm</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-optimization-algorithm" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>To understand the role of the optimization algorithm in the inversion, please visit this online resource. Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.optimization.ProjectedGNCG.html#simpeg.optimization.projectedgncg" rel="noreferrer">ProjectedGNCG</a> class to solve the optimization problem using projected Gauss-Newton with conjugate gradietn solver. Reasonable default values have generally been set for the properties of each optimization class. However, the user may choose to set custom values; e.g. the accuracy tolerance for the conjugate gradient solver or the number of line searches. Here, the <code>lower</code> property is set to 0 to ensure recovered chargeability values are positive.</p></div><div id="liiK7iKQ7T" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">opt_L2 = optimization.ProjectedGNCG(
    maxIter=40, lower=0.0, maxIterLS=20, maxIterCG=20, tolCG=1e-2
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="PMDvmoN4e4eYNwRxURYYw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="KHLqmdJ03N" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-inverse-problem" class="relative group"><span class="heading-text">Define the Inverse Problem</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-inverse-problem" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We use the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.inverse_problem.BaseInvProblem.html#simpeg.inverse_problem.baseinvproblem" rel="noreferrer">BaseInvProblem</a> class to fully define the inverse problem that is solved at each beta (trade-off parameter) iteration. The inverse problem requires appropriate <em>data misfit</em>, <em>regularization</em> and <em>optimization</em> objects.</p></div><div id="Upl2x7VUbf" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">inv_prob_L2 = inverse_problem.BaseInvProblem(dmis_L2, reg_L2, opt_L2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="tZCG7puToVwhs7Gaj9gGF" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="qL6nBM1Xgu" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="provide-inversion-directives" class="relative group"><span class="heading-text">Provide Inversion Directives</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#provide-inversion-directives" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Directives represent operations that are applied while the inversion is running. Here, we apply common directives for weighted least-squares inversion of IP data and describe their roles. These are:</p><ul><li><p><a target="_blank" href="myst:SimPEG#SimPEG.directives.UpdateSensitivityWeights" rel="noreferrer">UpdateSensitivityWeights</a>: apply sensitivity weighting to counteract the natural tendancy of IP inversion to place materials near the electrodes. Since the IP problem has been linearized, we do not need to update the sensitivities and we set <code>every_iteration=False</code>. For IP inversion, we do not want to use the entire dynamic range of the sensitivities to generate our weighting. So we generally set <code>threshold_value</code> to a value betwewen 1e-4 and 1e-1.</p></li><li><p><a target="_blank" href="myst:SimPEG#SimPEG.directives.UpdatePreconditioner" rel="noreferrer">UpdatePreconditioner</a>: Apply Jacobi preconditioner when solving optimization problem to reduce the number of conjugate gradient iterations. We set <code>update_every_iteration=False</code> because the ideal preconditioner because the forward problem and regularization are not model-dependent.</p></li><li><p><a target="_blank" href="myst:SimPEG#SimPEG.directives.BetaEstimate_ByEig" rel="noreferrer">BetaEstimate_ByEig</a>: Compute and set starting trade-off parameter (beta) based on largest eigenvalues.</p></li><li><p><a target="_blank" href="myst:SimPEG#SimPEG.directives.BetaSchedule" rel="noreferrer">BetaSchedule</a>: Size reduction of the trade-off parameter at every beta iteration, and the number of Gauss-Newton iterations for each beta. In general, a <code>coolingFactor</code> between 1.5 and 2.5, and <code>coolingRate</code> of 2 or 3 works well for DC resistivity inversion. Cooling beta too quickly will result in portions of the model getting trapped in local minima. And we will not be finding the solution that minimizes the optimization problem if the cooling rate is too small.</p></li><li><p><a target="_blank" href="myst:SimPEG#SimPEG.directives.TargetMisfit" rel="noreferrer">TargetMisfit</a>: Terminates the inversion when the data misfit equals the target misfit. A <code>chifact=1</code> terminates the inversion when the data misfit equals the number of data.</p></li></ul><p>The directive objects are organized in a <code>list</code>. Upon starting the inversion or updating the recovered model at each iteration, the inversion will call each directive within the list <strong>in order</strong>. The order of the directives matters, and SimPEG will throw an error if directives are organized into an improper order. Some directives, like the <code>BetaEstimate_ByEig</code> are only used when starting the inversion. Other directives, like <code>UpdatePreconditionner</code>, are used whenever the model is updated.</p></div><div id="qbUxJjrT2q" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">sensitivity_weights = directives.UpdateSensitivityWeights(
    every_iteration=False, threshold_value=1e-2
)
update_jacobi = directives.UpdatePreconditioner(update_every_iteration=True)
starting_beta = directives.BetaEstimate_ByEig(beta0_ratio=1000)
beta_schedule = directives.BetaSchedule(coolingFactor=2.0, coolingRate=2)
target_misfit = directives.TargetMisfit(chifact=1.0)

directives_list_L2 = [
    sensitivity_weights,
    update_jacobi,
    starting_beta,
    beta_schedule,
    target_misfit,
]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Mv1SxFm3zNvcejDVvKGO4" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="BGXkIGfxfC" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-and-run-the-inversion" class="relative group"><span class="heading-text">Define and Run the Inversion</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-and-run-the-inversion" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We define the inversion using the <a target="_blank" href="https://docs.simpeg.xyz/content/api/generated/SimPEG.inversion.BaseInversion.html#simpeg.inversion.baseinversion" rel="noreferrer">BaseInversion</a> class. The inversion class must be instatiated with an appropriate <em>inverse problem</em> object and <em>directives list</em>. The <code>run</code> method, along with a starting model, is respondible for running the inversion. The output is a 1D numpy.ndarray containing the recovered model parameters</p></div><div id="MwQOkHpDX8" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Here we combine the inverse problem and the set of directives
inv_L2 = inversion.BaseInversion(inv_prob_L2, directives_list_L2)

# Run the inversion
recovered_chargeability_L2 = inv_L2.run(starting_chargeability_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="AHL1iq8Ax844P4f6l5SrS" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>
                        SimPEG.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.
                        ***Done using same Solver, and solver_opts as the Simulation3DNodal problem***
                        
model has any nan: 0
=============================== Projected GNCG ===============================
  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   
-----------------------------------------------------------------------------
x0 has any nan: 0
   0  1.88e-01  8.35e+02  6.62e+00  8.36e+02    1.43e+03      0              
   1  1.88e-01  5.01e+02  5.17e+02  5.98e+02    4.19e+02      0              
   2  9.39e-02  5.01e+02  5.11e+02  5.49e+02    4.67e+02      0              
   3  9.39e-02  4.41e+02  9.57e+02  5.31e+02    2.09e+02      0              
   4  4.69e-02  4.41e+02  9.55e+02  4.86e+02    3.11e+02      0              
   5  4.69e-02  3.93e+02  1.68e+03  4.72e+02    7.04e+01      0              
   6  2.35e-02  3.93e+02  1.67e+03  4.33e+02    2.38e+02      0              
   7  2.35e-02  3.56e+02  2.81e+03  4.22e+02    4.12e+01      0              
   8  1.17e-02  3.57e+02  2.79e+03  3.89e+02    1.87e+02      0              
------------------------- STOP! -------------------------
1 : |fc-fOld| = 0.0000e+00 &lt;= tolF*(1+|f0|) = 8.3721e+01
0 : |xc-x_last| = 2.3856e-01 &lt;= tolX*(1+|x0|) = 1.0266e-01
0 : |proj(x-g)-x|    = 1.8725e+02 &lt;= tolG          = 1.0000e-01
0 : |proj(x-g)-x|    = 1.8725e+02 &lt;= 1e3*eps       = 1.0000e-02
0 : maxIter   =      40    &lt;= iter          =      9
------------------------- DONE! -------------------------
</span></code></pre></div></div></div><div id="y4AHDj4Psn" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="analyze-inversion-outputs" class="relative group"><span class="heading-text">Analyze Inversion Outputs</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#analyze-inversion-outputs" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="PmFrgCks00" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-normalized-data-misfit-in-3d-pseudosection" class="relative group"><span class="heading-text">Plot Normalized Data Misfit in 3D Pseudosection</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-normalized-data-misfit-in-3d-pseudosection" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To see how well the recovered model reproduces the observed data, it is a good idea to compare the predicted and observed data.
Here, we plot the normalized data misfit to determine whether the observed data are fit evenly. Correlated signatures in the normalized data misfits indicate we are overfitting/underfitting certain data. And that we must modify our uncertainties and re-run the inversion.</p></div><div id="sjBu4WtxZE" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Predicted data from recovered model
dpred_ip = inv_prob_L2.dpred

# Compute the normalized data misfit
ip_normalized_misfit = (ip_data.dobs - dpred_ip) / ip_data.standard_deviation

if has_plotly:
    fig = plot_3d_pseudosection(
        ip_data.survey,
        ip_normalized_misfit,
        scale=&quot;linear&quot;,
        units=&quot;&quot;,
        vlim=[-2.5, 2.5],
        marker_opts={&quot;colorscale&quot;: &quot;RdYlBu&quot;},
    )

    fig.update_layout(
        title_text=&quot;Normalized Data Misfit&quot;,
        title_x=0.5,
        title_font_size=24,
        width=650,
        height=500,
        scene_camera=dict(
            center=dict(x=0, y=0, z=-0.4), eye=dict(x=1.5, y=-1.5, z=1.8)
        ),
    )

    #     plotly.io.show(fig)
    html_str = plotly.io.to_html(fig)
    display(HTML(html_str))

else:
    print(&quot;INSTALL &#x27;PLOTLY&#x27; TO VISUALIZE 3D PSEUDOSECTIONS&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="th_jvxRPGbx1e44pVRXTl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="y7Omcd9cX9" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-2d-pseudsections-for-individual-survey-lines" class="relative group"><span class="heading-text">Plot 2D Pseudsections for Individual Survey Lines</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-2d-pseudsections-for-individual-survey-lines" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>For large datasets comprised of many survey lines, interpretation can be challenging if we plot every datum. Here, we plot the observed data, predicted data and data misfit for a specified survey line.</p></div><div id="a9U3xYMHWf" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Data associated with the line index provided
line_index = 0
k = lineID == line_index + 1
data_array = [
    np.abs(ip_data.dobs[k]),
    np.abs(dpred_ip[k]),
    ip_data.dobs[k] - dpred_ip[k],
]

# Plot 2D pseudosections (observed, predicted, normalized misfit)
fig = plt.figure(figsize=(9, 11))
plot_title = [&quot;Observed&quot;, &quot;Predicted&quot;, &quot;Misfit&quot;]
plot_units = [&quot;V/V&quot;, &quot;V/V&quot;, &quot;V/V&quot;]
scale = [&quot;linear&quot;, &quot;linear&quot;, &quot;linear&quot;]
cmap_list = [mpl.cm.plasma, mpl.cm.plasma, mpl.cm.RdYlBu]

ax1 = 3 * [None]
cax1 = 3 * [None]
cbar = 3 * [None]
cplot = 3 * [None]

for ii in range(0, 3):
    ax1[ii] = fig.add_axes([0.15, 0.72 - 0.33 * ii, 0.65, 0.21])
    cax1[ii] = fig.add_axes([0.81, 0.72 - 0.33 * ii, 0.03, 0.21])
    cplot[ii] = plot_pseudosection(
        survey_2d_list[line_index],
        data_array[ii],
        &quot;contourf&quot;,
        ax=ax1[ii],
        cax=cax1[ii],
        scale=scale[ii],
        cbar_label=plot_units[ii],
        mask_topography=True,
        contourf_opts={&quot;levels&quot;: 25, &quot;cmap&quot;: cmap_list[ii]},
    )
    ax1[ii].set_title(plot_title[ii])

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="1miYFQwsrFtbZhhgFTOZW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/5ccd819d8e6336b4f40ce6c3d811a68b.png" alt="&lt;Figure size 900x1100 with 6 Axes&gt;"/></div></div><div id="xV5jM99NDv" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-true-and-recovered-chargeability-models" class="relative group"><span class="heading-text">Plot True and Recovered Chargeability Models</span><a class="select-none no-underline text-inherit hover:text-inherit px-2 font-normal transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-true-and-recovered-chargeability-models" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="g1lAhmo0jt" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre"># Define intrinsic chargeability model (V/V)
air_value = 0.0
background_value = 1e-6
chargeable_value = 0.1

# Define true chargeability model
true_chargeability_model = background_value * np.ones(n_active)

ind_chargeable = model_builder.get_indices_sphere(
    np.r_[-300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]
)

true_chargeability_model[ind_chargeable] = chargeable_value</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="iXvxmVswW42X0AroL8Unh" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jNdmnnMEsc" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:transparent;color:black"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(9, 9))
ax1 = 2 * [None]
ax2 = 2 * [None]
cbar = 2 * [None]
norm = 2 * [None]
title_str = [
    &quot;True Chargeability Model&quot;,
    &quot;Recovered Chargeability (L2)&quot;,
]

for ii, m in enumerate([true_chargeability_model, recovered_chargeability_L2]):
    norm[ii] = Normalize(vmin=0.0, vmax=np.max(m))

    ax1[ii] = fig.add_axes([0.14, 0.6 - 0.5 * ii, 0.68, 0.35])

    mesh.plot_slice(
        plotting_map * m,
        ax=ax1[ii],
        normal=&quot;Y&quot;,
        ind=int(len(mesh.h[1]) / 2),
        grid=False,
        pcolor_opts={&quot;cmap&quot;: mpl.cm.plasma, &quot;norm&quot;: norm[ii]},
    )
    ax1[ii].set_title(title_str[ii])
    ax1[ii].set_xlabel(&quot;x (m)&quot;)
    ax1[ii].set_ylabel(&quot;z (m)&quot;)
    ax1[ii].set_xlim([-1500, 1500])
    ax1[ii].set_ylim([topo_xyz[:, -1].max() - 1500, topo_xyz[:, -1].max()])

    ax2[ii] = fig.add_axes([0.84, 0.6 - 0.5 * ii, 0.03, 0.35])
    cbar[ii] = mpl.colorbar.ColorbarBase(
        ax2[ii], norm=norm[ii], orientation=&quot;vertical&quot;, cmap=mpl.cm.plasma
    )
    cbar[ii].set_label(r&quot;$\sigma$ (S/m)&quot;, rotation=270, labelpad=15, size=12)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="05REYxIFydM6GM2Q_4L8s" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/4bb075878ab4aeb85be254c41d4261dc.png" alt="&lt;Figure size 900x900 with 4 Axes&gt;"/></div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/user-tutorials/inv-ip-2d"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">SimPEG User Tutorials</div>2.5D IP Inversion</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/user-tutorials/fdem-index"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">SimPEG User Tutorials</div>Frequency-Domain Electromagnetics</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((l,d)=>{if(!window.history.state||!window.history.state.key){let f=Math.random().toString(32).slice(2);window.history.replaceState({key:f},"")}try{let p=JSON.parse(sessionStorage.getItem(l)||"{}")[d||window.history.state.key];typeof p=="number"&&window.scrollTo(0,p)}catch(f){console.error(f),sessionStorage.removeItem(l)}})("positions", null)</script><link rel="modulepreload" href="/user-tutorials/build/entry.client-K6EYMIDZ.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-FBLNPC3V.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-XJN3BT5Q.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-JPGYAJQ3.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-YAIQ7LUU.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-JOLZ6LZB.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-XIW7RL3H.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-I634YBN3.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-MITWS4PZ.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-M5ZDOVXY.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-6TYLRLOL.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-UZHI4RYQ.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-RTIGS2T3.js"/><link rel="modulepreload" href="/user-tutorials/build/root-2CYAF5SQ.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-OYK7WRH2.js"/><link rel="modulepreload" href="/user-tutorials/build/routes/$-ZDWRJY4B.js"/><script>window.__remixContext = {"url":"/inv-ip-3d","state":{"loaderData":{"root":{"theme":"light","config":{"title":"SimPEG User Tutorials","options":{"analytics_plausible":"simpeg.xyz"},"myst":"1.1.42","nav":[],"actions":[{"title":"Learn More","url":"https://mystmd.org/guide"}],"projects":[{"title":"SimPEG User Tutorials","github":"https://github.com/simpeg/user-tutorials","keywords":[],"references":{"python":{"url":"https://docs.python.org/3/"},"numpy":{"url":"https://numpy.org/doc/stable/"},"scipy":{"url":"https://docs.scipy.org/doc/scipy/"},"matplotlib":{"url":"https://matplotlib.org/stable/"},"discretize":{"url":"https://discretize.simpeg.xyz/en/main/"},"SimPEG":{"url":"https://docs.simpeg.xyz/"},"geoana":{"url":"https://geoana.simpeg.xyz/"},"sphinx":{"url":"https://www.sphinx-doc.org/en/master/"}},"thumbnail":"/user-tutorials/build/title_image-8a71538f0bef40867b3fb0794cae7dbc.png","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"gravity-index","title":"Gravity","description":"","date":"","thumbnail":"/user-tutorials/build/ae6c6ed278992f609070dbcd57643aba.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-gravity-anomaly-3d","title":"3D Forward Simulation of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-gravity-gradiometry-3d","title":"3D Forward Simulation of Gravity Gradiometry Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-gravity-anomaly-3d","title":"3D Inversion of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"magnetics-index","title":"Magnetics","description":"","date":"","thumbnail":"/user-tutorials/build/7a8cefd4894c78a7681713eac224fec3.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-magnetics-induced-3d","title":"3D Forward Simulation of TMI Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-magnetics-mvi-3d","title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-magnetics-induced-3d","title":"3D Inversion of TMI Data to Recover a Susceptibility Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dcr-index","title":"Direct Current Resistivity","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-ba2ce1e7a00bcfd7d149b5f4511b019f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-dcr-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-2d","title":"2.5D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-3d","title":"3D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-2d","title":"2.5D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-3d","title":"3D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ip-index","title":"Induced Polarization","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-ba2ce1e7a00bcfd7d149b5f4511b019f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-ip-2d","title":"2.5D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-ip-3d","title":"3D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-2d","title":"2.5D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-3d","title":"3D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fdem-index","title":"Frequency-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/fem_physics-6287513b81425048223fc264589cdf6a.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-fdem-1d","title":"1D Forward Simulation of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-fdem-1d","title":"1D Inversion of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"tdem-index","title":"Time-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/tem_physics-81e11e7ffe320f0cb309e445a95570b3.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-tdem-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-tdem-fundamentals","title":"Fundamentals of Finite Volume for TDEM Simulations","description":"","date":"","thumbnail":"/user-tutorials/build/diffusion_distance-1231b4c642392d8e924a88a81c415e67.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-utem-3d","title":"3D Forward Simulation for On-Time Large-Loop Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-tdem-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"uran-index","title":"Uncertainty and Resolution analysis","description":"","date":"","thumbnail":"/user-tutorials/build/f0de225db6a3bcc09186ff9fea3eba43.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"dc2d-sens","title":"2D DC Resistivity Sensitivity analysis","description":"","date":"","thumbnail":"/user-tutorials/build/f037fe2572b5e1b2bf477ba85272db70.gif","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/user-tutorials"},"routes/$":{"page":{"kind":"Notebook","sha256":"8a114bf65198fe0578cbd2277db89976363c8cb4c0fe1d69be3e1bc861235b06","slug":"inv-ip-3d","location":"/notebooks/06-ip/inv_ip_3d.ipynb","dependencies":[],"frontmatter":{"title":"3D IP Inversion","content_includes_title":false,"github":"https://github.com/simpeg/user-tutorials","keywords":[],"exports":[{"format":"ipynb","filename":"inv_ip_3d.ipynb","url":"/user-tutorials/build/inv_ip_3d-a9eeb502f72be416e3d94ed9291ab5f9.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"admonition","class":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Intermediate notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"szWjazZIHp"}],"key":"eFooAUpyBG"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TRf5QfBwId"}],"key":"rgwgJNDmnH"}],"key":"bEt3IIla34"}],"data":{"type":"notebook-content"},"key":"ZrbxHOMgJg"},{"type":"block","children":[{"type":"admonition","class":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Medium-weight notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lhdRvmtuEv"}],"key":"zy741RNGiE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Requires moderate computational resources. Run-times may exceed several minutes and require up to 8 GB of available RAM.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TmUcwGqMVt"}],"key":"HspFELpJBr"}],"key":"CCPNfR56DY"}],"data":{"type":"notebook-content"},"key":"udUY1mPfq8"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JllpRMM10s"}],"key":"EUSJwLEGem"},{"type":"text","value":" Devin C. Cowan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P4aoV7GkzZ"}],"key":"uqVT3iHC4Q"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Keywords:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XF13X8gMoA"}],"key":"qDkrNkDsQL"},{"type":"text","value":" induced polarization, 3D inversion, sparse norm, tree mesh.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mRYdgvX82o"}],"key":"cwhYyKD6HE"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Summary:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Ljucxxzrb2"}],"key":"i3J9xjEfqo"},{"type":"text","value":" Here we invert apparent chargeability data to recover the subsurface chargeability distribution on a tree mesh. We demonstrate two inversion approaches for recovering a chargeability model:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"nZrSJTk2rc"}],"key":"owJ5tpLKZv"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Weighted least-squares inversion","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"w6cTWsx31T"}],"key":"shuDe5aqbA"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Iteratively re-weighted least-squares (IRLS) inversion","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"InHasZMIJ9"}],"key":"R0GAI9JQ8K"}],"key":"BYAjKPPVie"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Almost all of the details of defining and carrying out weighted least-squares and iteratively weighted least squares inversion were covered in the ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"EwWsEmXNCo"},{"type":"link","url":"fwd_dcip_3d.ipynb","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"3D DC Resistivity Inversion","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"owOMR1eqpy"}],"urlSource":"fwd_dcip_3d.ipynb","key":"DSTJS2RuW9"},{"type":"text","value":" tutorial. And functionality specific to defining the IP forward simulation was covered in the ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"QVLZfAuxVp"},{"type":"link","url":"fwd_dcip_3d.ipynb","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"3D IP Forward Simulation","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Sb1JREW5Yq"}],"urlSource":"fwd_dcip_3d.ipynb","key":"WM0RVGvGkN"},{"type":"text","value":" tutorial. As we will focus primarily on content specific to IP inversion, we strongly urge the reader to work through the aforementioned tutorials prior to working through this one.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"hrnPrenjot"}],"key":"vFW70AiXiE"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Learning Objectives:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"gtMlvrtuOI"}],"key":"RNEwIOmi9R"}],"key":"m1mPOGo3Xt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Assigning appropriate uncertainties to IP data","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"YY4BoeL0NZ"}],"key":"Du8Yte8Esz"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Designing a mesh for IP inversion","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"mSxKo240Zg"}],"key":"EpGAxcs3bc"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Obtaining a background conductivity/resistivity model for the IP inversion","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"amgoG2RtfW"}],"key":"hx5Tr7VER8"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Analyzing inversion results","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Uez3rRscHy"}],"key":"ILIVUqqK0n"}],"key":"iX7HzG2TD2"}],"data":{"type":"notebook-content"},"key":"Q2j4kRnFKV"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Modules","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N3hq4eu9iw"}],"identifier":"import-modules","label":"Import Modules","html_id":"import-modules","implicit":true,"key":"naE2tGrDXx"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Here, we import all of the functionality required to run the notebook for the tutorial exercise.\nAll of the functionality specific to IP is imported from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GbACiiVQeV"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/SimPEG.electromagnetics.static.induced_polarization.html#module-simpeg.electromagnetics.static.induced_polarization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG​.electromagnetics​.static​.induced​_polarization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ddWIxIAcj7"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.induced_polarization","internal":false,"protocol":"myst","key":"Mk4s02R2u4"},{"type":"text","value":".\nWe also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"k0jnevlawq"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/SimPEG.utils.html#module-simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mwdR2pRSza"}],"urlSource":"myst:SimPEG#SimPEG.utils","internal":false,"protocol":"myst","key":"WFvB5v8BMF"},{"type":"text","value":". Classes required to define the data misfit, regularization, optimization, etc... are imported from elsewhere within SimPEG. We also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lBaB1U0aKo"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/SimPEG.utils.html#module-simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MdjurXM7Zi"}],"urlSource":"myst:SimPEG#SimPEG.utils","internal":false,"protocol":"myst","key":"HuAnZRmbm2"},{"type":"text","value":". To generate the mesh used for the inversion, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Hq3ecfhVcV"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AyHnG7ACjd"}],"urlSource":"https://discretize.simpeg.xyz/en/main","key":"v3bzVXD4Nw"},{"type":"text","value":" package.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"A3szHiozBb"}],"key":"iBe5YS8I1n"}],"data":{"type":"notebook-content"},"key":"qKbaRNYDcc"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# SimPEG functionality\nfrom SimPEG.electromagnetics.static import induced_polarization as ip\nfrom SimPEG.electromagnetics.static.utils.static_utils import (\n    plot_pseudosection,\n    apparent_resistivity_from_voltage,\n    convert_survey_3d_to_2d_lines,\n)\nfrom SimPEG.utils.io_utils.io_utils_electromagnetics import read_dcip_xyz\nfrom SimPEG.utils import download, model_builder\nfrom SimPEG import (\n    maps,\n    data,\n    data_misfit,\n    regularization,\n    optimization,\n    inverse_problem,\n    inversion,\n    directives,\n)\n\ntry:\n    import plotly\n    from SimPEG.electromagnetics.static.utils.static_utils import plot_3d_pseudosection\n    from IPython.core.display import display, HTML\n\n    has_plotly = True\nexcept ImportError:\n    has_plotly = False\n    pass\n\n# discretize functionality\nfrom discretize import TreeMesh\nfrom discretize.utils import mkvc, active_from_xyz\n\n# Basic Python functionality\nimport os\nimport tarfile\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom matplotlib.colors import LogNorm, Normalize\n\nmpl.rcParams.update({\"font.size\": 16})","key":"ZpelI7BEnI"},{"type":"output","id":"BGeHBsIjsiUf1zGaaOM7p","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\devin\\AppData\\Local\\Temp\\ipykernel_28068\\924317488.py:23: DeprecationWarning: Importing display from IPython.core.display is deprecated since IPython 7.14, please import from IPython display\n  from IPython.core.display import display, HTML\n"}],"key":"goiarFVDWT"}],"data":{"type":"notebook-code"},"key":"RQKHb6zNgp"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load and Plot Tutorial Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y97vnFTr4E"}],"identifier":"load-and-plot-tutorial-data","label":"Load and Plot Tutorial Data","html_id":"load-and-plot-tutorial-data","implicit":true,"key":"UrcMn4K8Yf"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For most geophysical inversion projects, a reasonable inversion result can be obtained so long as the practitioner has observed data, the survey geometry and topography. For this tutorial, the observed data and topography files are provided. Here, we download and import the observed data and topography into the SimPEG framework.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zZOcTyvBDC"}],"key":"v8DxJ6DfGs"}],"data":{"type":"notebook-content"},"key":"JFdXLBHdYl"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# URL to download from repository assets\ndata_source = \"https://github.com/simpeg/user-tutorials/raw/main/assets/06-ip/inv_ip_3d_files.tar.gz\"\n\n# download the data\ndownloaded_data = download(data_source, overwrite=True)\n\n# unzip the tarfile\ntar = tarfile.open(downloaded_data, \"r\")\ntar.extractall()\ntar.close()\n\n# path to the directory containing our data\ndir_path = downloaded_data.split(\".\")[0] + os.path.sep\n\n# files to work with\ntopo_filename = dir_path + \"topo_xyz.txt\"\ndata_filename = dir_path + \"ip_data.xyz\"","key":"UemTV1WTBh"},{"type":"output","id":"FCkUK3T09Z0UeBsBl1ZIO","data":[{"name":"stdout","output_type":"stream","text":"overwriting D:\\Documents\\Repositories\\user-tutorials\\notebooks\\06-ip\\inv_ip_3d_files.tar.gz\nDownloading https://github.com/simpeg/user-tutorials/raw/main/assets/06-ip/inv_ip_3d_files.tar.gz\n   saved to: D:\\Documents\\Repositories\\user-tutorials\\notebooks\\06-ip\\inv_ip_3d_files.tar.gz\nDownload completed!\n"}],"key":"EOsga1rE9O"}],"data":{"type":"notebook-code"},"key":"trZPnIwOuD"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load the Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Up3gs58ec6"}],"identifier":"load-the-topography","label":"Load the Topography","html_id":"load-the-topography","implicit":true,"key":"v8wQUb7UEA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For most geophysical inversion projects, a reasonable inversion result can be obtained so long as the practitioner has observed data, the survey geometry and topography. For this tutorial, the observed data and topography files are provided. Here, we download and import the observed data and topography into the SimPEG framework.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fpv2aXOvWH"}],"key":"dNsolBD3M5"}],"data":{"type":"notebook-content"},"key":"B3i9XacPHk"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"topo_xyz = np.loadtxt(str(topo_filename))","key":"sWGvin5So1"},{"type":"output","id":"qV_Q9239VEt5FlaxRpI08","data":[],"key":"Irckbyug8z"}],"data":{"type":"notebook-code"},"key":"W5jjmwFIoH"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(6, 6))\nax = fig.add_axes([0.1, 0.1, 0.8, 0.8], projection=\"3d\")\nax.set_zlim([-400, 400])\nax.scatter3D(topo_xyz[:, 0], topo_xyz[:, 1], topo_xyz[:, 2], s=0.25, c=\"b\")\nax.set_box_aspect(aspect=None, zoom=0.85)\nax.set_xlabel(\"X (m)\", labelpad=10)\nax.set_ylabel(\"Y (m)\", labelpad=10)\nax.set_zlabel(\"Z (m)\", labelpad=10)\nax.set_title(\"Topography (Exaggerated z-axis)\", fontsize=16, pad=-20)\nax.view_init(elev=45.0, azim=-125)","key":"srWCE3aWcT"},{"type":"output","id":"qNKOzcB1ETIP9-TR1JrbR","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"50f453841c4178b0f4e6f13dee58b243","path":"/user-tutorials/build/50f453841c4178b0f4e6f13dee58b243.png"},"text/plain":{"content":"\u003cFigure size 600x600 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"QQuiwVzeS2"}],"data":{"type":"notebook-code"},"key":"GyppMVfCQn"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load IP Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fTddvgp1iL"}],"identifier":"load-ip-data","label":"Load IP Data","html_id":"load-ip-data","implicit":true,"key":"tZrIYt1keA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Option A: DCIP3D formatted data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MpTvaNKjRJ"}],"key":"SLtjDMXfHP"}],"key":"TV6qubDkEp"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WWujZ9flSx"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.utils.io_utils.read_dcip3d_ubc.html#simpeg.utils.io_utils.read_dcip3d_ubc","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"read_dcip3d_ubc","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Wbz8MckKXA"}],"urlSource":"myst:SimPEG#SimPEG.utils.io_utils.read_dcip3d_ubc","internal":false,"protocol":"myst","key":"ez9ab6WF9O"},{"type":"text","value":" utility function can be used to load DC/IP data stored in a UBC-GIF formatted file. This function outputs a SimPEG ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BplsxPXDiK"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.data.Data.html#simpeg.data.data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vC2eVQqrZ9"}],"urlSource":"myst:SimPEG#SimPEG.data.Data","internal":false,"protocol":"myst","key":"oywDd3WjMs"},{"type":"text","value":" object.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"E27YEJ0JSW"}],"key":"sTvx7Zjo1R"}],"data":{"type":"notebook-content"},"key":"z9ap4yX23w"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Option B: Load XYZ formatted data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m4zvFBplpN"}],"key":"CS5KUYAEbr"}],"key":"CsJDmNCT8W"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For this tutorial, the observed data are organized within an XYZ formatted file. We can use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RP8IQPvvJ9"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.utils.io_utils.read_dcip_xyz.html#simpeg.utils.io_utils.read_dcip_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"read_dcip_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PisBR093Mh"}],"urlSource":"myst:SimPEG#SimPEG.utils.io_utils.read_dcip_xyz","internal":false,"protocol":"myst","key":"PPD3tarY64"},{"type":"text","value":" utility function to load data in this format. This function outputs a SimPEG ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Hr9QvuuhCW"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.data.Data.html#simpeg.data.data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BphcQLGJ2p"}],"urlSource":"myst:SimPEG#SimPEG.data.Data","internal":false,"protocol":"myst","key":"SBJWBjW6F3"},{"type":"text","value":" object. The data are apparent chargeabilities in V/V.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z0v6pcAkx4"}],"key":"aQafL4OpRd"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ssenQv8cOZ"},{"type":"inlineCode","value":"dict_headers","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QK14LzHuNg"},{"type":"text","value":" input argument can be used to import other data columns that are not required to define the SimPEG data object. In this case, we import a column that defines the survey line associated with each datum. We will use this to plot pseudosections for individual survey lines.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XfzcLWdeEm"}],"key":"dFDHjWWZzr"}],"data":{"type":"notebook-content"},"key":"eqCQHkJ3V8"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"ip_data, out_dict = read_dcip_xyz(\n    data_filename,\n    \"apparent_chargeability\",\n    data_header=\"APP_CHG\",\n    uncertainties_header=\"UNCERT\",\n    is_surface_data=False,\n    dict_headers=[\"LINEID\"],\n)","key":"XJzx0EwrB0"},{"type":"output","id":"OJLvjeIEbAEQB_w-xhhHc","data":[],"key":"qoNpUH6Pbg"}],"data":{"type":"notebook-code"},"key":"kq5tUQFbTv"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed Data in 3D Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"htxlKNIrjr"}],"identifier":"plot-observed-data-in-3d-pseudosection","label":"Plot Observed Data in 3D Pseudosection","html_id":"plot-observed-data-in-3d-pseudosection","implicit":true,"key":"I5CceNIgjz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Rt5X3cXzkv"},{"type":"link","url":"SimPEG#SimPEG.electromagnetics.static.utils.plot_3d_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plot​_3d​_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Oor79lSyFk"}],"urlSource":"SimPEG#SimPEG.electromagnetics.static.utils.plot_3d_pseudosection","key":"O3Su7LCYvC"},{"type":"text","value":" utility function to represent the observed data in pseudosection. In this case, the apparent chargeabilities are represented in V/V.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r6MJSn3nQP"}],"key":"CTEA6ECqzo"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In the case of secondary voltage data, you would need to convert the values to apparent chargeabilities. This accomplished by normalizing the secondary IP voltages by the DC voltages.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZrMr3Ll0xQ"}],"key":"HWDZyrNIU4"}],"data":{"type":"notebook-content"},"key":"FPOfQGkT2o"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"if has_plotly:\n    fig = plot_3d_pseudosection(\n        ip_data.survey,\n        ip_data.dobs,\n        scale=\"linear\",\n        units=\"V/V\",\n        vlim=[0, np.max(ip_data.dobs)],\n        marker_opts={\"colorscale\": \"plasma\"},\n    )\n\n    fig.update_layout(\n        title_text=\"Apparent Chargeability\",\n        title_x=0.5,\n        title_font_size=24,\n        width=650,\n        height=500,\n        scene_camera=dict(\n            center=dict(x=0, y=0, z=-0.4), eye=dict(x=1.5, y=-1.5, z=1.8)\n        ),\n    )\n\n    #     plotly.io.show(fig)\n    html_str = plotly.io.to_html(fig)\n    display(HTML(html_str))\n\nelse:\n    print(\"INSTALL 'PLOTLY' TO VISUALIZE 3D PSEUDOSECTIONS\")","key":"qJetEGg8ID"},{"type":"output","id":"aQTbAxHsC4MSYu9jCJ7tE","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"37b0b6982ab40295c6e36a8e52b91fbe","path":"/user-tutorials/build/37b0b6982ab40295c6e36a8e52b91fbe.html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}}],"key":"fSLluwB2eB"}],"data":{"type":"notebook-code"},"key":"GF9PkRjLyg"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed Data in 2D Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WVLaEYx4EH"}],"identifier":"plot-observed-data-in-2d-pseudosection","label":"Plot Observed Data in 2D Pseudosection","html_id":"plot-observed-data-in-2d-pseudosection","implicit":true,"key":"egSP3KAv68"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As demonstrated in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"loPEfFeiS5"},{"type":"link","url":"fwd_dcr_3d.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X7YSuUpz8Z"}],"urlSource":"fwd_dcr_3d.ipynb","key":"vfwCzsQQ0u"},{"type":"text","value":" tutorial, we can parse the 3D survey into a set of 2D survey lines if we know which survey line is associated with each datum. Then we can plot individual pseudosections for each survey line. We use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DlOiw10UMG"},{"type":"link","url":"SimPEG#SimPEG.electromagnetics.static.utils.convert_survey_3d_to_2d_lines","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"convert​_survey​_3d​_to​_2d​_lines","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iTlJIBvPlw"}],"urlSource":"SimPEG#SimPEG.electromagnetics.static.utils.convert_survey_3d_to_2d_lines","key":"bu5HA0EEDS"},{"type":"text","value":" to generate the list of 2D surveys. And we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uuWSj14hHK"},{"type":"link","url":"SimPEG#SimPEG.electromagnetics.static.utils.plot_2d_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plot​_2d​_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XfQBp64Cd7"}],"urlSource":"SimPEG#SimPEG.electromagnetics.static.utils.plot_2d_pseudosection","key":"ypNoes5ybL"},{"type":"text","value":" utility function to plot the pseudosection for the desired survey line.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dP0tZSwFm1"}],"key":"GK6c1KNrPT"}],"data":{"type":"notebook-content"},"key":"hUkFGIbp6M"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Extract line IDs and make sure they are integers\nlineID = np.array(out_dict[\"LINEID\"], dtype=int)","key":"tb7X0KT05i"},{"type":"output","id":"3ZMPIk090W_zyL3oN_q7Q","data":[],"key":"D1dH01PlL4"}],"data":{"type":"notebook-code"},"key":"WOfajrrtrf"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Create list of 2D surveys\nsurvey_2d_list, index_list = convert_survey_3d_to_2d_lines(\n    ip_data.survey, lineID, data_type=\"apparent_chargeability\", output_indexing=True\n)","key":"tLpRzTFCJM"},{"type":"output","id":"_ONIHHIOKQX5BV5rCxVwb","data":[],"key":"tsEHCodM4R"}],"data":{"type":"notebook-code"},"key":"kgkhxj0buq"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"dobs_2d_list = []\napparent_chargeabilities_2d = []\nfor ind in index_list:\n    dobs_2d_list.append(ip_data.dobs[ind])\n    apparent_chargeabilities_2d.append(ip_data.dobs[ind])","key":"f7MCZ9IxXY"},{"type":"output","id":"A9inQjCeTUfw8GvuRTY-1","data":[],"key":"Br8S9g2u4q"}],"data":{"type":"notebook-code"},"key":"Y2mwogrvD2"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"line_index = 0\n\nfig = plt.figure(figsize=(8, 2.75))\nax1 = fig.add_axes([0.1, 0.15, 0.75, 0.78])\nplot_pseudosection(\n    survey_2d_list[line_index],\n    dobs=apparent_chargeabilities_2d[line_index],\n    plot_type=\"contourf\",\n    ax=ax1,\n    scale=\"linear\",\n    cbar_label=\"V/V\",\n    mask_topography=True,\n    contourf_opts={\"levels\": 20, \"cmap\": mpl.cm.plasma},\n)\nax1.set_title(\"Apparent Chargeability\")\nplt.show()","key":"S1rInxyoGY"},{"type":"output","id":"0Tw2AIy1gpwW3l1caOo9j","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"682086cb0a8a1164be91c1f5b0b2a458","path":"/user-tutorials/build/682086cb0a8a1164be91c1f5b0b2a458.png"},"text/plain":{"content":"\u003cFigure size 800x275 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"f7InG1CYcG"}],"data":{"type":"notebook-code"},"key":"FM9fRTV94I"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Assign Uncertainties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BiX2HogJOK"}],"identifier":"assign-uncertainties","label":"Assign Uncertainties","html_id":"assign-uncertainties","implicit":true,"key":"zHUhd0PRVi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Inversion with SimPEG requires that we define the uncertainties on our data; that is, an estimate of the standard deviation of the noise on our data assuming it is uncorrelated Gaussian with zero mean. An online resource explaining uncertainties and their role in the inversion can be found ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NpYILyr20D"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tIdzUrS3Ah"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"cyYdoYL6IN"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S3x7XNBUlW"}],"key":"F92D9kZwGC"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For secondary voltage data,","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Xo19FjYRcO"}],"key":"Haq8M2a1u6"},{"type":"text","value":" we generally apply a percent uncertainty and a very small floor uncertainty to all data. Differences in electrode spacing and subsurface conductivity result in secondary voltage IP data that span many orders of magnitude. A percent uncertainty ensures all data are fit equally. Depending on the quality of the data, we may choose a percent uncertainty between 2% - 10%. The floor uncertainty ensures stability when there are zero-crossings or erroneously small voltages.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IZPfIsiHpQ"}],"key":"vyNXG9Pk2C"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"For apparent chargeability data,","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AQAlGjfR8c"}],"key":"gRR3r7bWXZ"},{"type":"text","value":" we generally apply a floor uncertainty to all data. This is because apparent chargeability data is obtained by normalizing the secondary voltage defining the IP signature by the DC voltage. This effectively removes the influence of electrode spacing on the amplitude of the datum. Here, we apply a floor uncertainty of 5e-3 V/V to all data.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KhqCgkkt6e"}],"key":"rfCo7LXKij"}],"data":{"type":"notebook-content"},"key":"c6JwRb9dh7"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"ip_data.standard_deviation = 5e-3 * np.ones_like(ip_data.dobs)","key":"cFDFJqmxIg"},{"type":"output","id":"hM6Aq51KNH_OWGX_kpMhM","data":[],"key":"ffF45WzdMo"}],"data":{"type":"notebook-code"},"key":"wxMbbgrXd8"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a (Tree) Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZAgHu6ca09"}],"identifier":"design-a-tree-mesh","label":"Design a (Tree) Mesh","html_id":"design-a-tree-mesh","implicit":true,"key":"GAakB6VfSA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"IP inversion is carried out on the same mesh that is used for DC resistivity inversion. Here, we reproduce the survey-based meshing approach that was used in the  ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ti5T96LlEP"},{"type":"link","url":"/inv-dcr-3d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Inversion of DC Resistivity Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dIwOvsL95y"}],"urlSource":"../05-dcr/inv_dcr_3d.ipynb","internal":true,"dataUrl":"/inv-dcr-3d.json","protocol":"file","key":"S2fTDLz1Fw"},{"type":"text","value":" tutorial. The best-practices for meshes design for DC/IP problems is provided in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JwtkYYMJTT"},{"type":"link","url":"/fwd-dcr-2d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"2.5D Forward Simulation of DC Resistivity Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"G3EfWb8Qbt"}],"urlSource":"../05-dcr/fwd_dcr_2d.ipynb","internal":true,"dataUrl":"/fwd-dcr-2d.json","protocol":"file","key":"vofSnY0AN3"},{"type":"text","value":" tutorial. The same rules for defining appropriate meshes for 2.5D simulations and inversion apply to 3D simulations and inversion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S5mEIcfIns"}],"key":"CsM4tDRkt7"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Tutorial mesh:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PS0czaTjXl"}],"key":"jIk0g3ow1k"},{"type":"text","value":" Here, a minimum cell width of 25 m (or 1/4 the minimum electrode spacing) is used within our survey region. The largest electrode spacing was 1000 m, so a the padding was extended at least 3000 m from the survey region. Using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yf0OBEGb5K"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_surface.html#discretize.treemesh.refine_surface","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"refine_surface","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bliqTCRf3f"}],"urlSource":"myst:discretize#discretize.TreeMesh.refine_surface","internal":false,"protocol":"myst","key":"lm3wCQJcJi"},{"type":"text","value":" method, we refine the tree mesh where there is significant topography. And using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ed4NlxEwbu"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_points.html#discretize.treemesh.refine_points","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"refine_points","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Th6QNqB38J"}],"urlSource":"myst:discretize#discretize.TreeMesh.refine_points","internal":false,"protocol":"myst","key":"IYo6xeFlOx"},{"type":"text","value":" methods, we refine based on electrodes locations. Visit the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"atHIZJGyp0"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"tree mesh","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DIfimewqZ1"}],"urlSource":"myst:discretize#discretize.TreeMesh","internal":false,"protocol":"myst","key":"YqAdHlxFdn"},{"type":"text","value":" API to see additional refinement methods.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aXmR2cjSCy"}],"key":"pE3JDTk8Sm"}],"data":{"type":"notebook-content"},"key":"t4pLSR95hO"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Defining domain size and minimum cell size\ndh = 25.0  # base cell width\ndom_width_x = 8000.0  # domain width x\ndom_width_y = 8000.0  # domain width y\ndom_width_z = 4000.0  # domain width z\n\n# Number of base mesh cells in each direction. Must be a power of 2\nnbcx = 2 ** int(np.round(np.log(dom_width_x / dh) / np.log(2.0)))  # num. base cells x\nnbcy = 2 ** int(np.round(np.log(dom_width_y / dh) / np.log(2.0)))  # num. base cells y\nnbcz = 2 ** int(np.round(np.log(dom_width_z / dh) / np.log(2.0)))  # num. base cells z\n\n# Define the base mesh\nhx = [(dh, nbcx)]\nhy = [(dh, nbcy)]\nhz = [(dh, nbcz)]\nmesh = TreeMesh([hx, hy, hz], x0=\"CCN\")\n\n# Shift top to maximum topography\nmesh.origin = mesh.origin + np.r_[0.0, 0.0, topo_xyz[:, -1].max()]\n\n# Mesh refinement based on surface topography\nk = np.sqrt(np.sum(topo_xyz[:, 0:2] ** 2, axis=1)) \u003c 1200\nmesh.refine_surface(topo_xyz[k, :], padding_cells_by_level=[0, 4, 4], finalize=False)\n\n# Extract unique electrode locations.\nunique_locations = ip_data.survey.unique_electrode_locations\n\n# Mesh refinement near electrodes.\nmesh.refine_points(unique_locations, padding_cells_by_level=[6, 6, 4], finalize=False)\n\n# Finalize the mesh\nmesh.finalize()","key":"gHpyJFmsVr"},{"type":"output","id":"dJx1sdc1M4DK09w4KnrOY","data":[],"key":"g1Bc2Oupcr"}],"data":{"type":"notebook-code"},"key":"uj1YVxMR4f"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Jvo9c0OptU"}],"identifier":"define-the-active-cells","label":"Define the Active Cells","html_id":"define-the-active-cells","implicit":true,"key":"idtpg0bU9T"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OSGyCOdSAO"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ci8AfLbkM1"}],"urlSource":"myst:discretize#discretize.utils.active_from_xyz","internal":false,"protocol":"myst","key":"JgZeahvDTX"},{"type":"text","value":" utility function to obtain the indices of the active mesh cells from topography (e.g. cells below surface).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WAx7vzOPKS"}],"key":"xin6QFfmVX"}],"data":{"type":"notebook-content"},"key":"eXVBERpXDw"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Indices of the active mesh cells from topography (e.g. cells below surface)\nactive_cells = active_from_xyz(mesh, topo_xyz)\n\n# number of active cells\nn_active = np.sum(active_cells)","key":"IBNl8o8Pzw"},{"type":"output","id":"cmHDIDN0DNVUE3FeCfUJ5","data":[],"key":"JoqBgfYvug"}],"data":{"type":"notebook-code"},"key":"FRoT9IeMWp"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Project Electrodes to Discretized Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"u7cM9dnXdX"}],"identifier":"project-electrodes-to-discretized-topography","label":"Project Electrodes to Discretized Topography","html_id":"project-electrodes-to-discretized-topography","implicit":true,"key":"rXWFPL6RKx"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Surface IP data will not be modeled accurately if the electrodes are modeled as living above or below the surface. It is especially problematic when electrodes are modeled as living in the air. Prior to inverting surface IP data, we must project the electrodes from their true elevation to the surface of the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BLt5yydhK0"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretized","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sZpuL91GN8"}],"key":"RfEc2p7TUr"},{"type":"text","value":" topography. This is done using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jrpmFSg8vk"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.resistivity.Survey.drape_electrodes_on_topography.html#simpeg.electromagnetics.static.resistivity.survey.drape_electrodes_on_topography","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"drape​_electrodes​_on​_topography","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cl4oEucLdA"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.resistivity.Survey.drape_electrodes_on_topography","internal":false,"protocol":"myst","key":"tEsm3Z0tbT"},{"type":"text","value":" method.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Us4Izio713"}],"key":"u1DMTJHne7"}],"data":{"type":"notebook-content"},"key":"rpJ5dU4Xn8"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"ip_data.survey.drape_electrodes_on_topography(mesh, active_cells, option=\"top\")","key":"IfBEN5u8xi"},{"type":"output","id":"_2TdQ1s5TCTaPdGJ6J4Fp","data":[],"key":"sAe2MIfaJN"}],"data":{"type":"notebook-code"},"key":"BLD3MNKDzW"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Background Conductivity/Resistivity","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DzWVUXQfNe"}],"identifier":"define-the-background-conductivity-resistivity","label":"Define the Background Conductivity/Resistivity","html_id":"define-the-background-conductivity-resistivity","implicit":true,"key":"nQ0Jpviym2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In order to invert IP data, we require the background conductivity/resistivity defined on the entire mesh. ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tNGuh86kOy"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In practice,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Mxwq68dgMe"}],"key":"esnUZ9W8oH"},{"type":"text","value":" a conductivity/resistivity model is recovered via inverting DC resistivity data; see the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IGfZ0Cpl5f"},{"type":"link","url":"/inv-dcr-3d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Inversion of DC Resistivity Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iei5T2hLVw"}],"urlSource":"../05-dcr/inv_dcr_3d.ipynb","internal":true,"dataUrl":"/inv-dcr-3d.json","protocol":"file","key":"j4wyLlRtyA"},{"type":"text","value":" tutorial. Since the conductivity/resistivity model greatly impacts the sensitivities for the IP problem, IP inversion is most successful when the recovered conductivity/resistivity model accurately characterizes the true subsurface distribution of electrical properties. ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IcK6iBaC1M"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For the tutorial,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XEUdH3JtZt"}],"key":"VXTeCV4vua"},{"type":"text","value":" the true subsurface conductivity is used as the background conductivity for the IP inversion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xqTMTyovwW"}],"key":"Gshg5AQeTf"}],"data":{"type":"notebook-content"},"key":"TYJOQcYLe2"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Define conductivity model in S/m\nair_conductivity = 1e-8\nbackground_conductivity = 1e-2\nconductor_conductivity = 1e-1\nresistor_conductivity = 1e-3","key":"OsWXPxnXqc"},{"type":"output","id":"0c149vJkmwz9_eykH9XY9","data":[],"key":"EtjJSNDHaS"}],"data":{"type":"notebook-code"},"key":"hXzlqnrMIN"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Define conductivity model\nconductivity_model = background_conductivity * np.ones(n_active)\n\nind_conductor = model_builder.get_indices_sphere(\n    np.r_[-300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]\n)\nconductivity_model[ind_conductor] = conductor_conductivity\n\nind_resistor = model_builder.get_indices_sphere(\n    np.r_[300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]\n)\nconductivity_model[ind_resistor] = resistor_conductivity","key":"gJ36cJDlQp"},{"type":"output","id":"l9g7mBdqCMT4lYdBtAKWO","data":[],"key":"L5aEtcTzqS"}],"data":{"type":"notebook-code"},"key":"cCOm2JnU5e"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Define the mapping from the model to conductivity for all mesh cells.\nconductivity_map = maps.InjectActiveCells(mesh, active_cells, air_conductivity)","key":"v7hGCqNDZU"},{"type":"output","id":"hJindHxJsCMLNWu1InBTG","data":[],"key":"QyKbeJpojv"}],"data":{"type":"notebook-code"},"key":"IpOEl7HoLa"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Mapping to ignore inactive cells in plot\nplotting_map = maps.InjectActiveCells(mesh, active_cells, np.nan)","key":"DwT8Tu1HpI"},{"type":"output","id":"11Nq7eWpGtmSdW3y3aNxN","data":[],"key":"Mhmb8v77yD"}],"data":{"type":"notebook-code"},"key":"kXXWVucsuf"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(10, 4.5))\n\nlog_norm = LogNorm(vmin=1e-3, vmax=0.1)\n\nax1 = fig.add_axes([0.15, 0.15, 0.68, 0.75])\nmesh.plot_slice(\n    plotting_map * conductivity_model,\n    ax=ax1,\n    normal=\"Y\",\n    ind=int(len(mesh.h[1]) / 2),\n    grid=True,\n    pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": log_norm},\n)\nax1.set_title(\"True Background Conductivity\")\nax1.set_xlabel(\"x (m)\")\nax1.set_ylabel(\"z (m)\")\nax1.set_xlim([-1500, 1500])\nax1.set_ylim([topo_xyz[:, -1].max() - 1500, topo_xyz[:, -1].max()])\n\nax2 = fig.add_axes([0.84, 0.15, 0.03, 0.75])\ncbar = mpl.colorbar.ColorbarBase(\n    ax2, cmap=mpl.cm.RdYlBu_r, norm=log_norm, orientation=\"vertical\"\n)\ncbar.set_label(\"Conductivity [S/m]\", rotation=270, labelpad=15, size=12)","key":"HumKNQHSxG"},{"type":"output","id":"jiLc4XfBcIjyGfrXuwW1L","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"53017350ffeff6b11cf318aeb2fb15fa","path":"/user-tutorials/build/53017350ffeff6b11cf318aeb2fb15fa.png"},"text/plain":{"content":"\u003cFigure size 1000x450 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"yEZhLG32JO"}],"data":{"type":"notebook-code"},"key":"bVzc8Q27AL"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping from the Model to the Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xnl68LxDgx"}],"identifier":"mapping-from-the-model-to-the-mesh","label":"Mapping from the Model to the Mesh","html_id":"mapping-from-the-model-to-the-mesh","implicit":true,"key":"nq2YftnD30"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In SimPEG, the term ‘model’ is not synonymous with the physical property values defined on the mesh. For whatever model we choose, we must define a mapping from the set of model parameters (a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ddXUzeEfmT"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1D numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TYoZvw7sJa"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"myst","key":"F6i26YYX1r"},{"type":"text","value":") to the physical property values of all cells in the mesh. Mappings are created using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"M1au6mUDs1"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.IdentityMap.html#simpeg.maps.identitymap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG.maps","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NI7mC5wTWi"}],"urlSource":"myst:SimPEG#SimPEG.maps.IdentityMap","internal":false,"protocol":"myst","key":"SUx6sy76kk"},{"type":"text","value":" module.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AdrzRypxOh"}],"key":"bplNsyfcym"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"SimPEG uses a linearized formulation for simulating IP data; see ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iRqK12u7Lz"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.induced_polarization.Simulation2DCellCentered.html#simpeg.electromagnetics.static.induced_polarization.simulation2dcellcentered","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Simulation2DCellCentered","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VWCmtbeaQI"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.induced_polarization.Simulation2DCellCentered","internal":false,"protocol":"myst","key":"a6Xs4CL7rJ"},{"type":"text","value":" or ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WSCW9U6mxh"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.induced_polarization.Simulation2DNodal.html#simpeg.electromagnetics.static.induced_polarization.simulation2dnodal","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Simulation2DNodal","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oac3eAFY5h"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.induced_polarization.Simulation2DNodal","internal":false,"protocol":"myst","key":"MjPhQHo0HE"},{"type":"text","value":". In this formulation, any standard definition of the chargeability can be inverted. And the units of the recovered chargeability values is the same as the data units; e.g. intrinsic chargeability (V/V or mV/V) or integrated chargeability (ms). If you are inverting secondary voltages however, the chargeability model must represent intrinsic chargeabilities (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wdpUQNqdbe"},{"type":"inlineMath","value":"0 \\leq \\eta \\leq 1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmi\u003eη\u003c/mi\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e0 \\leq \\eta \\leq 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003eη\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"sS73O9Afjw"},{"type":"text","value":") in V/V.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kU8z45uah0"}],"key":"ZlbYg8OtEv"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"In this tutorial,","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ehgrQjUQXV"}],"key":"vS5VXAUqEO"},{"type":"text","value":" the model parameters are the subsurface chargeabilities (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AXCpqIh8QU"},{"type":"inlineMath","value":"0 \\leq \\eta \\leq 1","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmi\u003eη\u003c/mi\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e0 \\leq \\eta \\leq 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003eη\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"oL9O0VKnTt"},{"type":"text","value":") in V/V. We use the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mFIZblZWj8"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.maps.InjectActiveCells.html#simpeg.maps.injectactivecells","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"SimPEG​.maps​.InjectActiveCells","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"W6ps4Vfia6"}],"urlSource":"myst:SimPEG#SimPEG.maps.InjectActiveCells","internal":false,"protocol":"myst","key":"DlBr1ljId6"},{"type":"text","value":" map to project the active cell chargeabilities to the entire mesh.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Ig8e4O5Sqs"}],"key":"iwHFPzDl8H"}],"data":{"type":"notebook-content"},"key":"ZiG9ecXvzE"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Model parameters to all cells\nchargeability_map = maps.InjectActiveCells(mesh, active_cells, 0.0)","key":"CWc3CMe4Y0"},{"type":"output","id":"UhW_tnJC1-PIe0Qtr7lJz","data":[],"key":"rzktBE7Ipw"}],"data":{"type":"notebook-code"},"key":"dogWnQpmlz"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Starting/Reference Model for IP Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"exMmQo0TBj"}],"identifier":"starting-reference-model-for-ip-inversion","label":"Starting/Reference Model for IP Inversion","html_id":"starting-reference-model-for-ip-inversion","implicit":true,"key":"SuJMadVSKS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we would create starting and/or reference models for the IP inversion as well as the mapping from the model space to the active cells. Starting and reference models can be a constant background value or contain a-priori structures. Here, the starting model is the 1e-6 V/V. It should be noted that the staring model ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"twrEYhNPV8"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"cannot be vector of zeros,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XOQDJpBfmO"}],"key":"A03k8xdwQB"},{"type":"text","value":" otherwise the inversion will be unable to compute a gradient direction at the first iteration.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U5nbZN1VCS"}],"key":"MCkqNsqZVi"}],"data":{"type":"notebook-content"},"key":"Z0rf7csrVE"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Create staring model from log-conductivity\nstarting_chargeability_model = 1e-4 * np.ones(n_active)\n\n# Zero reference conductivity model\nreference_chargeability_model = np.zeros_like(starting_chargeability_model)","key":"WLjaHlieYQ"},{"type":"output","id":"yetXhdf41EiCRvimVyVtL","data":[],"key":"wv3LM0RDxs"}],"data":{"type":"notebook-code"},"key":"ZEVLXRzp3J"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MuPN4191We"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation","implicit":true,"key":"Tmrw8dRe0s"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"A simulation object defining the forward problem is required in order to predict data and calculate misfits for recovered models. A comprehensive description of the simulation object for 3D IP was discussed in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bAvBEY8ix9"},{"type":"link","url":"fwd_dcip_3d.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D IP Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"h9v9bq5m0p"}],"urlSource":"fwd_dcip_3d.ipynb","key":"fqwKqfw3yR"},{"type":"text","value":" tutorial. Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZaPMev8uGn"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.electromagnetics.static.induced_polarization.Simulation3DNodal.html#simpeg.electromagnetics.static.induced_polarization.simulation3dnodal","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Simulation3DNodel","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"njMNdeTSxm"}],"urlSource":"myst:SimPEG#SimPEG.electromagnetics.static.induced_polarization.Simulation3DNodal","internal":false,"protocol":"myst","key":"qm2zJfIn3g"},{"type":"text","value":" simulation which solves for the electric potential on mesh nodes.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"we3JRVJtWR"}],"key":"femWAfHGTV"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Since we are using a background ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZdKan67nT9"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"conductivity","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Bzzy5MEYPR"}],"key":"jGTN20iCyq"},{"type":"text","value":" model, we use ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QZ0PTwRuBh"},{"type":"inlineCode","value":"sigma","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fdFTuTSC9w"},{"type":"text","value":" to define the background conductivity on the entire mesh. Because the IP problem has been linearized, we store the sensitivities for the inversion using ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"re8U79QJ1E"},{"type":"inlineCode","value":"storeJ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"c2i9Rngc9d"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YU73vwhb5Z"}],"key":"DtnXUi5EeY"}],"data":{"type":"notebook-content"},"key":"KGtxdNZt6Q"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"simulation_L2 = ip.Simulation3DNodal(\n    mesh,\n    survey=ip_data.survey,\n    sigma=conductivity_map * conductivity_model,\n    etaMap=chargeability_map,\n    storeJ=True,\n)","key":"F5c9l6tEwY"},{"type":"output","id":"dS_iSlnLx-3sUkJZC06Dx","data":[],"key":"JwySERTUwu"}],"data":{"type":"notebook-code"},"key":"EUdEusB6O4"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CwZAVnf3IV"}],"identifier":"define-the-data-misfit","label":"Define the Data Misfit","html_id":"define-the-data-misfit","implicit":true,"key":"Owxp697SFf"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To understand the role of the data misfit in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tZb2HZFuMy"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"s4kHtwpxYM"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"AsqpqXjUgX"},{"type":"text","value":".\nHere, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QYQEHNUtPw"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.data_misfit.L2DataMisfit.html#simpeg.data_misfit.l2datamisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"L2DataMisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"duH1QpjIYX"}],"urlSource":"myst:SimPEG#SimPEG.data_misfit.L2DataMisfit","internal":false,"protocol":"myst","key":"OmFf30b6bE"},{"type":"text","value":" class to define the data misfit. In this case, the data misfit is the L2 norm of the weighted residual between the observed data and the data predicted for a given model. When instantiating the data misfit object within SimPEG, we must assign an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Kf61ft6VwD"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DgsCt3BCij"}],"key":"RhtxwPzcH8"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JUQl1A07VN"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simulation object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"J5z3vAhfmA"}],"key":"Q0ghRKbEC9"},{"type":"text","value":" as properties.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"b1RirvIHVg"}],"key":"cOm2BuwoRm"}],"data":{"type":"notebook-content"},"key":"bZ8edygxKM"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"dmis_L2 = data_misfit.L2DataMisfit(simulation=simulation_L2, data=ip_data)","key":"evu3wZSNZB"},{"type":"output","id":"VHycBxvlZksfhkkuXpAKR","data":[],"key":"zHY2KtcVXU"}],"data":{"type":"notebook-code"},"key":"McQdBHo40u"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MvBbHwcbKy"}],"identifier":"define-the-regularization","label":"Define the Regularization","html_id":"define-the-regularization","implicit":true,"key":"PC2dhwYEt3"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To understand the role of the regularization in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LSQzulluDe"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LdwmuPqzAN"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","key":"ABUxGY79qq"},{"type":"text","value":". Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GT9IlWVICs"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.regularization.WeightedLeastSquares.html#simpeg.regularization.weightedleastsquares","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"WeightedLeastSquares","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uuK2xwsop7"}],"urlSource":"myst:SimPEG#SimPEG.regularization.WeightedLeastSquares","internal":false,"protocol":"myst","key":"HoltCrNUWF"},{"type":"text","value":" regularization class to constrain the inversion result. Length scales along x, y and z are used to balance the smallness and smoothness terms. And the reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Fs7DJGBA4K"}],"key":"bca03x3zgL"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"By default, the regularization acts on the model parameters; which in the case are the log-conductivities of the active cells. So we need to specify which cells are active in the regularization. And if we wanted to apply the regularization to a function of the model parameters, we would need to set an approprate mapping object using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"l4ooQ7IrMN"},{"type":"inlineCode","value":"mapping","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xT64O3JNER"},{"type":"text","value":" keyword argument.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iN25LGkRBV"}],"key":"Shle8rN0co"}],"data":{"type":"notebook-content"},"key":"hqkczq3hcH"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"reg_L2 = regularization.WeightedLeastSquares(\n    mesh,\n    active_cells=active_cells,\n    length_scale_x=10.0,\n    length_scale_y=10.0,\n    length_scale_z=10.0,\n    reference_model=reference_chargeability_model,\n    reference_model_in_smooth=False,\n)","key":"wzp6CrlvTb"},{"type":"output","id":"yoepwgGR6QbKNq8uwDiY2","data":[],"key":"vM86mqrg4n"}],"data":{"type":"notebook-code"},"key":"NuwEFom3Z6"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q3eBb8mePy"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm","implicit":true,"key":"KJmLDxPhbL"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To understand the role of the optimization algorithm in the inversion, please visit this online resource. Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i6EuSrmeSP"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.optimization.ProjectedGNCG.html#simpeg.optimization.projectedgncg","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ProjectedGNCG","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gpSSPDolQk"}],"urlSource":"myst:SimPEG#SimPEG.optimization.ProjectedGNCG","internal":false,"protocol":"myst","key":"MyZp0r52yJ"},{"type":"text","value":" class to solve the optimization problem using projected Gauss-Newton with conjugate gradietn solver. Reasonable default values have generally been set for the properties of each optimization class. However, the user may choose to set custom values; e.g. the accuracy tolerance for the conjugate gradient solver or the number of line searches. Here, the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pyGYs263wa"},{"type":"inlineCode","value":"lower","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tLwSwQ4Sya"},{"type":"text","value":" property is set to 0 to ensure recovered chargeability values are positive.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OfvkHVoy0z"}],"key":"I4RMQ0Wc8C"}],"data":{"type":"notebook-content"},"key":"eWQ5CPcwif"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"opt_L2 = optimization.ProjectedGNCG(\n    maxIter=40, lower=0.0, maxIterLS=20, maxIterCG=20, tolCG=1e-2\n)","key":"Av3mplRF62"},{"type":"output","id":"PMDvmoN4e4eYNwRxURYYw","data":[],"key":"wPoFtQhp5G"}],"data":{"type":"notebook-code"},"key":"liiK7iKQ7T"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SpTRze7ZMN"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem","implicit":true,"key":"Ksv3m69Eca"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aFWqPnQGQj"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.inverse_problem.BaseInvProblem.html#simpeg.inverse_problem.baseinvproblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInvProblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JxXFZePoUu"}],"urlSource":"myst:SimPEG#SimPEG.inverse_problem.BaseInvProblem","internal":false,"protocol":"myst","key":"vF1a8EAICC"},{"type":"text","value":" class to fully define the inverse problem that is solved at each beta (trade-off parameter) iteration. The inverse problem requires appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CWKB36nkTD"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data misfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xvIoimTYYE"}],"key":"HxeMAJLiRD"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KsjOUyiUp3"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"regularization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SCdpT4BO4n"}],"key":"RTiifuQLLc"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u02vjBeh4O"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"optimization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"P6sS2dPNU4"}],"key":"HHEwLri8cj"},{"type":"text","value":" objects.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dhHpFJK2tz"}],"key":"dRFSNHQuNK"}],"data":{"type":"notebook-content"},"key":"KHLqmdJ03N"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_L2 = inverse_problem.BaseInvProblem(dmis_L2, reg_L2, opt_L2)","key":"uovTIxb6Aa"},{"type":"output","id":"tZCG7puToVwhs7Gaj9gGF","data":[],"key":"fnsniNEoMF"}],"data":{"type":"notebook-code"},"key":"Upl2x7VUbf"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jIo1MOH03e"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives","implicit":true,"key":"r9FodIhhbo"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Directives represent operations that are applied while the inversion is running. Here, we apply common directives for weighted least-squares inversion of IP data and describe their roles. These are:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AsoLjaUiZS"}],"key":"GW95Zn9hsH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"myst:SimPEG#SimPEG.directives.UpdateSensitivityWeights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"UpdateSensitivityWeights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qwksOpVHoD"}],"urlSource":"myst:SimPEG#SimPEG.directives.UpdateSensitivityWeights","error":true,"key":"qW2kJkFz7K"},{"type":"text","value":": apply sensitivity weighting to counteract the natural tendancy of IP inversion to place materials near the electrodes. Since the IP problem has been linearized, we do not need to update the sensitivities and we set ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dizsUBJ6Xy"},{"type":"inlineCode","value":"every_iteration=False","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SlwFLGlube"},{"type":"text","value":". For IP inversion, we do not want to use the entire dynamic range of the sensitivities to generate our weighting. So we generally set ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PxWVJBLOnA"},{"type":"inlineCode","value":"threshold_value","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"q1wqLDOSff"},{"type":"text","value":" to a value betwewen 1e-4 and 1e-1.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"s97C6ydLA6"}],"key":"MuFAjy8YZf"}],"key":"YQveh2n1sQ"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"myst:SimPEG#SimPEG.directives.UpdatePreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"UpdatePreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ccyC7Trpsh"}],"urlSource":"myst:SimPEG#SimPEG.directives.UpdatePreconditioner","error":true,"key":"ej0qy7yQ4h"},{"type":"text","value":": Apply Jacobi preconditioner when solving optimization problem to reduce the number of conjugate gradient iterations. We set ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"qmZSGMqqF8"},{"type":"inlineCode","value":"update_every_iteration=False","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"anPWnw2mfF"},{"type":"text","value":" because the ideal preconditioner because the forward problem and regularization are not model-dependent.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"oxMEJiJc6a"}],"key":"gLoMlZk1v8"}],"key":"J7BplhWuV1"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"myst:SimPEG#SimPEG.directives.BetaEstimate_ByEig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"BetaEstimate_ByEig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"rVNrttcVRU"}],"urlSource":"myst:SimPEG#SimPEG.directives.BetaEstimate_ByEig","error":true,"key":"JCmTnKDWqO"},{"type":"text","value":": Compute and set starting trade-off parameter (beta) based on largest eigenvalues.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"fWwwNdpZUr"}],"key":"DTIssp2XME"}],"key":"rhZYajvzYd"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"link","url":"myst:SimPEG#SimPEG.directives.BetaSchedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"BetaSchedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"D34d0i9RBh"}],"urlSource":"myst:SimPEG#SimPEG.directives.BetaSchedule","error":true,"key":"T3Rjp83VLb"},{"type":"text","value":": Size reduction of the trade-off parameter at every beta iteration, and the number of Gauss-Newton iterations for each beta. In general, a ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"OI0DqNek9P"},{"type":"inlineCode","value":"coolingFactor","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"b6q70SlJTA"},{"type":"text","value":" between 1.5 and 2.5, and ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"FEpUpH2udm"},{"type":"inlineCode","value":"coolingRate","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"UH5GWgbZm5"},{"type":"text","value":" of 2 or 3 works well for DC resistivity inversion. Cooling beta too quickly will result in portions of the model getting trapped in local minima. And we will not be finding the solution that minimizes the optimization problem if the cooling rate is too small.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Cj1xvUtzaZ"}],"key":"xzpCP9BHWX"}],"key":"N5ZrPElClZ"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"link","url":"myst:SimPEG#SimPEG.directives.TargetMisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"TargetMisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"n1va9BiaYI"}],"urlSource":"myst:SimPEG#SimPEG.directives.TargetMisfit","error":true,"key":"qDnrhms8QM"},{"type":"text","value":": Terminates the inversion when the data misfit equals the target misfit. A ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"UdZ22egDxD"},{"type":"inlineCode","value":"chifact=1","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"oitD0ifFqq"},{"type":"text","value":" terminates the inversion when the data misfit equals the number of data.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"TfUP24g5LM"}],"key":"rvVeKXLSDw"}],"key":"DQeZx2Qwjh"}],"key":"EfNK73rzla"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"The directive objects are organized in a ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"gZyVm0YNhk"},{"type":"inlineCode","value":"list","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"kM1X9W7gC4"},{"type":"text","value":". Upon starting the inversion or updating the recovered model at each iteration, the inversion will call each directive within the list ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"o28KKiqiLM"},{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"in order","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"C7zgymBNfO"}],"key":"sIW6uZgoLd"},{"type":"text","value":". The order of the directives matters, and SimPEG will throw an error if directives are organized into an improper order. Some directives, like the ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"zbLViempzM"},{"type":"inlineCode","value":"BetaEstimate_ByEig","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"foKoJTyeOH"},{"type":"text","value":" are only used when starting the inversion. Other directives, like ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"AU8MeRbsWG"},{"type":"inlineCode","value":"UpdatePreconditionner","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"K7Ltas2zV0"},{"type":"text","value":", are used whenever the model is updated.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"GaIM0lxkSM"}],"key":"h0qYJPo8vw"}],"data":{"type":"notebook-content"},"key":"qL6nBM1Xgu"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"sensitivity_weights = directives.UpdateSensitivityWeights(\n    every_iteration=False, threshold_value=1e-2\n)\nupdate_jacobi = directives.UpdatePreconditioner(update_every_iteration=True)\nstarting_beta = directives.BetaEstimate_ByEig(beta0_ratio=1000)\nbeta_schedule = directives.BetaSchedule(coolingFactor=2.0, coolingRate=2)\ntarget_misfit = directives.TargetMisfit(chifact=1.0)\n\ndirectives_list_L2 = [\n    sensitivity_weights,\n    update_jacobi,\n    starting_beta,\n    beta_schedule,\n    target_misfit,\n]","key":"sqKUKThGOm"},{"type":"output","id":"Mv1SxFm3zNvcejDVvKGO4","data":[],"key":"dAIaqoSyTs"}],"data":{"type":"notebook-code"},"key":"qbUxJjrT2q"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run the Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gqPxlHz1Vi"}],"identifier":"define-and-run-the-inversion","label":"Define and Run the Inversion","html_id":"define-and-run-the-inversion","implicit":true,"key":"LwBQ9CzCJX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We define the inversion using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"d2JS6c28zM"},{"type":"link","url":"https://docs.simpeg.xyz/content/api/generated/SimPEG.inversion.BaseInversion.html#simpeg.inversion.baseinversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"htMnj3eaow"}],"urlSource":"myst:SimPEG#SimPEG.inversion.BaseInversion","internal":false,"protocol":"myst","key":"IaweSwWqJx"},{"type":"text","value":" class. The inversion class must be instatiated with an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"twME5nVgJF"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"inverse problem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oVrk5t1i4J"}],"key":"k2CnX3Ekkl"},{"type":"text","value":" object and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iXfmwFwcmD"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"directives list","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IHx2G6T5qF"}],"key":"EFmNhpjo1N"},{"type":"text","value":". The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"o6QTGbWzOt"},{"type":"inlineCode","value":"run","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"V46kuWM9g5"},{"type":"text","value":" method, along with a starting model, is respondible for running the inversion. The output is a 1D numpy.ndarray containing the recovered model parameters","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CMeWTgUXlP"}],"key":"VDmKlrC47D"}],"data":{"type":"notebook-content"},"key":"BGXkIGfxfC"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Here we combine the inverse problem and the set of directives\ninv_L2 = inversion.BaseInversion(inv_prob_L2, directives_list_L2)\n\n# Run the inversion\nrecovered_chargeability_L2 = inv_L2.run(starting_chargeability_model)","key":"R1DVBcGzCT"},{"type":"output","id":"AHL1iq8Ax844P4f6l5SrS","data":[{"name":"stdout","output_type":"stream","text":"\n                        SimPEG.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                        ***Done using same Solver, and solver_opts as the Simulation3DNodal problem***\n                        \nmodel has any nan: 0\n=============================== Projected GNCG ===============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n   0  1.88e-01  8.35e+02  6.62e+00  8.36e+02    1.43e+03      0              \n   1  1.88e-01  5.01e+02  5.17e+02  5.98e+02    4.19e+02      0              \n   2  9.39e-02  5.01e+02  5.11e+02  5.49e+02    4.67e+02      0              \n   3  9.39e-02  4.41e+02  9.57e+02  5.31e+02    2.09e+02      0              \n   4  4.69e-02  4.41e+02  9.55e+02  4.86e+02    3.11e+02      0              \n   5  4.69e-02  3.93e+02  1.68e+03  4.72e+02    7.04e+01      0              \n   6  2.35e-02  3.93e+02  1.67e+03  4.33e+02    2.38e+02      0              \n   7  2.35e-02  3.56e+02  2.81e+03  4.22e+02    4.12e+01      0              \n   8  1.17e-02  3.57e+02  2.79e+03  3.89e+02    1.87e+02      0              \n------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 \u003c= tolF*(1+|f0|) = 8.3721e+01\n0 : |xc-x_last| = 2.3856e-01 \u003c= tolX*(1+|x0|) = 1.0266e-01\n0 : |proj(x-g)-x|    = 1.8725e+02 \u003c= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 1.8725e+02 \u003c= 1e3*eps       = 1.0000e-02\n0 : maxIter   =      40    \u003c= iter          =      9\n------------------------- DONE! -------------------------\n"}],"key":"DOdlyLmthv"}],"data":{"type":"notebook-code"},"key":"MwQOkHpDX8"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analyze Inversion Outputs","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VIV5QkdKpE"}],"identifier":"analyze-inversion-outputs","label":"Analyze Inversion Outputs","html_id":"analyze-inversion-outputs","implicit":true,"key":"IaqHt5elmD"}],"data":{"type":"notebook-content"},"key":"y4AHDj4Psn"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Normalized Data Misfit in 3D Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kXhgOFYGXG"}],"identifier":"plot-normalized-data-misfit-in-3d-pseudosection","label":"Plot Normalized Data Misfit in 3D Pseudosection","html_id":"plot-normalized-data-misfit-in-3d-pseudosection","implicit":true,"key":"GD0oB48KW7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To see how well the recovered model reproduces the observed data, it is a good idea to compare the predicted and observed data.\nHere, we plot the normalized data misfit to determine whether the observed data are fit evenly. Correlated signatures in the normalized data misfits indicate we are overfitting/underfitting certain data. And that we must modify our uncertainties and re-run the inversion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QCZseh4icR"}],"key":"p5O46jbvDd"}],"data":{"type":"notebook-content"},"key":"PmFrgCks00"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Predicted data from recovered model\ndpred_ip = inv_prob_L2.dpred\n\n# Compute the normalized data misfit\nip_normalized_misfit = (ip_data.dobs - dpred_ip) / ip_data.standard_deviation\n\nif has_plotly:\n    fig = plot_3d_pseudosection(\n        ip_data.survey,\n        ip_normalized_misfit,\n        scale=\"linear\",\n        units=\"\",\n        vlim=[-2.5, 2.5],\n        marker_opts={\"colorscale\": \"RdYlBu\"},\n    )\n\n    fig.update_layout(\n        title_text=\"Normalized Data Misfit\",\n        title_x=0.5,\n        title_font_size=24,\n        width=650,\n        height=500,\n        scene_camera=dict(\n            center=dict(x=0, y=0, z=-0.4), eye=dict(x=1.5, y=-1.5, z=1.8)\n        ),\n    )\n\n    #     plotly.io.show(fig)\n    html_str = plotly.io.to_html(fig)\n    display(HTML(html_str))\n\nelse:\n    print(\"INSTALL 'PLOTLY' TO VISUALIZE 3D PSEUDOSECTIONS\")","key":"h9Fbv2CL6e"},{"type":"output","id":"th_jvxRPGbx1e44pVRXTl","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"5a05004e26456ea8e25572948d43ee7e","path":"/user-tutorials/build/5a05004e26456ea8e25572948d43ee7e.html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}}],"key":"j5RCtjekZC"}],"data":{"type":"notebook-code"},"key":"sjBu4WtxZE"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot 2D Pseudsections for Individual Survey Lines","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"znfqdZoMOB"}],"identifier":"plot-2d-pseudsections-for-individual-survey-lines","label":"Plot 2D Pseudsections for Individual Survey Lines","html_id":"plot-2d-pseudsections-for-individual-survey-lines","implicit":true,"key":"U0XRTHgexz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For large datasets comprised of many survey lines, interpretation can be challenging if we plot every datum. Here, we plot the observed data, predicted data and data misfit for a specified survey line.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Nfdr9JvGmv"}],"key":"u2cBjXd8zd"}],"data":{"type":"notebook-content"},"key":"y7Omcd9cX9"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Data associated with the line index provided\nline_index = 0\nk = lineID == line_index + 1\ndata_array = [\n    np.abs(ip_data.dobs[k]),\n    np.abs(dpred_ip[k]),\n    ip_data.dobs[k] - dpred_ip[k],\n]\n\n# Plot 2D pseudosections (observed, predicted, normalized misfit)\nfig = plt.figure(figsize=(9, 11))\nplot_title = [\"Observed\", \"Predicted\", \"Misfit\"]\nplot_units = [\"V/V\", \"V/V\", \"V/V\"]\nscale = [\"linear\", \"linear\", \"linear\"]\ncmap_list = [mpl.cm.plasma, mpl.cm.plasma, mpl.cm.RdYlBu]\n\nax1 = 3 * [None]\ncax1 = 3 * [None]\ncbar = 3 * [None]\ncplot = 3 * [None]\n\nfor ii in range(0, 3):\n    ax1[ii] = fig.add_axes([0.15, 0.72 - 0.33 * ii, 0.65, 0.21])\n    cax1[ii] = fig.add_axes([0.81, 0.72 - 0.33 * ii, 0.03, 0.21])\n    cplot[ii] = plot_pseudosection(\n        survey_2d_list[line_index],\n        data_array[ii],\n        \"contourf\",\n        ax=ax1[ii],\n        cax=cax1[ii],\n        scale=scale[ii],\n        cbar_label=plot_units[ii],\n        mask_topography=True,\n        contourf_opts={\"levels\": 25, \"cmap\": cmap_list[ii]},\n    )\n    ax1[ii].set_title(plot_title[ii])\n\nplt.show()","key":"xh7Dnjyfha"},{"type":"output","id":"1miYFQwsrFtbZhhgFTOZW","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5ccd819d8e6336b4f40ce6c3d811a68b","path":"/user-tutorials/build/5ccd819d8e6336b4f40ce6c3d811a68b.png"},"text/plain":{"content":"\u003cFigure size 900x1100 with 6 Axes\u003e","content_type":"text/plain"}}}],"key":"oZV5GzyLij"}],"data":{"type":"notebook-code"},"key":"a9U3xYMHWf"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot True and Recovered Chargeability Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gV8Li7L79J"}],"identifier":"plot-true-and-recovered-chargeability-models","label":"Plot True and Recovered Chargeability Models","html_id":"plot-true-and-recovered-chargeability-models","implicit":true,"key":"cvo8RlxVQh"}],"data":{"type":"notebook-content"},"key":"xV5jM99NDv"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"# Define intrinsic chargeability model (V/V)\nair_value = 0.0\nbackground_value = 1e-6\nchargeable_value = 0.1\n\n# Define true chargeability model\ntrue_chargeability_model = background_value * np.ones(n_active)\n\nind_chargeable = model_builder.get_indices_sphere(\n    np.r_[-300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]\n)\n\ntrue_chargeability_model[ind_chargeable] = chargeable_value","key":"DpizNwk2Ny"},{"type":"output","id":"iXvxmVswW42X0AroL8Unh","data":[],"key":"mlB3BnwDou"}],"data":{"type":"notebook-code"},"key":"g1lAhmo0jt"},{"type":"block","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(9, 9))\nax1 = 2 * [None]\nax2 = 2 * [None]\ncbar = 2 * [None]\nnorm = 2 * [None]\ntitle_str = [\n    \"True Chargeability Model\",\n    \"Recovered Chargeability (L2)\",\n]\n\nfor ii, m in enumerate([true_chargeability_model, recovered_chargeability_L2]):\n    norm[ii] = Normalize(vmin=0.0, vmax=np.max(m))\n\n    ax1[ii] = fig.add_axes([0.14, 0.6 - 0.5 * ii, 0.68, 0.35])\n\n    mesh.plot_slice(\n        plotting_map * m,\n        ax=ax1[ii],\n        normal=\"Y\",\n        ind=int(len(mesh.h[1]) / 2),\n        grid=False,\n        pcolor_opts={\"cmap\": mpl.cm.plasma, \"norm\": norm[ii]},\n    )\n    ax1[ii].set_title(title_str[ii])\n    ax1[ii].set_xlabel(\"x (m)\")\n    ax1[ii].set_ylabel(\"z (m)\")\n    ax1[ii].set_xlim([-1500, 1500])\n    ax1[ii].set_ylim([topo_xyz[:, -1].max() - 1500, topo_xyz[:, -1].max()])\n\n    ax2[ii] = fig.add_axes([0.84, 0.6 - 0.5 * ii, 0.03, 0.35])\n    cbar[ii] = mpl.colorbar.ColorbarBase(\n        ax2[ii], norm=norm[ii], orientation=\"vertical\", cmap=mpl.cm.plasma\n    )\n    cbar[ii].set_label(r\"$\\sigma$ (S/m)\", rotation=270, labelpad=15, size=12)","key":"soecml074L"},{"type":"output","id":"05REYxIFydM6GM2Q_4L8s","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4bb075878ab4aeb85be254c41d4261dc","path":"/user-tutorials/build/4bb075878ab4aeb85be254c41d4261dc.png"},"text/plain":{"content":"\u003cFigure size 900x900 with 4 Axes\u003e","content_type":"text/plain"}}}],"key":"v4hUpG7wKZ"}],"data":{"type":"notebook-code"},"key":"jNdmnnMEsc"}],"key":"JJBtKCTNvT"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"2.5D IP Inversion","url":"/inv-ip-2d","group":"SimPEG User Tutorials"},"next":{"title":"Frequency-Domain Electromagnetics","url":"/fdem-index","group":"SimPEG User Tutorials"}}},"domain":"http://localhost:3000"}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":false,"v2_headers":true,"v2_meta":false,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/user-tutorials/build/manifest-FDC5A112.js";
import * as route0 from "/user-tutorials/build/root-2CYAF5SQ.js";
import * as route1 from "/user-tutorials/build/routes/$-ZDWRJY4B.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/user-tutorials/build/entry.client-K6EYMIDZ.js");</script></body></html>